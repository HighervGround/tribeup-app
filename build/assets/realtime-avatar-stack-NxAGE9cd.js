import{j as e}from"./ui-Bz49QZar.js";import{f as s,j as a,g as i,h as t,u as r,i as n,m as o,n as c,o as l,s as m}from"./index-B65d9cWK.js";import{e as u,r as d}from"./vendor-CVaDA-xz.js";import{t as p}from"./utils-e0hEqRVR.js";import{c as g,d as j}from"./useGames-DziNGLKj.js";const x={sm:"size-6",md:"size-8",lg:"size-10",xl:"size-12"};function f({userId:r,src:n,alt:o,fallback:c,size:l="md",className:m,onClick:d,disabled:p=!1}){const g=u();return e.jsxs(s,{className:a(x[l],(r||d)&&!p&&"cursor-pointer hover:ring-2 hover:ring-primary/20 transition-all",p&&"opacity-50 cursor-not-allowed",m),onClick:e=>{e.stopPropagation(),d?d():r&&!p&&g(`/user/${r}`)},children:[n&&e.jsx(i,{src:n,alt:o||"User avatar"}),e.jsx(t,{className:"bg-primary/10 text-primary font-medium",children:c||(j=o,j?j.startsWith("Unknown User")?"??":j.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2):"?")})]});var j}function h(){const e=g(),s=j(),{user:a}=r(),i=d.useCallback(e=>!!a?.id&&(e.creatorId===a.id||e.creator_id===a.id||e.createdBy===a.id||e.creatorData?.id===a.id),[a?.id]),t=d.useCallback((a,t)=>{if(t?.stopPropagation(),a.isJoined){if(i(a))return void p.error("Cannot leave your own game",{description:"Use the menu options to delete the game instead."});s.mutate(a.id,{onSuccess:()=>{p.success("Left game successfully")},onError:e=>{}})}else e.mutate(a.id,{onSuccess:()=>{p.success("Joined game successfully!")},onError:e=>{}})},[e,s,i]),n=e.isPending||s.isPending,o=d.useCallback(e=>n?"...":e.isJoined?i(e)?"Joined":"Leave":"Join",[n,i]),c=d.useCallback(e=>e.isJoined?i(e)?"secondary":"outline":"default",[i]);return{toggleJoin:t,isLoading:n,getButtonText:o,getButtonVariant:c,isGameCreator:i,isJoining:e.isPending,isLeaving:s.isPending}}const v=o("flex -space-x-4 -space-y-4",{variants:{orientation:{vertical:"flex-row",horizontal:"flex-col"}},defaultVariants:{orientation:"vertical"}}),b=({className:a,orientation:r,avatars:o,maxAvatarsAmount:c=3,...l})=>{const m=o.slice(0,c),u=o.slice(c);return e.jsxs("div",{className:n(v({orientation:r}),a),...l,children:[m.map(({name:a,image:r},n)=>e.jsx("div",{title:a,children:e.jsxs(s,{className:"hover:z-10",children:[e.jsx(i,{src:r}),e.jsx(t,{className:"bg-primary/10 text-primary text-xs",children:a?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()})]})},`${a}-${r}-${n}`)),u.length?e.jsx("div",{title:u.map(({name:e})=>e).join(", "),children:e.jsx(s,{children:e.jsxs(t,{children:["+",o.length-m.length]})})}):null]})},y=({roomName:s})=>{const{users:a}=(e=>{const s=c(),a=l(),[i,t]=d.useState({});return d.useEffect(()=>{const i=m.channel(e);return i.on("presence",{event:"sync"},()=>{const e=i.presenceState(),s=Object.fromEntries(Object.entries(e).map(([e,s])=>{const a=s;return[e,{id:e,name:a[0]?.name||"",image:a[0]?.image||""}]}));t(s)}).subscribe(async e=>{"SUBSCRIBED"===e&&await i.track({name:a,image:s})}),()=>{i.unsubscribe()}},[e,a,s]),{users:i}})(s),i=d.useMemo(()=>Object.values(a).map(e=>({name:e.name,image:e.image})),[a]);return e.jsx(b,{avatars:i})};export{f as C,y as R,h as u};
//# sourceMappingURL=realtime-avatar-stack-NxAGE9cd.js.map
