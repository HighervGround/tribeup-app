import{j as e}from"./ui-Bqrh-KgM.js";import{m as s,C as i,d as t,e as n,a,A as r,f as c,b as o,B as d,L as l}from"./index-Dn2wyjF3.js";import{S as u}from"./switch-DhB4U9RT.js";import{r as m}from"./vendor-CVaDA-xz.js";import{t as h,B as f,T as x,d as j,a4 as b,v as p,f as g,h as N,q as w,j as v,a5 as y,R as G,C as k}from"./utils-CNK9eq93.js";import"./data-D6RrWw63.js";const S="BCmjGZmgUDGgJG3g5y8FPAGgGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGG";function C(e={}){const{vapidPublicKey:s=S,autoSubscribe:i=!1,serviceWorkerUrl:t="/sw.js"}=e,[n,a]=m.useState({isSupported:!1,permission:"default",isSubscribed:!1,subscription:null,isLoading:!1,error:null}),[r,c]=m.useState(null),o=m.useCallback(()=>{const e="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;return a(s=>({...s,isSupported:e})),e},[]),d=m.useCallback(async()=>{if(!("serviceWorker"in navigator))return null;try{const e=await navigator.serviceWorker.register(t,{scope:"/"});return c(e),await navigator.serviceWorker.ready,e}catch(e){return a(e=>({...e,error:"Failed to register service worker"})),null}},[t]),l=m.useCallback(async()=>{if(!("Notification"in window))return a(e=>({...e,error:"Notifications not supported"})),"denied";try{const e=await Notification.requestPermission();if(a(s=>({...s,permission:e})),"granted"===e)h.success("Notifications enabled!");return e}catch(e){return a(e=>({...e,error:"Failed to request permission"})),"denied"}},[]),u=m.useCallback(async()=>{if(!r)return h.error("Service worker not available"),null;if("granted"!==n.permission){if("granted"!==await l())return null}a(e=>({...e,isLoading:!0,error:null}));try{const e=function(e){const s="=".repeat((4-e.length%4)%4),i=(e+s).replace(/-/g,"+").replace(/_/g,"/"),t=window.atob(i),n=new Uint8Array(t.length);for(let a=0;a<t.length;++a)n[a]=t.charCodeAt(a);return n}(s),i=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}),t={endpoint:i.endpoint,keys:{p256dh:P(i.getKey("p256dh")),auth:P(i.getKey("auth"))}};return await async function(){await new Promise(e=>setTimeout(e,500))}(),a(e=>({...e,isSubscribed:!0,subscription:t,isLoading:!1})),t}catch(e){return a(e=>({...e,isLoading:!1,error:"Failed to subscribe to push notifications"})),h.error("Failed to enable push notifications"),null}},[r,n.permission,l,s]),f=m.useCallback(async()=>{if(!r)return!1;a(e=>({...e,isLoading:!0,error:null}));try{const e=await r.pushManager.getSubscription();return e&&(await e.unsubscribe(),n.subscription&&await async function(){await new Promise(e=>setTimeout(e,500))}(n.subscription)),a(e=>({...e,isSubscribed:!1,subscription:null,isLoading:!1})),!0}catch(e){return a(e=>({...e,isLoading:!1,error:"Failed to unsubscribe from push notifications"})),!1}},[r,n.subscription]),x=m.useCallback(async()=>{if(r)try{const e=await r.pushManager.getSubscription();if(e){const s={endpoint:e.endpoint,keys:{p256dh:P(e.getKey("p256dh")),auth:P(e.getKey("auth"))}};a(e=>({...e,isSubscribed:!0,subscription:s}))}else a(e=>({...e,isSubscribed:!1,subscription:null}))}catch(e){}},[r]),j=m.useCallback(async()=>{if(n.isSubscribed&&n.subscription)try{await fetch("/api/notifications/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:n.subscription,notification:{title:"Test Notification",body:"This is a test notification from TribeUp!",data:{type:"test",url:"/"}}})}),h.success("Test notification sent!")}catch(e){h.error("Failed to send test notification")}else h.error("Not subscribed to notifications")},[n.isSubscribed,n.subscription]);return m.useEffect(()=>{(async()=>{if(!o())return;"Notification"in window&&a(e=>({...e,permission:Notification.permission}));const e=await d();if(e&&(await x(),i&&"granted"===Notification.permission)){await e.pushManager.getSubscription()||await u()}})()},[o,d,x,u,i]),{...n,requestPermission:l,subscribe:u,unsubscribe:f,sendTestNotification:j,serviceWorkerRegistration:r,canSubscribe:n.isSupported&&"granted"===n.permission&&!n.isSubscribed,shouldRequestPermission:n.isSupported&&"default"===n.permission}}function P(e){const s=new Uint8Array(e);let i="";for(let t=0;t<s.byteLength;t++)i+=String.fromCharCode(s[t]);return window.btoa(i)}function T(){const{isSupported:m,permission:h,isSubscribed:S,isLoading:P,error:T,canSubscribe:R,shouldRequestPermission:A,requestPermission:L,subscribe:E,unsubscribe:F,sendTestNotification:W}=C(),{settings:q,updateSettings:K}=s();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(t,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Push Notifications"]})}),e.jsx(a,{className:"space-y-4",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(()=>{switch(h){case"granted":return e.jsx(k,{className:"w-5 h-5 text-green-500"});case"denied":return e.jsx(j,{className:"w-5 h-5 text-red-500"});default:return e.jsx(x,{className:"w-5 h-5 text-yellow-500"})}})(),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(()=>{switch(h){case"granted":return"Notifications enabled";case"denied":return"Notifications blocked";default:return"Permission pending"}})()}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["granted"===h&&S&&"You'll receive notifications for important updates","granted"===h&&!S&&"Click to enable push notifications","denied"===h&&"Enable notifications in your browser settings","default"===h&&"Click to enable notifications"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S&&e.jsx(o,{variant:"secondary",className:"bg-green-500/10 text-green-600",children:"Active"}),e.jsx(u,{checked:S,onCheckedChange:async()=>{S?await F():R?await E():A&&await L()},disabled:P||"denied"===h})]})]}),T&&e.jsxs(r,{variant:"destructive",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx(c,{children:T})]}),S&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Test Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Send a test notification to verify everything works"})]}),e.jsx(d,{variant:"outline",size:"sm",onClick:W,disabled:P,children:P?e.jsx(l,{size:"sm"}):"Send Test"})]})]}):e.jsxs(r,{children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx(c,{children:"Push notifications are not supported in your browser. Please use a modern browser like Chrome, Firefox, or Safari."})]})})]}),e.jsxs(i,{children:[e.jsx(t,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Notification Types"]})}),e.jsxs(a,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"New Messages"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Get notified when someone sends you a message"})]})]}),e.jsx(u,{checked:q.messageNotifications,onCheckedChange:e=>K({messageNotifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Game Reminders"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Reminders before your games start"})]})]}),e.jsx(u,{checked:q.gameReminders,onCheckedChange:e=>K({gameReminders:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Game Updates"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"When someone joins or leaves your games"})]})]}),e.jsx(u,{checked:q.pushNotifications,onCheckedChange:e=>K({pushNotifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Email Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Weekly summary and important updates"})]})]}),e.jsx(u,{checked:q.emailNotifications,onCheckedChange:e=>K({emailNotifications:e})})]})]})]}),e.jsxs(i,{children:[e.jsx(t,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Sound & Vibration"]})}),e.jsx(a,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Notification Sounds"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Play a sound when you receive notifications"})]}),e.jsx(u,{checked:q.soundEnabled,onCheckedChange:e=>K({soundEnabled:e})})]})})]}),e.jsxs(i,{children:[e.jsx(t,{children:e.jsx(n,{children:"Quick Actions"})}),e.jsxs(a,{className:"space-y-3",children:[e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>{K({pushNotifications:!0,messageNotifications:!0,gameReminders:!0,soundEnabled:!0})},children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Enable All Notifications"]}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>{K({pushNotifications:!1,messageNotifications:!1,gameReminders:!1,soundEnabled:!1})},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Disable All Notifications"]}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>{K({pushNotifications:!0,emailNotifications:!1,gameReminders:!0,messageNotifications:!0,soundEnabled:!0})},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Reset to Defaults"]})]})]}),"denied"===h&&e.jsxs(r,{children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Notifications are blocked"}),e.jsxs("div",{className:"text-sm",children:["To enable notifications:",e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Click the ðŸ”’ icon in your browser's address bar"}),e.jsx("li",{children:'Select "Notifications" and choose "Allow"'}),e.jsx("li",{children:"Refresh this page"})]})]})]})})]})]})}export{T as default};
//# sourceMappingURL=NotificationSettings-Cz6FmEa3.js.map
