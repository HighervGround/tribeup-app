import{j as e}from"./ui-Bqrh-KgM.js";import{e as s,r,R as a}from"./vendor-CVaDA-xz.js";import{u as t,S as l,B as n,C as i,d as o,e as c,a as m,h as d,i as u,j as f,b as x}from"./index-Dn2wyjF3.js";import{I as h}from"./input-CIikqddo.js";import{T as p}from"./textarea-Ca9ZlOmN.js";import{A as j,o as g,p as v,X as b,t as N}from"./utils-CNK9eq93.js";import{c as y}from"./useUserProfile-CtUpRbce.js";import"./data-D6RrWw63.js";const w=["Basketball","Soccer","Tennis","Volleyball","Football","Baseball","Swimming","Running","Cycling","Yoga"];function P(){const P=s(),{user:U,setUser:S}=t(),C=y(),k=C.isPending,[L,A]=r.useState({fullName:"",username:"",bio:"",location:"",avatarUrl:"",sportsPreferences:[]}),[E,B]=r.useState(null),[F,I]=r.useState(!1),[J,O]=r.useState(null),[z,R]=r.useState(""),[T,_]=r.useState(null),D=a.useRef(null),G=200,M=/^[a-zA-Z0-9._-]{3,20}$/;r.useEffect(()=>{(async()=>{if(U)try{const e=await l.getUserProfile(U.id);if(!e)return;const s={fullName:e.name||"",username:e.username||"",bio:e.bio||"",location:e.location||"",avatarUrl:e.avatar||"",sportsPreferences:Array.isArray(e.preferences?.sports)?e.preferences.sports:[]};A(s),D.current=s}catch(e){N.error("Failed to load profile data")}else P("/auth")})()},[U,P]),r.useEffect(()=>{let e;const s=(L.username||"").trim();if(s)if(M.test(s)){if(!U?.username||U.username.trim().toLowerCase()!==s.toLowerCase())return I(!0),e=setTimeout(async()=>{try{const e=await l.isUsernameAvailable(s,U?.id);B(e?null:"Username is already taken")}catch{B("Unable to validate username right now")}finally{I(!1)}},450),()=>clearTimeout(e);B(null)}else B("3-20 chars. Letters, numbers, dot, underscore, or hyphen.");else B(null)},[L.username,U]);const V=(e,s)=>{A(r=>({...r,[e]:s})),"username"===e&&B(null),"bio"===e&&"string"==typeof s&&s.length>G&&A(e=>({...e,bio:s.slice(0,G)}))};r.useEffect(()=>{const e=D.current&&JSON.stringify(D.current)!==JSON.stringify(L),s=s=>{e&&(s.preventDefault(),s.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[L]);const W=D.current&&JSON.stringify(D.current)!==JSON.stringify(L)||null!==J;return U?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-12 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{if(D.current&&JSON.stringify(D.current)!==JSON.stringify(L)){if(!window.confirm("Discard unsaved changes?"))return}P("/profile")},children:e.jsx(j,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Edit Profile"})]}),e.jsxs(n,{onClick:async()=>{if(U)try{const s=(L.username||"").trim();if(s){if(!M.test(s))return void B("3-20 chars. Letters, numbers, dot, underscore, or hyphen.");if(!(await l.isUsernameAvailable(s,U.id)))return void B("Username is already taken")}let r=L.avatarUrl;if(J)try{r=await l.uploadAvatar(J)}catch(e){N.error("Failed to upload profile picture. Profile will be saved without image.")}C.mutate({userId:U.id,profileData:{full_name:L.fullName,username:L.username,bio:L.bio,location:L.location,avatar_url:r,preferred_sports:L.sportsPreferences}},{onSuccess:e=>{S(e),P("/profile")},onError:e=>{N.error("Failed to update profile: "+e.message)}})}catch(s){N.error("Failed to validate profile data")}},disabled:!W||k||F||!!E||!!T||!L.fullName||!L.username,className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),k?"Saving...":"Save"]})]}),e.jsxs("div",{className:"px-4 space-y-6",children:[e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"Profile Picture"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(d,{className:"w-20 h-20",children:[(z||L.avatarUrl)&&e.jsx(u,{src:z||L.avatarUrl,alt:"Avatar preview"}),e.jsx(f,{className:"text-xl",children:L.fullName?L.fullName.charAt(0).toUpperCase():"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{type:"file",accept:"image/*",onChange:e=>{const s=e.target.files?.[0]||null;if(O(s),_(null),s){const e=5242880;if(!["image/jpeg","image/png","image/webp","image/gif"].includes(s.type))return _("Please upload a JPG, PNG, WEBP, or GIF image."),void O(null);if(s.size>e)return _("Image is too large. Max size is 5 MB."),void O(null);const r=URL.createObjectURL(s);R(r)}else R("")}}),e.jsx(v,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Upload an image for your avatar"}),T&&e.jsx("p",{className:"text-xs text-red-500 mt-1",role:"alert","aria-live":"polite",children:T})]})]})})]}),e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"Basic Information"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Full Name"}),e.jsx(h,{placeholder:"Enter your full name",value:L.fullName,onChange:e=>V("fullName",e.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Username ",e.jsx("span",{className:"text-muted-foreground font-normal",children:"(3–20 chars)"})]}),e.jsx(h,{placeholder:"Choose a username",value:L.username,onChange:e=>V("username",e.target.value),onBlur:async()=>{if(!U)return;const e=(L.username||"").trim();if(e)if(M.test(e)){if(!U.username||U.username.trim().toLowerCase()!==e.toLowerCase())try{I(!0);await l.isUsernameAvailable(e,U.id)||B("Username is already taken")}catch(s){B("Unable to validate username right now")}finally{I(!1)}}else B("3-20 chars. Letters, numbers, dot, underscore, or hyphen.")},"aria-describedby":E?"username-error":"username-help"}),F&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1","aria-live":"polite",children:"Checking availability…"}),E&&e.jsx("p",{id:"username-error",className:"text-xs text-red-500 mt-1",role:"alert","aria-live":"polite",children:E}),!E&&!F&&L.username&&e.jsx("p",{id:"username-help",className:"text-xs text-muted-foreground mt-1",children:"Allowed: letters, numbers, dot, underscore, hyphen."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(h,{placeholder:"City, State",value:L.location,onChange:e=>V("location",e.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Bio ",e.jsxs("span",{className:"text-muted-foreground font-normal",children:["(max ",G," chars)"]})]}),e.jsx(p,{placeholder:"Tell us about yourself...",value:L.bio,onChange:e=>V("bio",e.target.value),rows:3,maxLength:G,"aria-describedby":"bio-counter"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("span",{id:"bio-counter",className:"text-xs "+(L.bio.length>=G?"text-red-500":"text-muted-foreground"),children:[L.bio.length,"/",G]})})]})]})]}),e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"Sports I Play"})}),e.jsxs(m,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(s=>e.jsxs(x,{variant:L.sportsPreferences.includes(s)?"default":"secondary",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>(e=>{A(s=>({...s,sportsPreferences:s.sportsPreferences.includes(e)?s.sportsPreferences.filter(s=>s!==e):[...s.sportsPreferences,e]}))})(s),children:[s,L.sportsPreferences.includes(s)&&e.jsx(b,{className:"w-3 h-3 ml-1"})]},s))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:"Click on sports to add or remove them from your preferences"})]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl mb-4",children:"Please sign in"}),e.jsx(n,{onClick:()=>P("/auth"),children:"Sign In"})]})})}export{P as default};
//# sourceMappingURL=EditProfile-LnD8Yy7R.js.map
