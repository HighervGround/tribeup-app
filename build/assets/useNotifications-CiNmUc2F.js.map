{"version":3,"file":"useNotifications-CiNmUc2F.js","sources":["../../src/hooks/useNotifications.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { toast } from 'sonner';\nimport { SupabaseService } from '../lib/supabaseService';\n\ninterface Notification {\n  id: string;\n  type: 'game_update' | 'new_message' | 'game_reminder' | 'join_request' | 'system';\n  title: string;\n  message: string;\n  timestamp: Date;\n  read: boolean;\n  actionUrl?: string;\n  gameId?: string;\n  userId?: string;\n}\n\ninterface NotificationSettings {\n  pushNotifications: boolean;\n  emailNotifications: boolean;\n  gameReminders: boolean;\n  messageNotifications: boolean;\n  soundEnabled: boolean;\n}\n\nexport function useNotifications() {\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [settings, setSettings] = useState<NotificationSettings>({\n    pushNotifications: true,\n    emailNotifications: false,\n    gameReminders: true,\n    messageNotifications: true,\n    soundEnabled: true\n  });\n\n  // Load notifications from Supabase\n  useEffect(() => {\n    const loadNotifications = async () => {\n      try {\n        const notificationsData = await SupabaseService.getNotifications();\n        setNotifications(notificationsData);\n      } catch (error) {\n        console.error('Error loading notifications:', error);\n      }\n    };\n\n    loadNotifications();\n  }, []);\n\n  // Subscribe to real-time notifications\n  useEffect(() => {\n    const subscription = SupabaseService.subscribeToNotifications((newNotification) => {\n      setNotifications(prev => [newNotification, ...prev]);\n      \n      if (settings.pushNotifications) {\n        showNotification(newNotification);\n      }\n    });\n\n    return () => {\n      subscription?.unsubscribe();\n    };\n  }, [settings.pushNotifications]);\n\n  const showNotification = useCallback((notification: Notification) => {\n    if (!settings.pushNotifications) return;\n\n    // Play sound if enabled\n    if (settings.soundEnabled) {\n      // In a real app, you'd play an actual sound file\n      console.log('ðŸ”Š Notification sound played');\n    }\n\n    // Show toast notification\n    toast(notification.title, {\n      description: notification.message,\n      action: notification.actionUrl ? {\n        label: 'View',\n        onClick: () => {\n          // In a real app, you'd navigate to the URL\n          console.log('Navigate to:', notification.actionUrl);\n        }\n      } : undefined,\n      duration: 5000\n    });\n\n    // Request browser permission for native notifications\n    if ('Notification' in window && Notification.permission === 'granted') {\n      new Notification(notification.title, {\n        body: notification.message,\n        icon: '/favicon.ico', // Your app icon\n        badge: '/favicon.ico',\n        vibrate: [200, 100, 200],\n        timestamp: notification.timestamp.getTime()\n      });\n    }\n  }, [settings.pushNotifications, settings.soundEnabled]);\n\n  const markAsRead = useCallback(async (notificationId: string) => {\n    try {\n      await SupabaseService.markNotificationAsRead(notificationId);\n      setNotifications(prev => \n        prev.map(notification => \n          notification.id === notificationId \n            ? { ...notification, read: true }\n            : notification\n        )\n      );\n    } catch (error) {\n      console.error('Error marking notification as read:', error);\n    }\n  }, []);\n\n  const markAllAsRead = useCallback(async () => {\n    try {\n      // Mark all unread notifications as read\n      const unreadNotifications = notifications.filter(n => !n.read);\n      await Promise.all(unreadNotifications.map(n => SupabaseService.markNotificationAsRead(n.id)));\n      \n      setNotifications(prev => \n        prev.map(notification => ({ ...notification, read: true }))\n      );\n    } catch (error) {\n      console.error('Error marking all notifications as read:', error);\n    }\n  }, [notifications]);\n\n  const deleteNotification = useCallback(async (notificationId: string) => {\n    try {\n      await SupabaseService.deleteNotification(notificationId);\n      setNotifications(prev => \n        prev.filter(notification => notification.id !== notificationId)\n      );\n    } catch (error) {\n      console.error('Error deleting notification:', error);\n    }\n  }, []);\n\n  const clearAll = useCallback(async () => {\n    try {\n      await SupabaseService.clearAllNotifications();\n      setNotifications([]);\n    } catch (error) {\n      console.error('Error clearing all notifications:', error);\n    }\n  }, []);\n\n  const requestPermission = useCallback(async () => {\n    if (!('Notification' in window)) {\n      toast.error('Browser notifications not supported');\n      return false;\n    }\n\n    if (Notification.permission === 'granted') {\n      return true;\n    }\n\n    if (Notification.permission === 'denied') {\n      toast.error('Notifications are blocked. Please enable them in your browser settings.');\n      return false;\n    }\n\n    const permission = await Notification.requestPermission();\n    \n    if (permission === 'granted') {\n      toast.success('Notifications enabled!');\n      return true;\n    } else {\n      toast.error('Notification permission denied');\n      return false;\n    }\n  }, []);\n\n  const updateSettings = useCallback((newSettings: Partial<NotificationSettings>) => {\n    setSettings(prev => ({ ...prev, ...newSettings }));\n    \n    // If push notifications are being enabled, request permission\n    if (newSettings.pushNotifications && !settings.pushNotifications) {\n      requestPermission();\n    }\n  }, [settings.pushNotifications, requestPermission]);\n\n  const unreadCount = notifications.filter(n => !n.read).length;\n  const recentNotifications = notifications.slice(0, 10); // Show last 10\n\n  return {\n    notifications: recentNotifications,\n    unreadCount,\n    settings,\n    markAsRead,\n    markAllAsRead,\n    deleteNotification,\n    clearAll,\n    updateSettings,\n    requestPermission\n  };\n}"],"names":["useNotifications","notifications","setNotifications","useState","settings","setSettings","useEffect","notificationsData","SupabaseService","error","subscription","newNotification","prev","showNotification","useCallback","notification","toast","markAsRead","notificationId","markAllAsRead","unreadNotifications","n","deleteNotification","clearAll","requestPermission","updateSettings","newSettings","unreadCount"],"mappings":"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"}