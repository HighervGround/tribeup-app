import{r as e}from"./vendor-C07EgOn8.js";import{t as s}from"./utils-sWWcUyIH.js";import{c as a,d as n}from"./useGames-BZdFMUUb.js";import{u as i,g as t,h as r,i as o,m as c,s as l}from"./index-Ce8SbcNa.js";import{j as m}from"./ui-BV8hHw1h.js";import{c as u}from"./utils-BWjUwF_O.js";import{a as d,b as p,c as j}from"./tooltip-DvHS9-_8.js";function g(){const t=a(),r=n(),{user:o}=i(),c=e.useCallback(e=>!!o?.id&&(e.creatorId===o.id||e.creator_id===o.id||e.createdBy===o.id||e.creatorData?.id===o.id),[o?.id]),l=e.useCallback((e,a)=>{if(a?.stopPropagation(),e.isJoined){if(c(e))return void s.error("Cannot leave your own game",{description:"Use the menu options to delete the game instead."});r.mutate(e.id,{onSuccess:()=>{s.success("Left game successfully")},onError:e=>{}})}else t.mutate(e.id,{onSuccess:()=>{s.success("Joined game successfully!")},onError:e=>{}})},[t,r,c]),m=t.isPending||r.isPending,u=e.useCallback(e=>m?"...":e.isJoined?c(e)?"Joined":"Leave":"Join",[m,c]),d=e.useCallback(e=>e.isJoined?c(e)?"secondary":"outline":"default",[c]);return{toggleJoin:l,isLoading:m,getButtonText:u,getButtonVariant:d,isGameCreator:c,isJoining:t.isPending,isLeaving:r.isPending}}const h=c("flex -space-x-4 -space-y-4",{variants:{orientation:{vertical:"flex-row",horizontal:"flex-col"}},defaultVariants:{orientation:"vertical"}}),x=({className:e,orientation:s,avatars:a,maxAvatarsAmount:n=3,...i})=>{const c=a.slice(0,n),l=a.slice(n);return m.jsxs("div",{className:u(h({orientation:s}),e,"horizontal"===s?"-space-x-0":"-space-y-0"),...i,children:[c.map(({name:e,image:s},a)=>m.jsxs(d,{children:[m.jsx(p,{asChild:!0,children:m.jsxs(t,{className:"hover:z-10",children:[m.jsx(r,{src:s}),m.jsx(o,{children:e?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()})]})}),m.jsx(j,{children:m.jsx("p",{children:e})})]},`${e}-${s}-${a}`)),l.length?m.jsxs(d,{children:[m.jsx(p,{asChild:!0,children:m.jsx(t,{children:m.jsxs(o,{children:["+",a.length-c.length]})})}),m.jsx(j,{children:l.map(({name:e},s)=>m.jsx("p",{children:e},`${e}-${s}`))})]},"hidden-avatars"):null]})},f=s=>{const a=(()=>{const{user:e}=i();return e?.avatar||""})(),n=(()=>{const{user:e}=i();return e?.name||e?.email?.split("@")[0]||"Anonymous"})(),[t,r]=e.useState({});return e.useEffect(()=>{const e=l.channel(s);return e.on("presence",{event:"sync"},()=>{const s=e.presenceState(),a=Object.fromEntries(Object.entries(s).map(([e,s])=>{const a=s;return[e,{id:e,name:a[0]?.name||"",image:a[0]?.image||""}]}));r(a)}).subscribe(async s=>{"SUBSCRIBED"===s&&await e.track({name:n,image:a})}),()=>{e.unsubscribe()}},[s,n,a]),{users:t}},v=({roomName:s})=>{const{users:a}=f(s),n=e.useMemo(()=>Object.values(a).map(e=>({name:e.name,image:e.image})),[a]);return m.jsx(x,{avatars:n})};export{v as R,g as u};
//# sourceMappingURL=realtime-avatar-stack-CUpoEQ1q.js.map
