import{j as e,R as t,T as a,b as s,C as n,I as i,d as r,e as l,f as o,g as c,D as d,h as m,O as u}from"./ui-Bz49QZar.js";import{r as h,e as x,j as g}from"./vendor-CVaDA-xz.js";import{u as p,s as f,C as j,c as v,d as y,a as w,i as N,f as b,g as k,h as C,B as S,j as M,k as _,A as P,e as W,b as $,S as D,l as T}from"./index-B65d9cWK.js";import{u as A,C as F,R as I}from"./realtime-avatar-stack-NxAGE9cd.js";import{S as R}from"./separator-CPokZKQM.js";import{I as z}from"./input-CeRKj5zJ.js";import{p as O,j as E,q as U,X as G,U as J,r as L,s as Y,t as q,u as H,g as B,i as X,k as K,v as V,l as Q,C as Z,w as ee,L as te,F as ae,R as se,A as ne,x as ie,E as re,y as le,e as oe,D as ce,N as de}from"./utils-e0hEqRVR.js";import{T as me}from"./textarea-BV7PiKC_.js";import{I as ue}from"./ImageWithFallback-BlIlvXsa.js";import{a as he,b as xe}from"./useGames-DziNGLKj.js";import{u as ge}from"./useDeepLinks-fOdk0YoC.js";import{a as pe,b as fe,f as je}from"./dateUtils-ByixnkWz.js";import"./data-BwpJIDKS.js";function ve(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}const ye=43200;let we={};function Ne(){return we}function be(e){const t=ve(e),a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return a.setUTCFullYear(t.getFullYear()),+e-+a}function ke(e,t){const a=ve(e),s=ve(t),n=a.getTime()-s.getTime();return n<0?-1:n>0?1:n}function Ce(e){return function(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}(e,Date.now())}function Se(e){const t=ve(e);return+function(e){const t=ve(e);return t.setHours(23,59,59,999),t}(t)===+function(e){const t=ve(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}(t)}function Me(e,t){const a=ve(e),s=ve(t),n=ke(a,s),i=Math.abs(function(e,t){const a=ve(e),s=ve(t);return 12*(a.getFullYear()-s.getFullYear())+(a.getMonth()-s.getMonth())}(a,s));let r;if(i<1)r=0;else{1===a.getMonth()&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-n*i);let t=ke(a,s)===-n;Se(ve(e))&&1===i&&1===ke(e,s)&&(t=!1),r=n*(i-Number(t))}return 0===r?0:r}function _e(e,t,a){const s=function(e,t){return+ve(e)-+ve(t)}(e,t)/1e3;return(n=a?.roundingMethod,e=>{const t=(n?Math[n]:Math.trunc)(e);return 0===t?0:t})(s);var n}const Pe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function We(e){return(t={})=>{const a=t.width?String(t.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}const $e={date:We({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:We({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:We({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},De={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Te(e){return(t,a)=>{let s;if("formatting"===(a?.context?String(a.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,n=a?.width?String(a.width):t;s=e.formattingValues[n]||e.formattingValues[t]}else{const t=e.defaultWidth,n=a?.width?String(a.width):e.defaultWidth;s=e.values[n]||e.values[t]}return s[e.argumentCallback?e.argumentCallback(t):t]}}function Ae(e){return(t,a={})=>{const s=a.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],i=t.match(n);if(!i)return null;const r=i[0],l=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],o=Array.isArray(l)?function(e,t){for(let a=0;a<e.length;a++)if(t(e[a]))return a;return}(l,e=>e.test(r)):function(e,t){for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&t(e[a]))return a;return}(l,e=>e.test(r));let c;c=e.valueCallback?e.valueCallback(o):o,c=a.valueCallback?a.valueCallback(c):c;return{value:c,rest:t.slice(r.length)}}}var Fe;const Ie={code:"en-US",formatDistance:(e,t,a)=>{let s;const n=Pe[e];return s="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",t.toString()),a?.addSuffix?a.comparison&&a.comparison>0?"in "+s:s+" ago":s},formatLong:$e,formatRelative:(e,t,a,s)=>De[e],localize:{ordinalNumber:(e,t)=>{const a=Number(e),s=a%100;if(s>20||s<10)switch(s%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},era:Te({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Te({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Te({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Te({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Te({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Fe={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,t={})=>{const a=e.match(Fe.matchPattern);if(!a)return null;const s=a[0],n=e.match(Fe.parsePattern);if(!n)return null;let i=Fe.valueCallback?Fe.valueCallback(n[0]):n[0];return i=t.valueCallback?t.valueCallback(i):i,{value:i,rest:e.slice(s.length)}}),era:Ae({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Ae({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Ae({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Ae({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Ae({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Re(e,t){return function(e,t,a){const s=Ne(),n=a?.locale??s.locale??Ie,i=ke(e,t);if(isNaN(i))throw new RangeError("Invalid time value");const r=Object.assign({},a,{addSuffix:a?.addSuffix,comparison:i});let l,o;i>0?(l=ve(t),o=ve(e)):(l=ve(e),o=ve(t));const c=_e(o,l),d=(be(o)-be(l))/1e3,m=Math.round((c-d)/60);let u;if(m<2)return a?.includeSeconds?c<5?n.formatDistance("lessThanXSeconds",5,r):c<10?n.formatDistance("lessThanXSeconds",10,r):c<20?n.formatDistance("lessThanXSeconds",20,r):c<40?n.formatDistance("halfAMinute",0,r):c<60?n.formatDistance("lessThanXMinutes",1,r):n.formatDistance("xMinutes",1,r):0===m?n.formatDistance("lessThanXMinutes",1,r):n.formatDistance("xMinutes",m,r);if(m<45)return n.formatDistance("xMinutes",m,r);if(m<90)return n.formatDistance("aboutXHours",1,r);if(m<1440){const e=Math.round(m/60);return n.formatDistance("aboutXHours",e,r)}if(m<2520)return n.formatDistance("xDays",1,r);if(m<ye){const e=Math.round(m/1440);return n.formatDistance("xDays",e,r)}if(m<86400)return u=Math.round(m/ye),n.formatDistance("aboutXMonths",u,r);if(u=Me(o,l),u<12){const e=Math.round(m/ye);return n.formatDistance("xMonths",e,r)}{const e=u%12,t=Math.trunc(u/12);return e<3?n.formatDistance("aboutXYears",t,r):e<9?n.formatDistance("overXYears",t,r):n.formatDistance("almostXYears",t+1,r)}}(e,Ce(e),t)}function ze({gameId:t,className:a=""}){const{user:s}=p(),[n,i]=h.useState([]),[r,l]=h.useState(""),[o,c]=h.useState(!0),[d,m]=h.useState(!1),[u,x]=h.useState(!1),[g,M]=h.useState(new Set),_=h.useRef(null),P=h.useRef(null),W=h.useCallback(()=>{_.current?.scrollIntoView({behavior:"smooth",block:"end"})},[]);h.useEffect(()=>{(async()=>{try{c(!0);const{data:e,error:a}=await f.from("chat_messages").select("\n            id,\n            game_id,\n            user_id,\n            message,\n            created_at,\n            users:user_id (\n              full_name,\n              username,\n              avatar_url\n            )\n          ").eq("game_id",t).order("created_at",{ascending:!0});if(a){const e=localStorage.getItem(`chat-${t}`);if(e){const t=JSON.parse(e);i(t)}}else{const t=e.map(e=>({id:e.id,game_id:e.game_id,user_id:e.user_id,message:e.message,created_at:e.created_at,user:{name:e.users?.full_name||e.users?.username||`Unknown User (${e.user_id.slice(0,8)})`,avatar:e.users?.avatar_url||""}}));i(t)}}catch(e){}finally{c(!1)}})()},[t]),h.useEffect(()=>{if(!t||!s)return;const e=f.channel(`game-chat-${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`game_id=eq.${t}`},async e=>{const{data:t,error:a}=await f.from("chat_messages").select("\n            id,\n            game_id,\n            user_id,\n            message,\n            created_at,\n            users:user_id (\n              full_name,\n              username,\n              avatar_url\n            )\n          ").eq("id",e.new.id).single();if(!a&&t){const e={id:t.id,game_id:t.game_id,user_id:t.user_id,message:t.message,created_at:t.created_at,user:{name:t.users?.full_name||t.users?.username||`Unknown User (${t.user_id.slice(0,8)})`,avatar:t.users?.avatar_url||""}};i(t=>t.some(t=>t.id===e.id)?t:[...t,e]),setTimeout(W,100)}}).on("presence",{event:"sync"},()=>{const t=e.presenceState(),a=new Set(Object.keys(t));M(a)}).on("presence",{event:"join"},({key:e})=>{M(t=>new Set([...t,e]))}).on("presence",{event:"leave"},({key:e})=>{M(t=>{const a=new Set(t);return a.delete(e),a})}).subscribe(async t=>{"SUBSCRIBED"===t&&(x(!0),await e.track({user_id:s.id,username:s.name,online_at:(new Date).toISOString()}))});return P.current=e,()=>{P.current&&P.current.unsubscribe()}},[t,s,W]),h.useEffect(()=>{W()},[n,W]);const $=async()=>{if(r.trim()&&s&&!d){m(!0);try{const{data:e,error:a}=await f.from("chat_messages").insert({game_id:t,user_id:s.id,message:r.trim()}).select("\n          id,\n          game_id,\n          user_id,\n          message,\n          created_at,\n          users:user_id (\n            full_name,\n            username,\n            avatar_url\n          )\n        ").single();if(a)throw a;const n={id:e.id,game_id:e.game_id,user_id:e.user_id,message:e.message,created_at:e.created_at,user:{name:e.users?.full_name||e.users?.username||s.name,avatar:e.users?.avatar_url||s.avatar||""}};i(e=>[...e,n]),l(""),setTimeout(W,100)}catch(e){alert("Failed to send message. Please try again.")}finally{m(!1)}}},D=h.useMemo(()=>{const e=[];return n.forEach(t=>{const a=e[e.length-1];a&&a.user_id===t.user_id?a.messages.push(t):e.push({messages:[t],user:t.user,user_id:t.user_id})}),e},[n]);return s?e.jsxs(j,{className:a,children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Game Chat",n.length>0&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",n.length," messages)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:N("w-2 h-2 rounded-full",u?"bg-green-500":"bg-gray-400")}),e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:g.size})]})]})}),e.jsxs(w,{className:"p-0",children:[e.jsxs("div",{className:"h-64 overflow-y-auto p-4 space-y-4",children:[o?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading messages..."})}):0===n.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Be the first to say something!"})]})}):D.map((t,a)=>e.jsx("div",{className:"space-y-1",children:t.messages.map((t,a)=>{const n=t.user_id===s.id,i=0===a;return e.jsxs("div",{className:N("flex gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",n?"flex-row-reverse":""),children:[i&&e.jsxs(b,{className:"w-8 h-8 flex-shrink-0",children:[t.user?.avatar&&e.jsx(k,{src:t.user.avatar}),e.jsx(C,{className:"text-xs",children:t.user?.name?.charAt(0)?.toUpperCase()||"U"})]}),!i&&e.jsx("div",{className:"w-8"}),e.jsxs("div",{className:N("flex-1 max-w-[70%]",n?"text-right":""),children:[i&&!n&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-1",children:[e.jsx("span",{className:"font-medium",children:t.user?.name||"Unknown"}),e.jsx("span",{className:"text-muted-foreground",children:Re(new Date(t.created_at),{addSuffix:!0})})]}),e.jsx("div",{className:N("rounded-xl px-3 py-2 text-sm w-fit",n?"bg-primary text-primary-foreground ml-auto":"bg-muted"),children:t.message}),n&&i&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:Re(new Date(t.created_at),{addSuffix:!0})})]})]},t.id)})},`group-${a}`)),e.jsx("div",{ref:_})]}),e.jsxs("div",{className:"border-t p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:r,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())},placeholder:u?"Type a message...":"Connecting...",disabled:d||!u,className:N("flex-1 rounded-full transition-all duration-300",r.trim()?"pr-12":"")}),r.trim()&&e.jsx(S,{onClick:$,disabled:!r.trim()||d||!u,size:"sm",className:"rounded-full aspect-square animate-in fade-in slide-in-from-right-2 duration-300",children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Press Enter to send â€¢ Shift+Enter for new line"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("div",{className:N("w-1.5 h-1.5 rounded-full",u?"bg-green-500":"bg-gray-400")}),u?"Connected":"Connecting..."]})]})]})]})]}):e.jsxs(j,{className:a,children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Game Chat"]})}),e.jsx(w,{children:e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Please sign in to join the chat"})})]})}function Oe({...a}){return e.jsx(t,{"data-slot":"dropdown-menu",...a})}function Ee({...t}){return e.jsx(a,{"data-slot":"dropdown-menu-trigger",...t})}function Ue({className:t,sideOffset:a=4,...i}){return e.jsx(s,{children:e.jsx(n,{"data-slot":"dropdown-menu-content",sideOffset:a,className:M("z-[99999] min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...i})})}function Ge({className:t,inset:a,variant:s="default",...n}){return e.jsx(i,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":s,className:M("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function Je({...t}){return e.jsx(r,{"data-slot":"dialog",...t})}function Le({...t}){return e.jsx(m,{"data-slot":"dialog-portal",...t})}function Ye({className:t,...a}){return e.jsx(u,{"data-slot":"dialog-overlay",className:M("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function qe({className:t,children:a,...s}){return e.jsxs(Le,{"data-slot":"dialog-portal",children:[e.jsx(Ye,{}),e.jsxs(l,{"data-slot":"dialog-content",className:M("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s,children:[a,e.jsxs(o,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(G,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function He({className:t,...a}){return e.jsx("div",{"data-slot":"dialog-header",className:M("flex flex-col gap-2 text-center sm:text-left",t),...a})}function Be({className:t,...a}){return e.jsx("div",{"data-slot":"dialog-footer",className:M("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function Xe({className:t,...a}){return e.jsx(c,{"data-slot":"dialog-title",className:M("text-lg leading-none font-semibold",t),...a})}function Ke({className:t,...a}){return e.jsx(d,{"data-slot":"dialog-description",className:M("text-muted-foreground text-sm",t),...a})}function Ve({isOpen:t,onClose:a,gameTitle:s,gameId:n,onJoinSuccess:i}){const{signUp:r,signInWithOAuth:l}=_(),[o,c]=h.useState("signup"),[d,m]=h.useState({name:"",email:"",phone:""}),[u,x]=h.useState(!1),[g,p]=h.useState("");if(!t)return null;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(y,{className:"text-lg",children:"signup"===o?`Join "${s}"`:"Check Your Email"}),e.jsx(S,{variant:"ghost",size:"icon",onClick:a,children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsx(w,{children:"signup"===o?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs(S,{variant:"outline",className:"w-full",onClick:()=>(async e=>{try{x(!0),await l(e,{pendingGameId:n}),q.success(`Signing in with ${e}...`),a()}catch(t){q.error(t.message||"Social login failed")}finally{x(!1)}})("google"),disabled:u,children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with email"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),x(!0),p("");try{await r(d.email,"temp-password-"+Date.now(),{name:d.name,email:d.email,phone:d.phone,pendingGameId:n}),c("verify"),q.success("Account created! Check your email to verify and join the game.")}catch(t){p(t.message)}finally{x(!1)}},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(z,{type:"text",placeholder:"Your name",value:d.name,onChange:e=>m(t=>({...t,name:e.target.value})),required:!0,className:"pl-10"}),e.jsx(J,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{type:"email",placeholder:"Email address",value:d.email,onChange:e=>m(t=>({...t,email:e.target.value})),required:!0,className:"pl-10"}),e.jsx(L,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{type:"tel",placeholder:"Phone (optional)",value:d.phone,onChange:e=>m(t=>({...t,phone:e.target.value})),className:"pl-10"}),e.jsx(Y,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]}),g&&e.jsx(P,{variant:"destructive",children:e.jsx(W,{children:g})}),e.jsx(S,{type:"submit",className:"w-full",disabled:u,children:u?"Creating Account...":"Join Game"})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"By joining, you agree to our Terms of Service and Privacy Policy"})]}):e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Check your email"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We sent a verification link to ",e.jsx("strong",{children:d.email})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:['Click the link to verify your account and automatically join "',s,'"']})]}),e.jsx(S,{variant:"outline",onClick:a,className:"w-full",children:"Got it"})]})})]})})}function Qe({game:t,isOpen:a,onClose:s}){const[n,i]=h.useState(!1);if(!a)return null;const r=`${window.location.origin}/public/game/${t.id}`,l=`Join me for ${t.sport} at ${t.location} on ${t.date}!`,o=async()=>{try{await navigator.clipboard.writeText(r),i(!0),q.success("Link copied to clipboard!"),setTimeout(()=>i(!1),2e3)}catch(e){q.error("Failed to copy link")}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Share Game"]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:t.title}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx($,{variant:"secondary",children:t.sport})}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:t.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:t.date})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:t.time})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.currentPlayers,"/",t.maxPlayers," players"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Public RSVP Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:r,readOnly:!0,className:"flex-1"}),e.jsx(S,{variant:"outline",size:"sm",onClick:o,className:n?"bg-green-50 text-green-700":"",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Anyone with this link can view game details and RSVP"})]}),e.jsx(R,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Share via"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(S,{variant:"outline",onClick:async()=>{if(navigator.share)try{await navigator.share({title:`Join ${t.title}`,text:l,url:r})}catch(e){}else o()},className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Share"]}),e.jsxs(S,{variant:"outline",onClick:()=>{const e=encodeURIComponent(`Join me for ${t.sport}!`),a=encodeURIComponent(`\nHi!\n\nI'm organizing a ${t.sport} game and would love for you to join:\n\nðŸ“ ${t.location}\nðŸ“… ${t.date} at ${t.time}\nðŸ’° ${t.cost||"Free"}\nðŸ‘¥ ${t.currentPlayers}/${t.maxPlayers} players\n\n${t.description?t.description+"\n\n":""}RSVP here: ${r}\n\nHope to see you there!\n    `.trim());window.open(`mailto:?subject=${e}&body=${a}`)},className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Email"]}),e.jsxs(S,{variant:"outline",onClick:()=>{const e=encodeURIComponent(`${l} RSVP: ${r}`);window.open(`sms:?body=${e}`)},className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"SMS"]}),e.jsxs(S,{variant:"outline",onClick:()=>{const e=encodeURIComponent(`${l} RSVP: ${r}`);window.open(`https://wa.me/?text=${e}`)},className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"WhatsApp"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:s,className:"flex-1",children:"Close"}),e.jsxs(S,{onClick:o,className:"flex-1",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Copy Link"]})]})]})]})})}function Ze({isOpen:t,onClose:a,gameId:s,gameTitle:n,players:i}){const{checkForNewAchievements:r}=function(){const{user:e}=p(),[t,a]=h.useState([]),[s,n]=h.useState(null),[i,r]=h.useState(!0);h.useEffect(()=>{e?.id&&(async()=>{try{r(!0);const[t,s]=await Promise.all([D.getUserAchievements(e.id),D.getUserStats(e.id)]);a(t),n(s)}catch(t){}finally{r(!1)}})()},[e?.id]);const l=e=>{q.success("ðŸŽ‰ Achievement Unlocked!",{description:`${e.icon} ${e.name} - ${e.description} (+${e.points} points)`,duration:6e3,action:{label:"View All",onClick:()=>{window.location.href="/profile?tab=achievements"}}})},o=(e,t)=>{const a="string"==typeof e.criteria?JSON.parse(e.criteria):e.criteria;let s=0,n=1;switch(a.type){case"game_count":n=a.count,s=Math.min(t.games_played,n);break;case"host_count":n=a.count,s=Math.min(t.games_hosted,n);break;case"play_time_minutes":n=a.count,s=Math.min(t.total_play_time_minutes,n);break;case"first_login":n=1,s=t.last_activity?1:0;break;default:n=1,s=0}return{progress:s,total:n,percentage:Math.round(s/n*100)}},c=e=>e>=200?{title:"Legend",icon:"ðŸ‘‘",color:"text-yellow-600",level:6}:e>=150?{title:"Champion",icon:"ðŸ†",color:"text-purple-600",level:5}:e>=100?{title:"Expert",icon:"â­",color:"text-blue-600",level:4}:e>=50?{title:"Rising Star",icon:"ðŸŒŸ",color:"text-green-600",level:3}:e>=25?{title:"Rookie",icon:"ðŸŽ¯",color:"text-orange-600",level:2}:{title:"Beginner",icon:"ðŸ”°",color:"text-gray-600",level:1},d=t.reduce((e,t)=>{const a=t.achievement||t;return e+(a?.points||0)},0),m=c(d);return{achievements:t,userStats:s,isLoading:i,totalScore:d,currentRank:m,checkForNewAchievements:async()=>{if(e?.id)try{const t=await D.checkAndAwardAchievements(e.id);if(t.length>0){t.forEach(e=>{l(e)});const s=await D.getUserAchievements(e.id);a(s)}}catch(t){}},showAchievementToast:l,getAchievementProgress:o,getAchievementRank:c,getNextAchievements:async()=>{if(!e?.id||!s)return[];try{const e=await D.getAllAchievements(),a=new Set(t.map(e=>e.achievement_id));return e.filter(e=>!a.has(e.id)&&e.is_active).map(e=>({...e,progress:o(e,s)})).sort((e,t)=>t.progress.percentage-e.progress.percentage).slice(0,3)}catch(a){return[]}}}}(),[l,o]=h.useState("game"),[c,d]=h.useState(!1),[m,u]=h.useState({overall:0,organization:0,skillLevel:0,fun:0,reviewText:"",wouldPlayAgain:!0,recommendToOthers:!0}),[x,g]=h.useState(i.map(e=>({playerId:e.id,skill:0,sportsmanship:0,communication:0,feedback:""}))),f=({rating:t,onRatingChange:a,label:s})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:"p-1 hover:scale-110 transition-transform",children:e.jsx(ee,{className:"w-6 h-6 "+(s<=t?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-400")})},s))})]}),y=(e,t,a)=>{g(s=>s.map(s=>s.playerId===e?{...s,[t]:a}:s))};return e.jsx(Je,{open:t,onOpenChange:a,children:e.jsxs(qe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(He,{children:[e.jsxs(Xe,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-primary"}),"Rate Your Experience"]}),e.jsxs(Ke,{children:["Help improve the community by rating ",n]})]}),"game"===l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"How was the game?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your feedback helps other players"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(f,{rating:m.overall,onRatingChange:e=>u(t=>({...t,overall:e})),label:"Overall Rating *"}),e.jsx(f,{rating:m.organization,onRatingChange:e=>u(t=>({...t,organization:e})),label:"Organization"}),e.jsx(f,{rating:m.skillLevel,onRatingChange:e=>u(t=>({...t,skillLevel:e})),label:"Skill Level Match"}),e.jsx(f,{rating:m.fun,onRatingChange:e=>u(t=>({...t,fun:e})),label:"Fun Factor"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Additional Comments"}),e.jsx(me,{placeholder:"Share your experience with other players...",value:m.reviewText,onChange:e=>u(t=>({...t,reviewText:e.target.value})),className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.wouldPlayAgain,onChange:e=>u(t=>({...t,wouldPlayAgain:e.target.checked})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"I'd play again"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.recommendToOthers,onChange:e=>u(t=>({...t,recommendToOthers:e.target.checked})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Recommend to others"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:a,className:"flex-1",children:"Skip"}),e.jsx(S,{onClick:async()=>{if(0!==m.overall)try{d(!0),await D.submitGameReview({gameId:s,overallRating:m.overall,organizationRating:m.organization||void 0,skillLevelRating:m.skillLevel||void 0,funRating:m.fun||void 0,reviewText:m.reviewText||void 0,wouldPlayAgain:m.wouldPlayAgain,recommendToOthers:m.recommendToOthers}),o("players")}catch(e){q.error("Failed to submit rating. Please try again.")}finally{d(!1)}else q.error("Please provide an overall rating")},disabled:c||0===m.overall,className:"flex-1",children:c?"Submitting...":"Next: Rate Players"})]})]}),"players"===l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Rate Your Fellow Players"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Optional but helps build a better community"})]}),e.jsx("div",{className:"space-y-6",children:i.map(t=>{const a=x.find(e=>e.playerId===t.id);return a?e.jsxs(j,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(b,{children:[t.avatar&&e.jsx(k,{src:t.avatar,alt:t.name}),e.jsx(C,{children:t.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.name}),t.isHost&&e.jsx($,{variant:"secondary",className:"text-xs",children:"Host"})]})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(f,{rating:a.skill,onRatingChange:e=>y(t.id,"skill",e),label:"Skill Level"}),e.jsx(f,{rating:a.sportsmanship,onRatingChange:e=>y(t.id,"sportsmanship",e),label:"Sportsmanship"}),e.jsx(f,{rating:a.communication,onRatingChange:e=>y(t.id,"communication",e),label:"Communication"})]}),e.jsx(me,{placeholder:"Optional feedback for this player...",value:a.feedback,onChange:e=>y(t.id,"feedback",e.target.value),className:"min-h-[60px]"})]})]},t.id):null})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:()=>o("complete"),className:"flex-1",children:"Skip Player Ratings"}),e.jsx(S,{onClick:async()=>{const e=x.filter(e=>e.skill>0&&e.sportsmanship>0&&e.communication>0);if(0!==e.length)try{d(!0),await Promise.all(e.map(e=>D.submitPlayerRating({gameId:s,ratedPlayerId:e.playerId,skillRating:e.skill,sportsmanshipRating:e.sportsmanship,communicationRating:e.communication,feedbackText:e.feedback||void 0}))),o("complete")}catch(t){q.error("Failed to submit player ratings. Please try again.")}finally{d(!1)}else o("complete")},disabled:c,className:"flex-1",children:c?"Submitting...":"Submit Ratings"})]})]}),"complete"===l&&e.jsxs("div",{className:"text-center space-y-6 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Z,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Thanks for your feedback!"}),e.jsx("p",{className:"text-muted-foreground",children:"Your ratings help make TribeUp better for everyone"})]}),e.jsx("div",{className:"bg-muted/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Check your profile for any new achievements!"})]})}),e.jsx(S,{onClick:async()=>{await r(),a()},className:"w-full",children:"Done"})]})]})})}class et{static API_KEY=T.get("openWeatherApiKey");static BASE_URL="https://api.openweathermap.org/data/2.5";static CONFIG={temperatureUnit:T.get("weatherTempUnit"),updateInterval:T.get("weatherUpdateInterval"),includeHourlyForecast:T.get("weatherIncludeHourly"),rainThreshold:T.get("weatherRainThreshold"),windThreshold:T.get("weatherWindThreshold")};static async getCurrentWeather(e,t){if(!this.API_KEY)return this.getMockWeatherData();try{const a=await fetch(`${this.BASE_URL}/weather?lat=${e}&lon=${t}&appid=${this.API_KEY}&units=imperial`);if(!a.ok)throw new Error(`Weather API error: ${a.status}`);const s=await a.json();return this.transformWeatherData(s)}catch(a){return this.getMockWeatherData()}}static async getGameWeather(e,t,a){if(!this.API_KEY)return this.getMockWeatherData();try{const s=parseFloat(e.toFixed(6)),n=parseFloat(t.toFixed(6)),i=await fetch(`${this.BASE_URL}/forecast?lat=${s}&lon=${n}&appid=${this.API_KEY}&units=imperial`);if(!i.ok)return await this.getCurrentWeather(s,n);const r=await i.json();if(!r.list||0===r.list.length)return await this.getCurrentWeather(s,n);const l=a.getTime(),o=l-72e5,c=l+72e5,d=r.list.filter(e=>{const t=1e3*e.dt;return t>=o&&t<=c});let m;m=d.length>0?d.reduce((e,t)=>Math.abs(1e3*t.dt-l)<Math.abs(1e3*e.dt-l)?t:e):r.list.reduce((e,t)=>Math.abs(1e3*t.dt-l)<Math.abs(1e3*e.dt-l)?t:e);const u=this.analyzeWeatherWindow(d,m);return this.transformWeatherData(m,u)}catch(s){return this.getMockWeatherData()}}static async getWeatherByZipcode(e,t){if(!this.API_KEY)return this.getMockWeatherData();try{const a=await fetch(`${this.BASE_URL}/forecast?zip=${e},US&appid=${this.API_KEY}&units=imperial`);if(!a.ok)throw new Error(`Weather API error: ${a.status}`);const s=await a.json(),n=t.getTime(),i=n-72e5,r=n+72e5,l=s.list.filter(e=>{const t=1e3*e.dt;return t>=i&&t<=r});let o;o=l.length>0?l.reduce((e,t)=>Math.abs(1e3*t.dt-n)<Math.abs(1e3*e.dt-n)?t:e):s.list.reduce((e,t)=>Math.abs(1e3*t.dt-n)<Math.abs(1e3*e.dt-n)?t:e);const c=this.analyzeWeatherWindow(l,o);return this.transformWeatherData(o,c)}catch(a){return null}}static extractZipcode(e){const t=e.match(/\b(\d{5}(?:-\d{4})?)\b/);return t?t[1].split("-")[0]:null}static analyzeWeatherWindow(e,t){if(0===e.length)return{alerts:[],windowSummary:""};const a=e.map(e=>e.main.temp),s=e.map(e=>e.weather[0].main),n=e.map(e=>e.rain?.["3h"]||e.snow?.["3h"]||0),i=Math.min(...a),r=Math.max(...a);a.reduce((e,t)=>e+t,0),a.length;const l=Math.max(...n),o=[];let c="";r-i>10&&o.push(`ðŸŒ¡ï¸ Temperature will vary ${Math.round(i)}Â°F to ${Math.round(r)}Â°F during game time`),l>.1&&o.push("ðŸŒ§ï¸ Possible precipitation during game window");const d=[...new Set(s)];return d.length>1&&o.push(`ðŸŒ¤ï¸ Weather conditions may change: ${d.join(", ")}`),e.length>1&&(c=`4-hour forecast: ${Math.round(i)}-${Math.round(r)}Â°F, ${d.join("/")}`),{alerts:o,windowSummary:c}}static transformWeatherData(e,t){const a=Math.round(e.main.temp),s=e.weather[0].main,n=e.weather[0].description,i=e.rain?.["1h"]||e.snow?.["1h"]||0,r=this.generateWeatherAlerts(s,a,i,e.wind.speed),l=t?[...r,...t.alerts]:r;return{temperature:a,condition:s,description:t?.windowSummary||this.capitalizeWords(n),humidity:e.main.humidity,windSpeed:Math.round(e.wind.speed),precipitation:i,icon:this.getWeatherIcon(s),isOutdoorFriendly:this.isOutdoorFriendly(s,a,i,e.wind.speed),alerts:l}}static isOutdoorFriendly(e,t,a,s){if(t<40||t>95)return!1;if(a>this.CONFIG.rainThreshold)return!1;if(s>this.CONFIG.windThreshold)return!1;return!["Thunderstorm","Tornado","Squall"].includes(e)}static generateWeatherAlerts(e,t,a,s){const n=[];return t<50?n.push("ðŸ§¥ Dress warmly - temperature below 50Â°F"):t>85&&n.push("â˜€ï¸ Stay hydrated - high temperature expected"),a>this.CONFIG.rainThreshold&&n.push("ðŸŒ§ï¸ Rain expected - consider indoor backup plan"),s>12&&n.push("ðŸ’¨ Windy conditions - secure loose items"),"Thunderstorm"===e&&n.push("âš¡ Thunderstorm warning - move indoors immediately"),n}static getWeatherIcon(e){return{Clear:"â˜€ï¸",Clouds:"â˜ï¸",Rain:"ðŸŒ§ï¸",Drizzle:"ðŸŒ¦ï¸",Thunderstorm:"â›ˆï¸",Snow:"â„ï¸",Mist:"ðŸŒ«ï¸",Fog:"ðŸŒ«ï¸",Haze:"ðŸŒ«ï¸"}[e]||"ðŸŒ¤ï¸"}static capitalizeWords(e){return e.replace(/\b\w/g,e=>e.toUpperCase())}static getMockWeatherData(){return{temperature:72,condition:"Clear",description:"Clear Sky",humidity:65,windSpeed:8,precipitation:0,icon:"â˜€ï¸",isOutdoorFriendly:!0,alerts:[]}}static isConfigured(){return!!this.API_KEY&&this.API_KEY.length>0}static getWeatherRecommendation(e){return e.isOutdoorFriendly?e.temperature<60?"Cool weather - dress in layers and bring warm clothing.":e.temperature>80?"Warm weather - bring water and sun protection.":"Great weather for outdoor activities!":"Weather conditions may not be ideal for outdoor activities. Consider rescheduling or moving indoors."}}function tt({game:t}){const[a,s]=h.useState(null),[n,i]=h.useState(!0);return h.useEffect(()=>{let e=!0;return(async()=>{try{let n=null;const i=new Date(`${t.date} ${t.time}`);if(t.latitude&&t.longitude)n=await et.getGameWeather(t.latitude,t.longitude,i);else if(t.location){const e="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ";try{const a=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(t.location)}&key=${e}`);if(a.ok){const e=await a.json();if("OK"===e.status&&e.results&&e.results.length>0){const{lat:t,lng:a}=e.results[0].geometry.location;n=await et.getGameWeather(t,a,i)}}}catch(a){}if(!n){const e=et.extractZipcode(t.location);e&&(n=await et.getWeatherByZipcode(e,i))}if(!n){const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(t.location)}&appid=***REMOVED***&units=imperial`);if(e.ok){const t=await e.json();n={temperature:Math.round(t.main.temp),condition:t.weather[0].main,description:t.weather[0].description,humidity:t.main.humidity,windSpeed:Math.round(t.wind.speed),precipitation:t.rain?.["1h"]||t.snow?.["1h"]||0,icon:"Clear"===t.weather[0].main?"â˜€ï¸":"Clouds"===t.weather[0].main?"â˜ï¸":"Rain"===t.weather[0].main?"ðŸŒ§ï¸":"ðŸŒ¤ï¸",isOutdoorFriendly:!0,alerts:[]}}}}if(!n||!e){if(e)throw new Error("No weather data available");return}s(n)}catch(a){try{const a=await fetch("https://api.openweathermap.org/data/2.5/weather?zip=10001,US&appid=***REMOVED***&units=imperial");if(!a.ok)throw new Error("Fallback weather failed");{const n=await a.json(),i=Math.round(n.main.temp),r=n.weather[0].main,l=n.weather[0].description;e&&s({temperature:i,condition:r,description:`${l.charAt(0).toUpperCase()+l.slice(1)} (nearby area)`,humidity:n.main.humidity,windSpeed:Math.round(n.wind.speed),precipitation:n.rain?.["1h"]||n.snow?.["1h"]||0,icon:"Clear"===r?"â˜€ï¸":"Clouds"===r?"â˜ï¸":"Rain"===r?"ðŸŒ§ï¸":"ðŸŒ¤ï¸",isOutdoorFriendly:i>40&&i<95,alerts:[`ðŸ“ Showing weather for nearby area - actual conditions at ${t.location||"game location"} may vary`]})}}catch(n){e&&s({temperature:72,condition:"Clear",description:"Weather data temporarily unavailable",humidity:65,windSpeed:8,precipitation:0,icon:"ðŸŒ¤ï¸",isOutdoorFriendly:!0,alerts:[`ðŸ”„ Weather service temporarily unavailable for ${t.location||"this location"}`]})}}e&&i(!1)})(),()=>{e=!1}},[t.latitude,t.longitude,t.location,t.date,t.time]),n?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading weather..."}):a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:a.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a.temperature,"Â°F"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.description})]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Humidity: ",a.humidity,"%"]}),e.jsxs("div",{children:["Wind: ",a.windSpeed," mph"]})]})]}),a.alerts&&a.alerts.length>0&&e.jsx("div",{className:"space-y-1",children:a.alerts.map((t,a)=>e.jsx("div",{className:"text-xs bg-yellow-50 text-yellow-800 p-2 rounded",children:t},a))}),e.jsx("div",{className:"text-xs text-muted-foreground",children:et.getWeatherRecommendation(a)})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Weather unavailable"})}function at(){const t=x(),{gameId:a}=g(),{user:s}=p(),{data:n,isLoading:i,error:r}=he(a||""),{data:l=[],isLoading:o,error:c}=xe(a||""),{toggleJoin:d,isLoading:m,getButtonText:u}=A(),[f,N]=h.useState(!1);h.useEffect(()=>{if(i||o){const e=setTimeout(()=>{N(!0)},15e3);return()=>clearTimeout(e)}N(!1)},[i,o]);const{navigateToUser:b}=ge(),[k,C]=h.useState(!1),[M,_]=h.useState(!1),[T,O]=h.useState(!1),[E,U]=h.useState(!1),[G,J]=h.useState(!1),[L,Y]=h.useState(!1),[H,V]=h.useState(!1),[Q,Z]=h.useState({title:"",description:"",location:"",date:"",time:"",duration:60,maxPlayers:0,cost:""}),[ve,ye]=h.useState(""),we=h.useMemo(()=>l&&n?l.map(e=>({...e,isHost:e.id===n?.creator_id})):[],[l,n?.creator_id]),Ne=h.useMemo(()=>n?pe(n.date,n.time):{label:"",aria:""},[n?.date,n?.time]),be=h.useMemo(()=>n?fe(n.date,n.time):{date:"",time:""},[n?.date,n?.time]),ke=!!n&&n.currentPlayers>=n.maxPlayers,Ce=n?n.tags:void 0,Se=s&&n&&(n.creatorId===s.id||n.createdBy===s.id);if(h.useMemo(()=>{if(!n)return!1;return new Date(`${n.date} ${n.time}`)<new Date},[n?.date,n?.time]),h.useMemo(()=>!(!s||!n)&&(n.isJoined||Se),[s,n?.isJoined,Se]),(i||o)&&!f)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading game details..."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"If this takes too long, try refreshing the page"})]})});if(f||r||c)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto text-muted-foreground mb-2"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Loading Issues"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:f?"The game is taking too long to load. This might be due to database connection issues.":"There was an error loading the game details."}),(r||c)&&e.jsxs("p",{className:"text-xs text-red-500 mb-4",children:["Error: ",r?.message||c?.message]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{onClick:()=>window.location.reload(),className:"w-full",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Refresh Page"]}),e.jsxs(S,{variant:"outline",onClick:()=>t("/"),className:"w-full",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]})});if(!n)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl mb-4",children:"Game not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The game you're looking for doesn't exist or has been removed."}),e.jsx(S,{onClick:()=>t("/"),children:"Go Home"})]})});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>{t(-1)},"aria-label":"Go back",children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsxs("div",{role:"text","aria-label":`Event: ${n.title}. ${Ne.aria}`,children:[e.jsx("h1",{className:"text-xl font-semibold line-clamp-2",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:async()=>{O(!0)},"data-action":"share","aria-label":"Share game",title:"Share game (U)",children:e.jsx(ie,{className:"w-5 h-5"})}),e.jsxs(Oe,{onOpenChange:e=>{},children:[e.jsx(Ee,{asChild:!0,children:e.jsx("div",{children:e.jsx(S,{variant:"ghost",size:"icon","aria-label":"Game options",onClick:e=>{e.stopPropagation()},style:{display:Se?"flex":"none"},children:e.jsx(re,{className:"w-5 h-5"})})})}),e.jsxs(Ue,{align:"end",className:"z-[99999] relative",children:[e.jsxs(Ge,{onClick:e=>{e.stopPropagation(),Z({title:n.title,description:n.description,location:n.location,date:n.date,time:n.time,duration:n.duration||60,maxPlayers:n.maxPlayers,cost:n.cost}),U(!0)},children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Edit Game"]}),e.jsxs(Ge,{onClick:e=>{e.stopPropagation(),J(!0)},className:"text-destructive focus:text-destructive",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel Game"]})]})]}),e.jsx(S,{variant:"ghost",size:"icon","aria-label":"Report game",children:e.jsx(ae,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"px-4 py-6 space-y-6",id:"main-content",children:[e.jsxs(j,{children:[n.imageUrl&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-video overflow-hidden rounded-t-lg",children:e.jsx(ue,{src:n.imageUrl,alt:`${n.sport} game`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx($,{className:`${n.sportColor} text-white border-none`,children:n.sport})})]}),!n.imageUrl&&e.jsx("div",{className:"p-4 border-b",children:e.jsx($,{className:`${n.sportColor} text-white border-none`,children:n.sport})}),e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:be.date}),e.jsx("div",{className:"text-sm text-muted-foreground",children:je(n.time)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:"2 hours"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Duration"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:n.cost}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cost"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:Array.isArray(Ce)&&Ce.map(t=>e.jsx($,{variant:"secondary",children:t},t))}),e.jsx(S,{onClick:async()=>{m||(s?d(n):_(!0))},disabled:!n.isJoined&&ke||m,className:"w-full h-12",variant:n.isJoined?"outline":"default","data-action":"join-game",title:(n.isJoined?"Leave":"Join")+" game (J)",children:m?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),n.isJoined?"Leaving...":"Joining..."]}):ke&&!n.isJoined?"Game is Full":s?u(n):"Join Game - Sign Up"})]})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Location"]})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("div",{children:n.location})}),e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:n.latitude&&n.longitude||n.location?e.jsx("iframe",{src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ&q=${n.latitude&&n.longitude?`${n.latitude},${n.longitude}`:encodeURIComponent(n.location)}&zoom=15`,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"rounded-lg",title:"Game location map"}):e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(B,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Map not available"})]})}),e.jsxs(S,{variant:"outline",className:"w-full",onClick:()=>{const e=n.location||"Location not specified",t=encodeURIComponent(e),a=`https://maps.google.com/maps?q=${t}&t=m&z=16`;try{if(navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/)){const e=`maps://maps.google.com/maps?q=${t}`;window.location.href=e,setTimeout(()=>{window.open(a,"_blank")},1e3)}else window.open(a,"_blank");q.success("Opening directions...")}catch(s){q.error("Failed to open directions")}},"data-action":"directions",title:"Get directions (L)",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Get Directions"]})]})})]}),(n.latitude&&n.longitude||n.location)&&e.jsxs(j,{children:[e.jsx(v,{children:e.jsx(y,{className:"flex items-center gap-2",children:"â˜€ï¸ Weather Forecast"})}),e.jsx(w,{children:e.jsx(tt,{game:n})})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsx(y,{children:"About This Game"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm leading-relaxed "+(k?"":"line-clamp-3"),children:n.description}),n.description.length>150&&e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>C(!k),className:"p-0 h-auto",children:k?"Show less":"Show more"}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2",children:"Requirements"}),e.jsx("ul",{className:"space-y-1",children:["Athletic shoes required","Bring water bottle","No experience necessary"].map((t,a)=>e.jsxs("li",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[e.jsx("span",{className:"w-1 h-1 bg-muted-foreground rounded-full mt-2 flex-shrink-0"}),t]},a))})]})]})})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsx(y,{children:"Game Host"})}),e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{userId:n.creatorId||n.creatorData?.id,src:n.creatorData?.avatar,alt:n.creatorData?.name||n.createdBy||"Unknown",size:"md"}),e.jsx("div",{children:e.jsx("button",{onClick:()=>b(n.creatorId||n.creatorData?.id),className:"hover:text-primary transition-colors cursor-pointer font-medium","data-action":"view-profile",children:n.creatorData?.name||n.createdBy||"Unknown"})})]})})})})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{children:["Players (",we.length,"/",n.maxPlayers,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Online now:"}),e.jsx(I,{roomName:`game-${a}`})]})]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:we.map((t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{userId:t.id,src:t.avatar,alt:t.name,size:"md"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{b(t.id)},className:"hover:text-primary transition-colors cursor-pointer font-medium","data-action":"view-profile",children:t.name}),t.isHost&&e.jsx($,{variant:"secondary",className:"text-xs px-2 py-0",children:"Host"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ee,{className:"w-3 h-3 fill-current text-warning"}),t.rating]})]})]})}),a<we.length-1&&e.jsx(R,{className:"mt-3"})]},t.id))})})]}),n.isJoined&&e.jsx(P,{className:"border-success text-success-foreground",children:e.jsx(W,{children:"You're joined! See you on the field!"})})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(ze,{gameId:a})}),e.jsx(Ve,{isOpen:M,onClose:()=>_(!1),gameTitle:n.title,gameId:n.id,onJoinSuccess:async()=>{_(!1),a&&n&&d(n)}}),e.jsx(Qe,{isOpen:T,onClose:()=>O(!1),game:n}),e.jsx(Je,{open:E,onOpenChange:U,children:e.jsxs(qe,{className:"sm:max-w-[425px]",children:[e.jsxs(He,{children:[e.jsx(Xe,{children:"Edit Game"}),e.jsx(Ke,{children:"Make changes to your game. Participants will be notified of any updates."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-title",className:"text-sm font-medium",children:"Title"}),e.jsx(z,{id:"edit-title",value:Q.title,onChange:e=>Z(t=>({...t,title:e.target.value})),placeholder:"Game title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-description",className:"text-sm font-medium",children:"Description"}),e.jsx(me,{id:"edit-description",value:Q.description,onChange:e=>Z(t=>({...t,description:e.target.value})),placeholder:"Game description",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-location",className:"text-sm font-medium",children:"Location"}),e.jsx(z,{id:"edit-location",value:Q.location,onChange:e=>Z(t=>({...t,location:e.target.value})),placeholder:"Game location"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-date",className:"text-sm font-medium",children:"Date"}),e.jsx(z,{id:"edit-date",type:"date",value:Q.date,onChange:e=>Z(t=>({...t,date:e.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-time",className:"text-sm font-medium",children:"Time"}),e.jsx(z,{id:"edit-time",type:"time",value:Q.time,onChange:e=>Z(t=>({...t,time:e.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-duration",className:"text-sm font-medium",children:"Duration (minutes)"}),e.jsx(z,{id:"edit-duration",type:"number",min:"15",max:"480",value:Q.duration,onChange:e=>Z(t=>({...t,duration:parseInt(e.target.value)||60})),placeholder:"60"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-maxPlayers",className:"text-sm font-medium",children:"Max Players"}),e.jsx(z,{id:"edit-maxPlayers",type:"number",min:"2",max:"50",value:Q.maxPlayers,onChange:e=>Z(t=>({...t,maxPlayers:parseInt(e.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-cost",className:"text-sm font-medium",children:"Cost"}),e.jsx(z,{id:"edit-cost",value:Q.cost,onChange:e=>Z(t=>({...t,cost:e.target.value})),placeholder:"FREE or $10"})]})]})]}),e.jsxs(Be,{children:[e.jsx(S,{variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(S,{onClick:async()=>{if(a){V(!0);try{await D.updateGame(a,Q),q.success("Game updated successfully"),U(!1),window.location.reload()}catch(e){q.error("Failed to update game",{description:e.message||"Please try again later"})}finally{V(!1)}}},disabled:H,children:H?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),e.jsx(Je,{open:G,onOpenChange:J,children:e.jsxs(qe,{className:"sm:max-w-[425px]",children:[e.jsxs(He,{children:[e.jsx(Xe,{children:"Cancel Game"}),e.jsx(Ke,{children:"This action cannot be undone. All participants will be notified of the cancellation."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"delete-reason",className:"text-sm font-medium",children:"Reason for cancellation (optional)"}),e.jsx(me,{id:"delete-reason",value:ve,onChange:e=>ye(e.target.value),placeholder:"Let participants know why the game is cancelled...",rows:3})]})}),e.jsxs(Be,{children:[e.jsx(S,{variant:"outline",onClick:()=>J(!1),children:"Keep Game"}),e.jsx(S,{variant:"destructive",onClick:async()=>{if(a){V(!0);try{await D.deleteGame(a,ve),q.success("Game cancelled successfully"),J(!1),t("/")}catch(e){q.error("Failed to cancel game",{description:e.message||"Please try again later"})}finally{V(!1)}}},disabled:H,children:H?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Cancelling..."]}):"Cancel Game"})]})]})}),e.jsx(Ze,{isOpen:L,onClose:()=>Y(!1),gameId:a,gameTitle:n?.title||"",players:we})]})}export{at as default};
//# sourceMappingURL=GameDetails-SJ9H3Lcz.js.map
