import{j as e}from"./ui-CuzVkv4o.js";import{r as m}from"./vendor-Dit9F4CM.js";import{u as x,Z as j,b,C as A,a as C,r as S,s as N,i as d}from"./index-D8qAyT0h.js";import{A as v,a as _}from"./alert-DZhQpE5q.js";import{C as y}from"./circle-check-big-CcC9bgFa.js";import{C as w}from"./circle-x-hnZfrz4q.js";function R(){const t=x(),[f]=j(),[l,i]=m.useState("loading"),[c,o]=m.useState("Processing authentication..."),{setUser:g}=b();return m.useEffect(()=>{(async()=>{try{const{data:n,error:u}=await N.auth.getSession();if(u){console.error("Auth callback error:",u),i("error"),o(u.message||"Authentication failed");return}if(!n.session?.user){i("error"),o("No user session found");return}const a=n.session.user;console.log("OAuth user authenticated:",a.id);let s=await d.getUserProfile(a.id);if(!s){console.log("Creating profile for OAuth user...");const r={email:a.email||"",name:a.user_metadata?.full_name||a.user_metadata?.name||a.email?.split("@")[0]||"User",username:a.user_metadata?.preferred_username||a.user_metadata?.user_name||a.email?.split("@")[0]||`user_${Math.random().toString(36).substring(2,10)}`,avatar:a.user_metadata?.avatar_url||a.user_metadata?.picture||"",bio:"",location:"",role:"user",selectedSports:[]};try{await d.createUserProfile(a.id,r),s=await d.getUserProfile(a.id)}catch(p){console.error("Error creating OAuth user profile:",p),s={id:a.id,email:a.email||"",name:r.name,username:r.username,avatar:r.avatar,bio:"",location:"",role:"user",preferences:{theme:"auto",highContrast:!1,largeText:!1,reducedMotion:!1,colorBlindFriendly:!1,notifications:{push:!0,email:!1,gameReminders:!0},privacy:{locationSharing:!0,profileVisibility:"public"},sports:[]}}}}g(s),i("success"),o("Authentication successful! Redirecting...");const h=localStorage.getItem("pendingGameJoin");if(h)localStorage.removeItem("pendingGameJoin"),setTimeout(()=>t(`/game/${h}`),1500);else if(s){const r=s.name&&s.username;setTimeout(r?()=>t("/"):()=>t("/onboarding"),1500)}else setTimeout(()=>t("/onboarding"),1500)}catch(n){console.error("Auth callback error:",n),i("error"),o("Authentication failed. Please try again."),setTimeout(()=>t("/auth"),3e3)}})()},[t,g,f]),e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx(A,{className:"w-full max-w-md",children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[l==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"lg"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Completing Sign In"}),e.jsx("p",{className:"text-muted-foreground",children:c})]}),l==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-12 h-12 text-green-500 mx-auto"}),e.jsx("h2",{className:"text-xl font-semibold text-green-700",children:"Success!"}),e.jsx("p",{className:"text-muted-foreground",children:c})]}),l==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-12 h-12 text-red-500 mx-auto"}),e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"Authentication Error"}),e.jsx(v,{variant:"destructive",children:e.jsx(_,{children:c})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecting to sign in page..."})]})]})})})})}export{R as default};
//# sourceMappingURL=AuthCallback-BWfnQCD9.js.map
