import{j as e}from"./ui-Cc4ivZpV.js";import{c as E,t as c,C as N,e as w,f as y,d as v,A as G,T as P,h as T,B as k,L,R as B}from"./index-BTbBTPOn.js";import{S as p}from"./switch-CGPWnDhI.js";import{B as U}from"./badge-Lbz0TZd7.js";import{r as m}from"./vendor-IUqyc6Bg.js";import{u as q}from"./useNotifications-BpWfpc0L.js";import{B as R}from"./bell-CkL26Ojn.js";import{C as M}from"./circle-x-BJsThwlF.js";import{M as D}from"./message-square-DyXAqNLl.js";import{C as W}from"./calendar-DKXGTeDy.js";import{U as K}from"./users-CcLZpR9v.js";import{M as _}from"./mail-YMuFR09K.js";import{T as O}from"./trophy-BnJ88XqE.js";import{C as I}from"./circle-check-big-B1Abu7xm.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],Y=E("bell-off",V);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],H=E("smartphone",z),J="BCmjGZmgUDGgJG3g5y8FPAGgGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGG";function Q(l={}){const{vapidPublicKey:n=J,autoSubscribe:a=!1,serviceWorkerUrl:o="/sw.js"}=l,[t,r]=m.useState({isSupported:!1,permission:"default",isSubscribed:!1,subscription:null,isLoading:!1,error:null}),[d,A]=m.useState(null),b=m.useCallback(()=>{const s="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;return r(i=>({...i,isSupported:s})),s},[]),j=m.useCallback(async()=>{if(!("serviceWorker"in navigator))return console.warn("Service workers not supported"),null;try{return console.log("Service worker registration skipped to prevent loading issues"),null}catch(s){return console.error("Service Worker registration failed:",s),r(i=>({...i,error:"Failed to register service worker"})),null}},[o]),x=m.useCallback(async()=>{if(!("Notification"in window))return r(s=>({...s,error:"Notifications not supported"})),"denied";try{const s=await Notification.requestPermission();switch(r(i=>({...i,permission:s})),s){case"granted":c.success("Notifications enabled!");break;case"denied":c.error("Notifications blocked. You can enable them in your browser settings.");break;case"default":c.info("Notification permission pending");break}return s}catch(s){return console.error("Permission request failed:",s),r(i=>({...i,error:"Failed to request permission"})),"denied"}},[]),f=m.useCallback(async()=>{if(!d)return c.error("Service worker not available"),null;if(t.permission!=="granted"&&await x()!=="granted")return null;r(s=>({...s,isLoading:!0,error:null}));try{const s=X(n),i=await d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s}),h={endpoint:i.endpoint,keys:{p256dh:S(i.getKey("p256dh")),auth:S(i.getKey("auth"))}};return await Z(h),r(F=>({...F,isSubscribed:!0,subscription:h,isLoading:!1})),c.success("Push notifications enabled!"),h}catch(s){return console.error("Push subscription failed:",s),r(i=>({...i,isLoading:!1,error:"Failed to subscribe to push notifications"})),c.error("Failed to enable push notifications"),null}},[d,t.permission,x,n]),u=m.useCallback(async()=>{if(!d)return!1;r(s=>({...s,isLoading:!0,error:null}));try{const s=await d.pushManager.getSubscription();return s&&(await s.unsubscribe(),t.subscription&&await $(t.subscription)),r(i=>({...i,isSubscribed:!1,subscription:null,isLoading:!1})),c.success("Push notifications disabled"),!0}catch(s){return console.error("Unsubscribe failed:",s),r(i=>({...i,isLoading:!1,error:"Failed to unsubscribe from push notifications"})),!1}},[d,t.subscription]),g=m.useCallback(async()=>{if(d)try{const s=await d.pushManager.getSubscription();if(s){const i={endpoint:s.endpoint,keys:{p256dh:S(s.getKey("p256dh")),auth:S(s.getKey("auth"))}};r(h=>({...h,isSubscribed:!0,subscription:i}))}else r(i=>({...i,isSubscribed:!1,subscription:null}))}catch(s){console.error("Failed to check subscription:",s)}},[d]),C=m.useCallback(async()=>{if(!t.isSubscribed||!t.subscription){c.error("Not subscribed to notifications");return}try{await fetch("/api/notifications/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:t.subscription,notification:{title:"Test Notification",body:"This is a test notification from TribeUp!",data:{type:"test",url:"/"}}})}),c.success("Test notification sent!")}catch(s){console.error("Failed to send test notification:",s),c.error("Failed to send test notification")}},[t.isSubscribed,t.subscription]);return m.useEffect(()=>{(async()=>{if(!b())return;"Notification"in window&&r(h=>({...h,permission:Notification.permission}));const i=await j();i&&(await g(),a&&Notification.permission==="granted"&&(await i.pushManager.getSubscription()||await f()))})()},[b,j,g,f,a]),{...t,requestPermission:x,subscribe:f,unsubscribe:u,sendTestNotification:C,serviceWorkerRegistration:d,canSubscribe:t.isSupported&&t.permission==="granted"&&!t.isSubscribed,shouldRequestPermission:t.isSupported&&t.permission==="default"}}function X(l){const n="=".repeat((4-l.length%4)%4),a=(l+n).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(a),t=new Uint8Array(o.length);for(let r=0;r<o.length;++r)t[r]=o.charCodeAt(r);return t}function S(l){const n=new Uint8Array(l);let a="";for(let o=0;o<n.byteLength;o++)a+=String.fromCharCode(n[o]);return window.btoa(a)}async function Z(l){console.log("Sending subscription to server:",l),await new Promise(n=>setTimeout(n,500))}async function $(l){console.log("Removing subscription from server:",l),await new Promise(n=>setTimeout(n,500))}function he(){const{isSupported:l,permission:n,isSubscribed:a,isLoading:o,error:t,canSubscribe:r,shouldRequestPermission:d,requestPermission:A,subscribe:b,unsubscribe:j,sendTestNotification:x}=Q(),{settings:f,updateSettings:u}=q(),g=()=>{switch(n){case"granted":return e.jsx(I,{className:"w-5 h-5 text-green-500"});case"denied":return e.jsx(M,{className:"w-5 h-5 text-red-500"});default:return e.jsx(P,{className:"w-5 h-5 text-yellow-500"})}},C=()=>{switch(n){case"granted":return"Notifications enabled";case"denied":return"Notifications blocked";default:return"Permission pending"}},s=async()=>{a?await j():r?await b():d&&await A()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Push Notifications"]})}),e.jsx(v,{className:"space-y-4",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g(),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:C()}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n==="granted"&&a&&"You'll receive notifications for important updates",n==="granted"&&!a&&"Click to enable push notifications",n==="denied"&&"Enable notifications in your browser settings",n==="default"&&"Click to enable notifications"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(U,{variant:"secondary",className:"bg-green-500/10 text-green-600",children:"Active"}),e.jsx(p,{checked:a,onCheckedChange:s,disabled:o||n==="denied"})]})]}),t&&e.jsxs(G,{variant:"destructive",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx(T,{children:t})]}),a&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Test Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Send a test notification to verify everything works"})]}),e.jsx(k,{variant:"outline",size:"sm",onClick:x,disabled:o,children:o?e.jsx(L,{size:"sm"}):"Send Test"})]})]}):e.jsxs(G,{children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx(T,{children:"Push notifications are not supported in your browser. Please use a modern browser like Chrome, Firefox, or Safari."})]})})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Notification Types"]})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"New Messages"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Get notified when someone sends you a message"})]})]}),e.jsx(p,{checked:f.messageNotifications,onCheckedChange:i=>u({messageNotifications:i})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Game Reminders"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Reminders before your games start"})]})]}),e.jsx(p,{checked:f.gameReminders,onCheckedChange:i=>u({gameReminders:i})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Game Updates"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"When someone joins or leaves your games"})]})]}),e.jsx(p,{checked:f.pushNotifications,onCheckedChange:i=>u({pushNotifications:i})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Email Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Weekly summary and important updates"})]})]}),e.jsx(p,{checked:f.emailNotifications,onCheckedChange:i=>u({emailNotifications:i})})]})]})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Sound & Vibration"]})}),e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Notification Sounds"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Play a sound when you receive notifications"})]}),e.jsx(p,{checked:f.soundEnabled,onCheckedChange:i=>u({soundEnabled:i})})]})})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(y,{children:"Quick Actions"})}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs(k,{variant:"outline",className:"w-full justify-start",onClick:()=>{u({pushNotifications:!0,messageNotifications:!0,gameReminders:!0,soundEnabled:!0}),c.success("All notifications enabled")},children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Enable All Notifications"]}),e.jsxs(k,{variant:"outline",className:"w-full justify-start",onClick:()=>{u({pushNotifications:!1,messageNotifications:!1,gameReminders:!1,soundEnabled:!1}),c.success("All notifications disabled")},children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Disable All Notifications"]}),e.jsxs(k,{variant:"outline",className:"w-full justify-start",onClick:()=>{u({pushNotifications:!0,emailNotifications:!1,gameReminders:!0,messageNotifications:!0,soundEnabled:!0}),c.success("Settings reset to defaults")},children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reset to Defaults"]})]})]}),n==="denied"&&e.jsxs(G,{children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Notifications are blocked"}),e.jsxs("div",{className:"text-sm",children:["To enable notifications:",e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Click the ðŸ”’ icon in your browser's address bar"}),e.jsx("li",{children:'Select "Notifications" and choose "Allow"'}),e.jsx("li",{children:"Refresh this page"})]})]})]})})]})]})}export{he as NotificationSettings,he as default};
//# sourceMappingURL=NotificationSettings-_rsMx0On.js.map
