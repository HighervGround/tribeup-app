{"version":3,"file":"AuthCallback-BWfnQCD9.js","sources":["../../src/components/AuthCallback.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { supabase } from '../lib/supabase';\nimport { SupabaseService } from '../lib/supabaseService';\nimport { useAppStore } from '../store/appStore';\nimport { LoadingSpinner } from './ui/loading-spinner';\nimport { Card, CardContent } from './ui/card';\nimport { Alert, AlertDescription } from './ui/alert';\nimport { CheckCircle, XCircle } from 'lucide-react';\n\nfunction AuthCallback() {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');\n  const [message, setMessage] = useState('Processing authentication...');\n  const { setUser } = useAppStore();\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        // Handle the OAuth callback\n        const { data, error } = await supabase.auth.getSession();\n        \n        if (error) {\n          console.error('Auth callback error:', error);\n          setStatus('error');\n          setMessage(error.message || 'Authentication failed');\n          return;\n        }\n\n        if (!data.session?.user) {\n          setStatus('error');\n          setMessage('No user session found');\n          return;\n        }\n\n        const user = data.session.user;\n        console.log('OAuth user authenticated:', user.id);\n\n        // Check if user profile exists\n        let userProfile = await SupabaseService.getUserProfile(user.id);\n        \n        if (!userProfile) {\n          // Create profile for OAuth user\n          console.log('Creating profile for OAuth user...');\n          \n          const profileData = {\n            email: user.email || '',\n            name: user.user_metadata?.full_name || user.user_metadata?.name || user.email?.split('@')[0] || 'User',\n            username: user.user_metadata?.preferred_username || \n                     user.user_metadata?.user_name || \n                     user.email?.split('@')[0] || \n                     `user_${Math.random().toString(36).substring(2, 10)}`,\n            avatar: user.user_metadata?.avatar_url || user.user_metadata?.picture || '',\n            bio: '',\n            location: '',\n            role: 'user' as const,\n            selectedSports: []\n          };\n\n          try {\n            await SupabaseService.createUserProfile(user.id, profileData);\n            userProfile = await SupabaseService.getUserProfile(user.id);\n          } catch (profileError) {\n            console.error('Error creating OAuth user profile:', profileError);\n            // Continue with basic user data\n            userProfile = {\n              id: user.id,\n              email: user.email || '',\n              name: profileData.name,\n              username: profileData.username,\n              avatar: profileData.avatar,\n              bio: '',\n              location: '',\n              role: 'user' as const,\n              preferences: {\n                theme: 'auto' as const,\n                highContrast: false,\n                largeText: false,\n                reducedMotion: false,\n                colorBlindFriendly: false,\n                notifications: {\n                  push: true,\n                  email: false,\n                  gameReminders: true,\n                },\n                privacy: {\n                  locationSharing: true,\n                  profileVisibility: 'public' as const,\n                },\n                sports: []\n              }\n            };\n          }\n        }\n\n        // Set user in app store\n        setUser(userProfile);\n        \n        setStatus('success');\n        setMessage('Authentication successful! Redirecting...');\n\n        // Check for pending game join\n        const pendingGameId = localStorage.getItem('pendingGameJoin');\n        if (pendingGameId) {\n          localStorage.removeItem('pendingGameJoin');\n          // Redirect to game page\n          setTimeout(() => navigate(`/game/${pendingGameId}`), 1500);\n        } else {\n          // Check if profile is complete\n          if (userProfile) {\n            const isComplete = userProfile.name && userProfile.username;\n            if (!isComplete) {\n              setTimeout(() => navigate('/onboarding'), 1500);\n            } else {\n              setTimeout(() => navigate('/'), 1500);\n            }\n          } else {\n            setTimeout(() => navigate('/onboarding'), 1500);\n          }\n        }\n\n      } catch (error) {\n        console.error('Auth callback error:', error);\n        setStatus('error');\n        setMessage('Authentication failed. Please try again.');\n        setTimeout(() => navigate('/auth'), 3000);\n      }\n    };\n\n    handleAuthCallback();\n  }, [navigate, setUser, searchParams]);\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center space-y-4\">\n            {status === 'loading' && (\n              <>\n                <LoadingSpinner size=\"lg\" />\n                <h2 className=\"text-xl font-semibold\">Completing Sign In</h2>\n                <p className=\"text-muted-foreground\">{message}</p>\n              </>\n            )}\n            \n            {status === 'success' && (\n              <>\n                <CheckCircle className=\"w-12 h-12 text-green-500 mx-auto\" />\n                <h2 className=\"text-xl font-semibold text-green-700\">Success!</h2>\n                <p className=\"text-muted-foreground\">{message}</p>\n              </>\n            )}\n            \n            {status === 'error' && (\n              <>\n                <XCircle className=\"w-12 h-12 text-red-500 mx-auto\" />\n                <h2 className=\"text-xl font-semibold text-red-700\">Authentication Error</h2>\n                <Alert variant=\"destructive\">\n                  <AlertDescription>{message}</AlertDescription>\n                </Alert>\n                <p className=\"text-sm text-muted-foreground\">\n                  Redirecting to sign in page...\n                </p>\n              </>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default AuthCallback;\n"],"names":["AuthCallback","navigate","useNavigate","searchParams","useSearchParams","status","setStatus","useState","message","setMessage","setUser","useAppStore","useEffect","data","error","supabase","user","userProfile","SupabaseService","profileData","profileError","pendingGameId","isComplete","jsx","Card","CardContent","jsxs","Fragment","LoadingSpinner","CheckCircle","XCircle","Alert","AlertDescription"],"mappings":"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"}