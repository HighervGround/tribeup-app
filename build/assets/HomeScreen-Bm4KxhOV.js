import{j as e}from"./ui-BV8hHw1h.js";import{r as s,c as t,e as a}from"./vendor-C07EgOn8.js";import{C as n,a as i,s as r,B as c,q as o,u as l}from"./index-Ce8SbcNa.js";import{g as m,u as d}from"./useGames-BZdFMUUb.js";import{t as u,T as p,R as h,e as g,f as x,Z as f,W as w,P as y,g as I}from"./utils-sWWcUyIH.js";import{u as N}from"./data-Bnv2A4Es.js";import{U as j}from"./UnifiedGameCard-Ozs7Vo2n.js";import{S as b}from"./skeleton-K6nR9njO.js";import"./ImageWithFallback-BTpYpxsE.js";import"./realtime-avatar-stack-CUpoEQ1q.js";import"./utils-BWjUwF_O.js";import"./tooltip-DvHS9-_8.js";function E(e,s,t,a){const n=v(t-e),i=v(a-s),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(v(e))*Math.cos(v(t))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function v(e){return e*(Math.PI/180)}function C(e,s="km"){return"mi"===s&&(e*=.621371),e<1?"km"===s?`${Math.round(1e3*e)}m`:`${Math.round(5280*e)}ft`:`${e.toFixed(1)}${s}`}function T(e={}){const{enableHighAccuracy:t=!0,timeout:a=1e4,maximumAge:n=6e4,watchPosition:i=!1,autoRequest:r=!0}=e,[c,o]=s.useState({currentLocation:null,isLoading:!1,error:null,permission:"unknown",lastUpdated:null}),l=s.useRef(null),m=s.useRef(!1),d="geolocation"in navigator,p=s.useCallback(async()=>{if(!d)return o(e=>({...e,permission:"denied",error:"Geolocation not supported"})),"denied";try{if("permissions"in navigator){const e=await navigator.permissions.query({name:"geolocation"});return o(s=>({...s,permission:e.state})),e.state}}catch(e){}return"unknown"},[d]),h=s.useCallback(async()=>d?m.current?null:(m.current=!0,o(e=>({...e,isLoading:!0,error:null})),new Promise(e=>{const s={enableHighAccuracy:t,timeout:a,maximumAge:n};navigator.geolocation.getCurrentPosition(s=>{const t={latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy,altitude:s.coords.altitude||void 0,heading:s.coords.heading||void 0,speed:s.coords.speed||void 0};o(e=>({...e,currentLocation:t,isLoading:!1,error:null,permission:"granted",lastUpdated:new Date})),m.current=!1,e(t)},s=>{let t="Failed to get location",a="unknown";switch(s.code){case s.PERMISSION_DENIED:t="Location access denied by user",a="denied",u.error("Please enable location access to find nearby games");break;case s.POSITION_UNAVAILABLE:t="Location information unavailable";break;case s.TIMEOUT:t="Location request timed out"}o(e=>({...e,isLoading:!1,error:t,permission:a})),m.current=!1,e(null)},s)})):(u.error("Location services are not supported by your browser"),null),[d,t,a,n]),g=s.useCallback(()=>{if(!d||null!==l.current)return;const e={enableHighAccuracy:t,timeout:a,maximumAge:n};l.current=navigator.geolocation.watchPosition(e=>{const s={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,altitude:e.coords.altitude||void 0,heading:e.coords.heading||void 0,speed:e.coords.speed||void 0};o(e=>({...e,currentLocation:s,lastUpdated:new Date}))},e=>{},e)},[d,t,a,n]),x=s.useCallback(()=>{null!==l.current&&(navigator.geolocation.clearWatch(l.current),l.current=null)},[]),f=s.useCallback(()=>{o(e=>({...e,currentLocation:null,error:null,lastUpdated:null}))},[]),w=s.useCallback((e,s="km")=>{if(!c.currentLocation)return null;const t=E(c.currentLocation.latitude,c.currentLocation.longitude,e.latitude,e.longitude);return"mi"===s?.621371*t:t},[c.currentLocation]),y=s.useCallback((e,s="km")=>{const t=w(e,s);return t?C(t,s):null},[w]),I=s.useCallback((e,s=5)=>{const t=w(e,"km");return null!==t&&t<=s},[w]);return s.useEffect(()=>(p(),r&&h(),i&&g(),()=>{x()}),[p,h,g,x,r,i]),{...c,isSupported:d,requestLocation:h,clearLocation:f,startWatching:g,stopWatching:x,getDistanceTo:w,getFormattedDistanceTo:y,isNearby:I,calculateDistance:(e,s,t,a)=>E(e,s,t,a),formatDistance:C,getBoundsFromCenter:e=>c.currentLocation?function(e,s){const t=s/111,a=s/(111*Math.cos(v(e.latitude)));return{north:e.latitude+t,south:e.latitude-t,east:e.longitude+a,west:e.longitude-a}}(c.currentLocation,e):null}}function S(){return e.jsx(n,{className:"w-full",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(b,{className:"h-5 w-3/4"}),e.jsx(b,{className:"h-4 w-1/2"})]}),e.jsx(b,{className:"h-8 w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(b,{className:"h-4 w-2/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(b,{className:"h-4 w-1/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(b,{className:"h-4 w-1/4"})]})]}),e.jsx(b,{className:"h-4 w-full"}),e.jsx(b,{className:"h-4 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(b,{className:"h-6 w-20"}),e.jsx(b,{className:"h-8 w-16"})]})]})})})}class L{static async runDiagnostics(){try{await this.testConnection(),await this.testAuth(),await this.testTableAccess(),await this.testRLSPolicies(),await this.testGameQuery()}catch(e){}}static async testConnection(){try{const e=performance.now(),{data:s,error:t}=await Promise.race([r.from("games").select("count",{count:"exact",head:!0}),new Promise((e,s)=>setTimeout(()=>s(new Error("Connection timeout")),5e3))]);performance.now()}catch(e){}}static async testAuth(){try{const e=performance.now(),{data:{user:s},error:t}=await Promise.race([r.auth.getUser(),new Promise((e,s)=>setTimeout(()=>s(new Error("Auth timeout")),3e3))]);performance.now()}catch(e){}}static async testTableAccess(){const e=["games","users","game_participants"];for(const t of e)try{const e=performance.now(),{data:s,error:a}=await Promise.race([r.from(t).select("*").limit(1),new Promise((e,s)=>setTimeout(()=>s(new Error(`${t} query timeout`)),8e3))]);performance.now();a&&("PGRST301"===a.code||a.message?.includes("timeout"))}catch(s){}}static async testRLSPolicies(){try{const{data:e,error:s}=await Promise.race([r.from("games").select("id, title").limit(1),new Promise((e,s)=>setTimeout(()=>s(new Error("Anonymous query timeout")),5e3))]),{data:{user:t}}=await r.auth.getUser();if(t){const{data:e,error:s}=await Promise.race([r.from("games").select("id, title").limit(1),new Promise((e,s)=>setTimeout(()=>s(new Error("Authenticated query timeout")),5e3))])}}catch(e){}}static async testGameQuery(){try{const{data:e}=await r.from("games").select("id").limit(1);if(!e||0===e.length)return;const s=e[0].id,t=performance.now(),{data:a,error:n}=await Promise.race([r.from("games").select("\n            *,\n            game_participants(user_id),\n            creator:users!creator_id(id, full_name, username, avatar_url)\n          ").eq("id",s).single(),new Promise((e,s)=>setTimeout(()=>s(new Error("Game query timeout")),1e4))]);performance.now();if(n){const{data:e,error:t}=await r.from("games").select("*").eq("id",s).single()}}catch(e){}}static generateRLSFix(){return'\n-- RLS Fix SQL for TribeUp\n-- Run this in your Supabase SQL Editor\n\n-- 1. Enable RLS on all tables\nALTER TABLE public.games ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.users ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.game_participants ENABLE ROW LEVEL SECURITY;\n\n-- 2. Games table policies (allow public read, authenticated write)\nDROP POLICY IF EXISTS "Games are viewable by everyone" ON public.games;\nCREATE POLICY "Games are viewable by everyone" ON public.games\n    FOR SELECT USING (true);\n\nDROP POLICY IF EXISTS "Users can create games" ON public.games;\nCREATE POLICY "Users can create games" ON public.games\n    FOR INSERT WITH CHECK (auth.uid() = creator_id);\n\nDROP POLICY IF EXISTS "Users can update their own games" ON public.games;\nCREATE POLICY "Users can update their own games" ON public.games\n    FOR UPDATE USING (auth.uid() = creator_id);\n\n-- 3. Users table policies (allow public read of basic info)\nDROP POLICY IF EXISTS "Users can view basic profile info" ON public.users;\nCREATE POLICY "Users can view basic profile info" ON public.users\n    FOR SELECT USING (true);\n\nDROP POLICY IF EXISTS "Users can update their own profile" ON public.users;\nCREATE POLICY "Users can update their own profile" ON public.users\n    FOR UPDATE USING (auth.uid() = id);\n\n-- 4. Game participants policies\nDROP POLICY IF EXISTS "Game participants are viewable by everyone" ON public.game_participants;\nCREATE POLICY "Game participants are viewable by everyone" ON public.game_participants\n    FOR SELECT USING (true);\n\nDROP POLICY IF EXISTS "Users can join games" ON public.game_participants;\nCREATE POLICY "Users can join games" ON public.game_participants\n    FOR INSERT WITH CHECK (auth.uid() = user_id);\n\nDROP POLICY IF EXISTS "Users can leave games" ON public.game_participants;\nCREATE POLICY "Users can leave games" ON public.game_participants\n    FOR DELETE USING (auth.uid() = user_id);\n\n-- 5. Fix any foreign key constraints that might cause issues\n-- (These should already exist, but just in case)\nALTER TABLE public.games \n    ADD CONSTRAINT games_creator_id_fkey \n    FOREIGN KEY (creator_id) REFERENCES public.users(id) \n    ON DELETE CASCADE;\n\nALTER TABLE public.game_participants \n    ADD CONSTRAINT game_participants_user_id_fkey \n    FOREIGN KEY (user_id) REFERENCES public.users(id) \n    ON DELETE CASCADE;\n\nALTER TABLE public.game_participants \n    ADD CONSTRAINT game_participants_game_id_fkey \n    FOREIGN KEY (game_id) REFERENCES public.games(id) \n    ON DELETE CASCADE;\n'}}"undefined"!=typeof window&&(window.supabaseDiagnostics=L,window.runDiagnostics=()=>L.runDiagnostics(),window.getRLSFix=()=>L.generateRLSFix());class k{static async runFullSpeedTest(){const e={connection:0,auth:0,simpleQuery:0,complexQuery:0,joinQuery:0,participantsQuery:0,usersQuery:0};try{const s=performance.now(),{count:t,error:a}=await r.from("games").select("*",{count:"exact",head:!0});if(e.connection=performance.now()-s,a)return e;const n=performance.now(),{data:{user:i},error:c}=await r.auth.getUser();e.auth=performance.now()-n;const o=performance.now(),{data:l,error:m}=await r.from("games").select("id, title, sport, date").limit(10);e.simpleQuery=performance.now()-o;const d=performance.now(),{data:u,error:p}=await r.from("games").select("\n          *,\n          game_participants(user_id),\n          creator:users!games_creator_id_fkey(id, full_name, username, avatar_url)\n        ").limit(10);e.complexQuery=performance.now()-d;const h=performance.now(),{data:g,error:x}=await r.from("game_participants").select("game_id, user_id").limit(50);e.participantsQuery=performance.now()-h;const f=performance.now(),{data:w,error:y}=await r.from("users").select("id, full_name, username").limit(10);return e.usersQuery=performance.now()-f,e.complexQuery,e.usersQuery,e.connection,e.simpleQuery<1e3&&e.complexQuery,e}catch(s){return e}}static async testNetworkLatency(){const e=[];for(let a=0;a<5;a++){const s=performance.now();try{await r.from("games").select("count",{count:"exact",head:!0});const t=performance.now()-s;e.push(t)}catch(t){}}const s=e.reduce((e,s)=>e+s,0)/e.length;return{min:Math.min(...e),max:Math.max(...e),avg:s}}static async testProblematicQuery(){const e=performance.now();try{const{data:s,error:t}=await r.from("games").select("\n          *,\n          game_participants(user_id),\n          creator:users!games_creator_id_fkey(id, full_name, username, avatar_url)\n        ").gte("date",(new Date).toISOString().split("T")[0]).order("date",{ascending:!0}).limit(50),a=performance.now()-e;return{duration:a,count:s?.length||0,error:t}}catch(s){return{duration:performance.now()-e,count:0,error:s}}}}"undefined"!=typeof window&&(window.supabaseSpeedTest=k,window.testSupabaseSpeed=()=>k.runFullSpeedTest(),window.testLatency=()=>k.testNetworkLatency(),window.testProblematicQuery=()=>k.testProblematicQuery());class O{static async runConnectionTest(){const e={basicFetch:!1,supabaseHealth:!1,dnsResolution:!1,networkLatency:0,corsIssues:!1,authEndpoint:!1,restEndpoint:!1};try{const t=performance.now();try{const s="https://alegufnopsminqcokelr.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ",n=await fetch(`${s}/rest/v1/`,{method:"HEAD",headers:{apikey:a}});e.basicFetch=n.ok,e.networkLatency=performance.now()-t}catch(s){e.basicFetch=!1}try{const s=new URL("https://alegufnopsminqcokelr.supabase.co");performance.now();await fetch(`https://${s.hostname}`,{method:"HEAD",mode:"no-cors"}),e.dnsResolution=!0}catch(s){e.dnsResolution=!1}try{const s="https://alegufnopsminqcokelr.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ",a=await fetch(`${s}/rest/v1/`,{headers:{apikey:t,Accept:"application/json"}});e.supabaseHealth=a.ok,a.ok}catch(s){e.supabaseHealth=!1}try{const s="https://alegufnopsminqcokelr.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ",a=await fetch(`${s}/rest/v1/games?select=count&limit=0`,{headers:{apikey:t,Accept:"application/json"}});e.corsIssues=!a.ok&&0===a.status}catch(s){e.corsIssues=s.message?.includes("CORS")||s.message?.includes("blocked")}try{const s="https://alegufnopsminqcokelr.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ",a=await fetch(`${s}/auth/v1/settings`,{headers:{apikey:t}});e.authEndpoint=a.ok}catch(s){e.authEndpoint=!1}try{const s="https://alegufnopsminqcokelr.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ",a=await fetch(`${s}/rest/v1/games?select=id&limit=1`,{headers:{apikey:t,Accept:"application/json"}});if(e.restEndpoint=a.ok,a.ok){await a.json()}}catch(s){e.restEndpoint=!1}this.provideRecommendations(e)}catch(s){}}static provideRecommendations(e){e.basicFetch,e.dnsResolution,e.supabaseHealth,e.corsIssues,e.networkLatency,e.authEndpoint,e.restEndpoint;[!e.basicFetch,!e.dnsResolution,!e.supabaseHealth,e.corsIssues,!e.restEndpoint].filter(Boolean).length}static async tryQuickFixes(){try{if("caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}}catch(s){}const e=`https://alegufnopsminqcokelr.supabase.co/rest/v1/?t=${Date.now()}`;try{await fetch(e,{headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ","Cache-Control":"no-cache",Pragma:"no-cache"}})}catch(s){}try{const e="https://alegufnopsminqcokelr.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsZWd1Zm5vcHNtaW5xY29rZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzUwMjIsImV4cCI6MjA3MTgxMTAyMn0.YgwFtX87MiSXA83DN2um0WP-1uYU6qsPXhwGmIWjadQ",t=await fetch(`${e}/rest/v1/games?select=count`,{method:"GET",headers:{apikey:s}});if(t.ok){await t.json()}}catch(s){}}}function R(){const t=N(),[a,n]=s.useState(!1),[i,r]=s.useState(null),[l,d]=s.useState(!1),[u,y]=s.useState(!1),[I,j]=s.useState(!1),b=(()=>{const e=t.getQueryCache().getAll(),s=e.filter(e=>e.queryKey.includes("games")||e.queryKey.some(e=>"string"==typeof e&&e.includes("game"))),a=s.filter(e=>e.isStale());return{total:e.length,gameQueries:s.length,staleGameQueries:a.length}})();return e.jsxs("div",{className:"fixed bottom-4 right-4 z-50 bg-card border rounded-lg p-4 shadow-lg max-w-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(p,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Cache Debug"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-3 space-y-1",children:[e.jsxs("div",{children:["Total Queries: ",b.total]}),e.jsxs("div",{children:["Game Queries: ",b.gameQueries]}),e.jsxs("div",{className:b.staleGameQueries>0?"text-yellow-600":"",children:["Stale Game Queries: ",b.staleGameQueries]}),i&&e.jsxs("div",{children:["Last Cleared: ",i.toLocaleTimeString()]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:async()=>{n(!0);try{t.removeQueries({predicate:e=>e.queryKey.includes("games")||e.queryKey.some(e=>"string"==typeof e&&e.includes("game"))}),await t.invalidateQueries({queryKey:m.all}),o.clearAllGameQueries(),r(new Date),setTimeout(()=>{t.refetchQueries({queryKey:m.lists()})},100)}catch(e){}finally{n(!1)}},disabled:a,className:"flex-1",children:[e.jsx(h,{className:"w-3 h-3 mr-1 "+(a?"animate-spin":"")}),"Clear Games"]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:async()=>{n(!0);try{t.clear(),localStorage.removeItem("supabase.auth.token"),sessionStorage.clear(),r(new Date),setTimeout(()=>{window.location.reload()},500)}catch(e){}finally{n(!1)}},disabled:a,className:"flex-1",children:[e.jsx(g,{className:"w-3 h-3 mr-1"}),"Clear All"]})]}),e.jsxs(c,{size:"sm",variant:"secondary",onClick:async()=>{d(!0);try{await L.runDiagnostics()}catch(e){}finally{d(!1)}},disabled:l,className:"w-full",children:[e.jsx(x,{className:"w-3 h-3 mr-1 "+(l?"animate-pulse":"")}),l?"Running Diagnostics...":"Diagnose DB Issues"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:async()=>{y(!0);try{await k.runFullSpeedTest()}catch(e){}finally{y(!1)}},disabled:u,className:"w-full",children:[e.jsx(f,{className:"w-3 h-3 mr-1 "+(u?"animate-bounce":"")}),u?"Testing Speed...":"Test Supabase Speed"]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:async()=>{j(!0);try{await O.runConnectionTest()}catch(e){}finally{j(!1)}},disabled:I,className:"w-full",children:[e.jsx(w,{className:"w-3 h-3 mr-1 "+(I?"animate-pulse":"")}),I?"Testing Connection...":"Fix Connection Issues"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:'"Fix Connection" will diagnose network/DNS/CORS issues'})]})}function A(){const n=a(),{user:i}=l(),{data:r=[],isLoading:o,error:m,refetch:u,isError:p,isPending:g,isRefetching:x}=d(),[f,w]=s.useState(!1),[b,E]=s.useState(!1),[v,C]=s.useState(!1);s.useMemo(()=>i?.preferences?.sports??[],[i]);const{currentLocation:L,permission:k,requestLocation:O,getFormattedDistanceTo:A}=T();!function(){const e=N(),a=s.useRef(null),[n,i]=t.useState(0),[r,c]=t.useState(!0);s.useEffect(()=>{},[e,n,r]),a.current}(),s.useEffect(()=>{if(o||g){const e=setTimeout(()=>{C(!0)},2e4);return()=>{clearTimeout(e),C(!1)}}},[o,g]);const F=s.useMemo(()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),t=r.filter(e=>new Date(e.date).toDateString()===s.toDateString()).length,a=L?r.filter(e=>{if(!e.latitude||!e.longitude)return!1;const s=A({latitude:e.latitude,longitude:e.longitude});return s&&parseFloat(s)<=10}).length:0,n=r.filter(e=>e.isJoined).length,c=r.filter(e=>e.creatorId===i?.id).length,o=[{name:"Profile Setup",tested:!(!i?.name||!i?.email)},{name:"Avatar Upload",tested:!!i?.avatar},{name:"Sport Preferences",tested:!!(i?.preferences?.sports&&i.preferences.sports.length>0)},{name:"Location Access",tested:"granted"===k},{name:"Join Game",tested:n>0},{name:"Create Game",tested:c>0},{name:"Game Discovery",tested:!0}],l=o.filter(e=>e.tested).length,m=o.length,d=n>0?Math.min(n+c,7):0,u=[];return"granted"!==k&&u.push("Enable Location Access"),i?.avatar||u.push("Upload Profile Photo"),0===c&&u.push("Create Your First Game"),0===n&&t>0&&u.push(`Join a Game (${t} today)`),i?.preferences?.sports&&0!==i.preferences.sports.length||u.push("Set Sport Preferences"),0===u.length&&u.push("Explore Game Details","Try Search/Filter","Check Settings"),{totalGames:r.length,gamesToday:t,gamesNearby:a,gamesJoined:n,gamesCreated:c,featuresTested:l,totalFeatures:m,testStreak:d,completionRate:Math.round(l/m*100),nextActions:u.slice(0,4)}},[r,i,L,k,A]),M=async()=>{if(!f){E(!1),w(!0);try{await u()}finally{w(!1)}}},P=r.map(e=>{const s=new Date(e.date),t=new Date,a=new Date(t);a.setDate(a.getDate()+1);let n="future",i=s.getTime();return s.toDateString()===t.toDateString()?(n="today",i=0):s.toDateString()===a.toDateString()&&(n="tomorrow",i=1),{...e,category:n,sortOrder:i,gameDate:s}}).sort((e,s)=>e.sortOrder!==s.sortOrder?e.sortOrder-s.sortOrder:e.gameDate.getTime()-s.gameDate.getTime());return!o&&!g||0!==r.length||v?(p||m||v)&&0===r.length?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-destructive text-lg font-semibold",children:v?"Loading Timeout":"Connection Error"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:v?"Games are taking too long to load. This might be a network or server issue.":m?.message||"Unable to load games. Please check your connection."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(c,{onClick:()=>{C(!1),E(!1),u()},children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Try Again"]}),e.jsx(c,{variant:"outline",onClick:()=>{localStorage.removeItem("supabase.auth.token"),window.location.reload()},children:"Clear Cache & Reload"})]})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:["undefined"!=typeof window&&("localhost"===window.location.hostname||p||v)&&e.jsx(R,{}),e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{onClick:()=>n("/create-game"),className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Upcoming Games"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:M,disabled:o,className:"hidden md:flex",children:[e.jsx(h,{className:"w-4 h-4 mr-2 "+(o?"animate-spin":"")}),"Refresh"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:M,disabled:o,className:"md:hidden","aria-label":"Refresh games",children:e.jsx(h,{className:"w-4 h-4 "+(o?"animate-spin":"")})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o?Array.from({length:6}).map((s,t)=>e.jsx(S,{},t)):P.map(s=>e.jsx("div",{children:e.jsx(j,{game:s,variant:"simple",onSelect:()=>{return e=s.id,void n(`/game/${e}`);var e}})},s.id))})]}),e.jsx("div",{className:"hidden lg:block lg:col-span-4",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Test Progress"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Features Tested"}),e.jsxs("span",{className:"font-semibold",children:[F.featuresTested,"/",F.totalFeatures]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Completion Rate"}),e.jsxs("span",{className:"font-semibold",children:[F.completionRate,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Games Today"}),e.jsx("span",{className:"font-semibold",children:F.gamesToday})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Games Nearby"}),e.jsxs("span",{className:"font-semibold",children:[L?F.gamesNearby:"?",!L&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:O,className:"ml-2 h-6 px-2 text-xs",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Enable"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Games Created"}),e.jsx("span",{className:"font-semibold",children:F.gamesCreated})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Test Streak"}),e.jsxs("span",{className:"font-semibold",children:[F.testStreak," days"]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Next Actions"}),e.jsx("div",{className:"space-y-2",children:F.nextActions.map((s,t)=>e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center",children:[e.jsx("span",{className:"mr-2",children:"â†’"}),s]},t))})]})]})}),e.jsx("div",{className:"lg:col-span-4 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-1 gap-4",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[F.completionRate,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Features Tested"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:F.testStreak}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Test Streak"})]})]})})]})})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading games..."}),e.jsx("p",{className:"text-xs text-muted-foreground/70",children:x?"Refreshing...":"This should only take a moment"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{C(!1),u()},children:"Refresh Now"})]})})}"undefined"!=typeof window&&(window.connectionTest=()=>O.runConnectionTest(),window.quickFixes=()=>O.tryQuickFixes());export{A as default};
//# sourceMappingURL=HomeScreen-Bm4KxhOV.js.map
