import{j as e}from"./ui-CuzVkv4o.js";import{r as x}from"./vendor-Dit9F4CM.js";import{s as y,e as G,C as _,a as U,u as P,b as A,B as b,R as S,P as I}from"./index-D8qAyT0h.js";import{u as R}from"./useGames-Dqy-33SO.js";import{U as T}from"./UnifiedGameCard-Bb209l3Z.js";import{S as t}from"./skeleton-BCmck_YG.js";import"./useMutation-B3okplaF.js";import"./ImageWithFallback-Ba8Vz0S_.js";import"./useGameJoinToggle-SYTumV-U.js";import"./dateUtils-But3d3jk.js";import"./calendar-Dnyhi4sR.js";import"./map-pin-C3Vnxafr.js";import"./users-D1NbQ7Un.js";function W(){const[v,w]=x.useState([]),[d,o]=x.useState(0),[D,j]=x.useState(!0);return x.useEffect(()=>{let r,u;return(async()=>{try{const{data:{user:i}}=await y.auth.getUser();if(!i){j(!1);return}const{data:l}=await y.from("users").select("full_name, username, avatar_url").eq("id",i.id).single();r=y.channel("online_users",{config:{presence:{key:i.id}}}),r.on("presence",{event:"sync"},()=>{const n=r.presenceState(),m=Object.keys(n).map(c=>{const h=n[c][0];return{id:c,name:h.name||"Anonymous",avatar:h.avatar,lastSeen:new Date().toISOString()}});w(m),o(m.length),j(!1)}).on("presence",{event:"join"},({key:n,newPresences:m})=>{console.log("User joined:",n,m)}).on("presence",{event:"leave"},({key:n,leftPresences:m})=>{console.log("User left:",n,m)}),await r.subscribe(async n=>{n==="SUBSCRIBED"&&(await r.track({user_id:i.id,name:l?.full_name||l?.username||"Anonymous",avatar:l?.avatar_url,online_at:new Date().toISOString()}),u=setInterval(async()=>{await r.track({user_id:i.id,name:l?.full_name||l?.username||"Anonymous",avatar:l?.avatar_url,online_at:new Date().toISOString()})},G.get("presenceHeartbeatInterval")))})}catch(i){console.error("Failed to initialize presence:",i),j(!1)}})(),()=>{u&&clearInterval(u),r&&r.unsubscribe()}},[]),{onlineUsers:v,onlineCount:d,isLoading:D}}function z(){return e.jsx(_,{className:"w-full",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(t,{className:"h-5 w-3/4"}),e.jsx(t,{className:"h-4 w-1/2"})]}),e.jsx(t,{className:"h-8 w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsx(t,{className:"h-4 w-2/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsx(t,{className:"h-4 w-1/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsx(t,{className:"h-4 w-1/4"})]})]}),e.jsx(t,{className:"h-4 w-full"}),e.jsx(t,{className:"h-4 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(t,{className:"h-6 w-20"}),e.jsx(t,{className:"h-8 w-16"})]})]})})})}function Y(){const v=P(),{user:w}=A(),{data:d=[],isLoading:o,error:D,refetch:j}=R(),[r,u]=x.useState(!1),[k,i]=x.useState(!1);x.useMemo(()=>w?.preferences?.sports??[],[w]);const{onlineCount:l,isLoading:n}=W(),m=s=>{v(`/game/${s}`)},c=x.useMemo(()=>{const s=new Date,a=new Date(s);a.setDate(s.getDate()-s.getDay()),a.setHours(0,0,0,0);const f=new Date(a);f.setDate(a.getDate()+6),f.setHours(23,59,59,999);const p=d.filter(N=>{const g=new Date(N.date);return g>=a&&g<=f}).length;return{totalGames:d.length,thisWeekGames:p,onlinePlayers:l}},[d,l]),h=async()=>{if(!r){i(!1),u(!0);try{await j()}finally{u(!1)}}},C=()=>{v("/create")},O=d.map(s=>{const a=new Date(s.date),f=new Date,p=new Date(f);p.setDate(p.getDate()+1);let N="future",g=a.getTime();return a.toDateString()===f.toDateString()?(N="today",g=0):a.toDateString()===p.toDateString()&&(N="tomorrow",g=1),{...s,category:N,sortOrder:g,gameDate:a}}).sort((s,a)=>s.sortOrder!==a.sortOrder?s.sortOrder-a.sortOrder:s.gameDate.getTime()-a.gameDate.getTime());return o&&d.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading games..."})]})}):k&&d.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"Connection issues detected. Showing sample games."}),e.jsxs(b,{onClick:h,variant:"outline",children:[e.jsx(S,{className:"w-4 h-4 mr-2"})," Try Again"]})]})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsx(b,{onClick:C,size:"icon",className:"md:hidden","aria-label":"Create new game",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6 lg:hidden",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c.totalGames}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Games"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:n?"...":c.onlinePlayers}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Players Online"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c.thisWeekGames}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"This Week"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Upcoming Games"}),e.jsxs(b,{variant:"outline",size:"sm",onClick:h,disabled:o,className:"hidden md:flex",children:[e.jsx(S,{className:`w-4 h-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:h,disabled:o,className:"md:hidden","aria-label":"Refresh games",children:e.jsx(S,{className:`w-4 h-4 ${o?"animate-spin":""}`})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o?Array.from({length:6}).map((s,a)=>e.jsx(z,{},a)):O.map(s=>e.jsx("div",{children:e.jsx(T,{game:s,variant:"simple",onSelect:()=>m(s.id)})},s.id))})]}),e.jsx("div",{className:"hidden lg:block lg:col-span-4",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Active Games"}),e.jsx("span",{className:"font-semibold",children:c.totalGames})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Players Online"}),e.jsx("span",{className:"font-semibold",children:n?"...":c.onlinePlayers})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"This Week"}),e.jsx("span",{className:"font-semibold",children:c.thisWeekGames})]})]})]})})]})})})}export{Y as default};
//# sourceMappingURL=HomeScreen-euQwT4JK.js.map
