{"version":3,"file":"useAchievements-CRX92kL2.js","sources":["../../src/hooks/useAchievements.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { toast } from 'sonner';\nimport { SupabaseService } from '../lib/supabaseService';\nimport { useAppStore } from '../store/appStore';\n\ninterface Achievement {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  category: string;\n  criteria: any;\n  points: number;\n  is_active: boolean;\n  created_at: string;\n}\n\ninterface UserAchievement {\n  id: string;\n  user_id: string;\n  achievement_id: string;\n  earned_at: string;\n  progress?: any;\n  achievement: Achievement;\n}\n\ninterface UserStats {\n  user_id: string;\n  games_played: number;\n  games_hosted: number;\n  total_play_time_minutes: number;\n  favorite_sport?: string;\n  last_activity: string;\n}\n\nexport function useAchievements() {\n  const { user } = useAppStore();\n  const [achievements, setAchievements] = useState<UserAchievement[]>([]);\n  const [userStats, setUserStats] = useState<UserStats | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Load user achievements and stats\n  useEffect(() => {\n    if (!user?.id) return;\n\n    const loadAchievements = async () => {\n      try {\n        setIsLoading(true);\n        const [achievementsData, statsData] = await Promise.all([\n          SupabaseService.getUserAchievements(user.id),\n          SupabaseService.getUserStats(user.id)\n        ]);\n        \n        setAchievements(achievementsData);\n        setUserStats(statsData);\n      } catch (error) {\n        console.error('Failed to load achievements:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadAchievements();\n  }, [user?.id]);\n\n  // Check for new achievements after game participation\n  const checkForNewAchievements = async () => {\n    if (!user?.id) return;\n\n    try {\n      const newAchievements = await SupabaseService.checkAndAwardAchievements(user.id);\n      \n      if (newAchievements.length > 0) {\n        // Show achievement toast notifications\n        newAchievements.forEach((achievement: Achievement) => {\n          showAchievementToast(achievement);\n        });\n\n        // Refresh achievements list\n        const updatedAchievements = await SupabaseService.getUserAchievements(user.id);\n        setAchievements(updatedAchievements);\n      }\n    } catch (error) {\n      console.error('Failed to check achievements:', error);\n    }\n  };\n\n  // Show achievement toast notification\n  const showAchievementToast = (achievement: Achievement) => {\n    toast.success(\n      `ðŸŽ‰ Achievement Unlocked!`,\n      {\n        description: `${achievement.icon} ${achievement.name} - ${achievement.description} (+${achievement.points} points)`,\n        duration: 6000,\n        action: {\n          label: 'View All',\n          onClick: () => {\n            // Navigate to achievements page\n            window.location.href = '/profile?tab=achievements';\n          }\n        }\n      }\n    );\n  };\n\n  // Calculate achievement progress\n  const getAchievementProgress = (achievement: Achievement, stats: UserStats) => {\n    const criteria = achievement.criteria;\n    let progress = 0;\n    let total = 1;\n\n    if (criteria.games_played) {\n      total = criteria.games_played;\n      progress = Math.min(stats.games_played, total);\n    } else if (criteria.games_hosted) {\n      total = criteria.games_hosted;\n      progress = Math.min(stats.games_hosted, total);\n    }\n\n    return { progress, total, percentage: Math.round((progress / total) * 100) };\n  };\n\n  // Get next achievements to unlock\n  const getNextAchievements = async () => {\n    if (!user?.id || !userStats) return [];\n\n    try {\n      const allAchievements = await SupabaseService.getAllAchievements();\n      const earnedIds = new Set(achievements.map(ua => ua.achievement_id));\n      \n      return allAchievements\n        .filter(achievement => !earnedIds.has(achievement.id) && achievement.is_active)\n        .map(achievement => ({\n          ...achievement,\n          progress: getAchievementProgress(achievement, userStats)\n        }))\n        .sort((a, b) => b.progress.percentage - a.progress.percentage)\n        .slice(0, 3); // Show top 3 closest achievements\n    } catch (error) {\n      console.error('Failed to get next achievements:', error);\n      return [];\n    }\n  };\n\n  return {\n    achievements,\n    userStats,\n    isLoading,\n    checkForNewAchievements,\n    showAchievementToast,\n    getAchievementProgress,\n    getNextAchievements\n  };\n}\n"],"names":["useAchievements","user","useAppStore","achievements","setAchievements","useState","userStats","setUserStats","isLoading","setIsLoading","useEffect","achievementsData","statsData","SupabaseService","error","checkForNewAchievements","newAchievements","achievement","showAchievementToast","updatedAchievements","toast","getAchievementProgress","stats","criteria","progress","total","allAchievements","earnedIds","ua","a","b"],"mappings":"+FAmCO,SAASA,GAAkB,CAChC,KAAM,CAAE,KAAAC,CAAA,EAASC,EAAA,EACX,CAACC,EAAcC,CAAe,EAAIC,EAAAA,SAA4B,CAAA,CAAE,EAChE,CAACC,EAAWC,CAAY,EAAIF,EAAAA,SAA2B,IAAI,EAC3D,CAACG,EAAWC,CAAY,EAAIJ,EAAAA,SAAS,EAAI,EAG/CK,EAAAA,UAAU,IAAM,CACd,GAAI,CAACT,GAAM,GAAI,QAEU,SAAY,CACnC,GAAI,CACFQ,EAAa,EAAI,EACjB,KAAM,CAACE,EAAkBC,CAAS,EAAI,MAAM,QAAQ,IAAI,CACtDC,EAAgB,oBAAoBZ,EAAK,EAAE,EAC3CY,EAAgB,aAAaZ,EAAK,EAAE,CAAA,CACrC,EAEDG,EAAgBO,CAAgB,EAChCJ,EAAaK,CAAS,CACxB,OAASE,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,CACrD,QAAA,CACEL,EAAa,EAAK,CACpB,CACF,GAEA,CACF,EAAG,CAACR,GAAM,EAAE,CAAC,EAGb,MAAMc,EAA0B,SAAY,CAC1C,GAAKd,GAAM,GAEX,GAAI,CACF,MAAMe,EAAkB,MAAMH,EAAgB,0BAA0BZ,EAAK,EAAE,EAE/E,GAAIe,EAAgB,OAAS,EAAG,CAE9BA,EAAgB,QAASC,GAA6B,CACpDC,EAAqBD,CAAW,CAClC,CAAC,EAGD,MAAME,EAAsB,MAAMN,EAAgB,oBAAoBZ,EAAK,EAAE,EAC7EG,EAAgBe,CAAmB,CACrC,CACF,OAASL,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,CACtD,CACF,EAGMI,EAAwBD,GAA6B,CACzDG,EAAM,QACJ,2BACA,CACE,YAAa,GAAGH,EAAY,IAAI,IAAIA,EAAY,IAAI,MAAMA,EAAY,WAAW,MAAMA,EAAY,MAAM,WACzG,SAAU,IACV,OAAQ,CACN,MAAO,WACP,QAAS,IAAM,CAEb,OAAO,SAAS,KAAO,2BACzB,CAAA,CACF,CACF,CAEJ,EAGMI,EAAyB,CAACJ,EAA0BK,IAAqB,CAC7E,MAAMC,EAAWN,EAAY,SAC7B,IAAIO,EAAW,EACXC,EAAQ,EAEZ,OAAIF,EAAS,cACXE,EAAQF,EAAS,aACjBC,EAAW,KAAK,IAAIF,EAAM,aAAcG,CAAK,GACpCF,EAAS,eAClBE,EAAQF,EAAS,aACjBC,EAAW,KAAK,IAAIF,EAAM,aAAcG,CAAK,GAGxC,CAAE,SAAAD,EAAU,MAAAC,EAAO,WAAY,KAAK,MAAOD,EAAWC,EAAS,GAAG,CAAA,CAC3E,EAwBA,MAAO,CACL,aAAAtB,EACA,UAAAG,EACA,UAAAE,EACA,wBAAAO,EACA,qBAAAG,EACA,uBAAAG,EACA,oBA5B0B,SAAY,CACtC,GAAI,CAACpB,GAAM,IAAM,CAACK,QAAkB,CAAA,EAEpC,GAAI,CACF,MAAMoB,EAAkB,MAAMb,EAAgB,mBAAA,EACxCc,EAAY,IAAI,IAAIxB,EAAa,IAAIyB,GAAMA,EAAG,cAAc,CAAC,EAEnE,OAAOF,EACJ,OAAOT,GAAe,CAACU,EAAU,IAAIV,EAAY,EAAE,GAAKA,EAAY,SAAS,EAC7E,IAAIA,IAAgB,CACnB,GAAGA,EACH,SAAUI,EAAuBJ,EAAaX,CAAS,CAAA,EACvD,EACD,KAAK,CAACuB,EAAGC,IAAMA,EAAE,SAAS,WAAaD,EAAE,SAAS,UAAU,EAC5D,MAAM,EAAG,CAAC,CACf,OAASf,EAAO,CACd,eAAQ,MAAM,mCAAoCA,CAAK,EAChD,CAAA,CACT,CACF,CASE,CAEJ"}