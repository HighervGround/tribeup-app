import{j as e}from"./ui-B4gQYcc6.js";import{e as s,j as a,r as t}from"./vendor-CTE-63Sz.js";import{u as r,C as i,a as n,L as o,s as l,S as m}from"./index-9DMutt-e.js";import{A as c,a as d}from"./alert-C3nsowWM.js";import{h as u,a3 as x}from"./utils-B5KmqWpW.js";import"./data-pHbUkPVm.js";function g(){const g=s(),[h]=a(),[f,p]=t.useState("loading"),[j,v]=t.useState("Processing authentication..."),{setUser:N}=r();return t.useEffect(()=>{(async()=>{try{const{data:s,error:a}=await l.auth.getSession();if(a)return p("error"),void v(a.message||"Authentication failed");if(!s.session?.user)return p("error"),void v("No user session found");const t=s.session.user;let r=await m.getUserProfile(t.id);if(!r){const s={email:t.email||"",name:t.user_metadata?.full_name||t.user_metadata?.name||t.email?.split("@")[0]||"User",username:t.user_metadata?.preferred_username||t.user_metadata?.user_name||t.email?.split("@")[0]||`user_${Math.random().toString(36).substring(2,10)}`,avatar:t.user_metadata?.avatar_url||t.user_metadata?.picture||"",bio:"",location:"",role:"user",selectedSports:[]};try{await m.createUserProfile(t.id,s),r=await m.getUserProfile(t.id)}catch(e){r={id:t.id,email:t.email||"",name:s.name,username:s.username,avatar:s.avatar,bio:"",location:"",role:"user",preferences:{theme:"auto",highContrast:!1,largeText:!1,reducedMotion:!1,colorBlindFriendly:!1,notifications:{push:!0,email:!1,gameReminders:!0},privacy:{locationSharing:!0,profileVisibility:"public"},sports:[]}}}}N(r),p("success"),v("Authentication successful! Redirecting...");const i=localStorage.getItem("pendingGameJoin");if(i)localStorage.removeItem("pendingGameJoin"),setTimeout(()=>g(`/game/${i}`),1500);else if(r){r.name&&r.username?setTimeout(()=>g("/"),1500):setTimeout(()=>g("/onboarding"),1500)}else setTimeout(()=>g("/onboarding"),1500)}catch(s){p("error"),v("Authentication failed. Please try again."),setTimeout(()=>g("/auth"),3e3)}})()},[g,N,h]),e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx(i,{className:"w-full max-w-md",children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:["loading"===f&&e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"lg"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Completing Sign In"}),e.jsx("p",{className:"text-muted-foreground",children:j})]}),"success"===f&&e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-12 h-12 text-green-500 mx-auto"}),e.jsx("h2",{className:"text-xl font-semibold text-green-700",children:"Success!"}),e.jsx("p",{className:"text-muted-foreground",children:j})]}),"error"===f&&e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-12 h-12 text-red-500 mx-auto"}),e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"Authentication Error"}),e.jsx(c,{variant:"destructive",children:e.jsx(d,{children:j})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecting to sign in page..."})]})]})})})})}export{g as default};
//# sourceMappingURL=AuthCallback-Bhja4sKD.js.map
