import{u as T,a as A,r as l,S as r,j as e,B as c,R as b}from"./index-zpPBrtBy.js";import{P as G}from"./plus-2Y_HJdlN.js";function u({game:a,onSelect:t}){return e.jsxs("div",{className:"bg-card rounded-lg p-4 border border-border cursor-pointer hover:shadow-md transition-shadow",onClick:t,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.sport})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-sm font-medium",children:a.cost}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.currentPlayers,"/",a.maxPlayers," players"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"ðŸ“"}),e.jsx("span",{children:a.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"ðŸ•’"}),e.jsxs("span",{children:[a.date," at ",a.time]})]}),a.distance&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"ðŸ“"}),e.jsx("span",{children:a.distance})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:a.description}),a.isJoined&&e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:"inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"Joined"})})]})}function D(){const a=T(),{games:t,setGames:m,isLoading:i,setLoading:o,user:v}=A(),[C,y]=l.useState(!1),[R,j]=l.useState(!1),f=l.useMemo(()=>v?.preferences?.sports??[],[v]),[n,w]=l.useState("all");l.useEffect(()=>{k()},[n]),l.useEffect(()=>{let s;const d=r.subscribeToAllGames(p=>{console.log("[Realtime] games INSERT received",p?.new?.id||""),clearTimeout(s),s=setTimeout(async()=>{try{const N=n==="recommended"?await r.getRecommendedGames(f):await r.getGames();await m(N)}catch(N){console.warn("Realtime refresh failed:",N)}},1e3)});return()=>{clearTimeout(s);try{d.unsubscribe()}catch{}}},[n,m,f.join?.("|")??""]),l.useEffect(()=>()=>{o(!1)},[o]);const k=async()=>{const s=`Home loadGames (${n}) ${Date.now()}-${Math.random().toString(36).slice(2,6)}`;j(!1),console.time?.(s);try{o(!0);const d=n==="recommended"?await r.getRecommendedGames(f):await r.getGames();await m(d)}catch(d){console.error("Error loading games:",d),j(!0),await m([])}finally{console.timeEnd?.(s),o(!1)}},g=async()=>{if(!C){j(!1),y(!0);try{await k()}finally{y(!1)}}},x=s=>{a(`/game/${s}`)},S=()=>{a("/create-game")},h=t.filter(s=>{const d=new Date(s.date),p=new Date;return d.toDateString()===p.toDateString()});return i&&t.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading games..."})]})}):R&&t.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"Connection issues detected. Showing sample games."}),e.jsxs(c,{onClick:g,variant:"outline",children:[e.jsx(b,{className:"w-4 h-4 mr-2"})," Try Again"]})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"px-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsx(c,{onClick:S,size:"icon","aria-label":"Create new game",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Games"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Players Online"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"This Week"})]})]})]}),h.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-lg mb-4",children:"Happening Soon"}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:h.map(s=>e.jsx("div",{className:"flex-shrink-0 w-72",children:e.jsx(u,{game:s,onSelect:()=>x(s.id)})},s.id))})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"All Games"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:g,disabled:i,"aria-label":"Refresh games",children:e.jsx(b,{className:`w-4 h-4 ${i?"animate-spin":""}`})})]}),e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsx("div",{children:e.jsx(u,{game:s,onSelect:()=>x(s.id)})},s.id))})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-muted rounded-md p-1 flex",children:[e.jsx("button",{className:`px-3 py-1 text-sm rounded ${n==="recommended"?"bg-background shadow font-medium":"text-muted-foreground"}`,onClick:()=>w("recommended"),children:"Recommended"}),e.jsx("button",{className:`px-3 py-1 text-sm rounded ${n==="all"?"bg-background shadow font-medium":"text-muted-foreground"}`,onClick:()=>w("all"),children:"All"})]}),e.jsxs(c,{onClick:S,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Create Game"]})]})]}),h.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Happening Today"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(s=>e.jsx(u,{game:s,onSelect:()=>x(s.id)},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:n==="recommended"?"Recommended For You":"All Games"}),e.jsxs(c,{variant:"outline",onClick:g,disabled:i,children:[e.jsx(b,{className:`w-4 h-4 mr-2 ${i?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(s=>e.jsx("div",{children:e.jsx(u,{game:s,onSelect:()=>x(s.id)})},s.id))})]}),e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Active Games"}),e.jsx("span",{className:"font-semibold",children:t.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Players Online"}),e.jsx("span",{className:"font-semibold",children:"0"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"This Week"}),e.jsx("span",{className:"font-semibold",children:"0"})]})]})]})})]})})})]})}export{D as HomeScreen};
//# sourceMappingURL=HomeScreen-B6lEr-jX.js.map
