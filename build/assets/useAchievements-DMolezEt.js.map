{"version":3,"file":"useAchievements-DMolezEt.js","sources":["../../src/hooks/useAchievements.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { toast } from 'sonner';\nimport { SupabaseService } from '../lib/supabaseService';\nimport { useAppStore } from '../store/appStore';\n\ninterface Achievement {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  category: string;\n  criteria: any;\n  points: number;\n  is_active: boolean;\n  created_at: string;\n}\n\ninterface UserAchievement {\n  id: string;\n  user_id: string;\n  achievement_id: string;\n  earned_at: string;\n  progress?: any;\n  achievement: Achievement;\n}\n\ninterface UserStats {\n  user_id: string;\n  games_played: number;\n  games_hosted: number;\n  total_play_time_minutes: number;\n  favorite_sport?: string;\n  last_activity: string;\n}\n\nexport function useAchievements() {\n  const { user } = useAppStore();\n  const [achievements, setAchievements] = useState<UserAchievement[]>([]);\n  const [userStats, setUserStats] = useState<UserStats | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Load user achievements and stats\n  useEffect(() => {\n    if (!user?.id) return;\n\n    const loadAchievements = async () => {\n      try {\n        setIsLoading(true);\n        const [achievementsData, statsData] = await Promise.all([\n          SupabaseService.getUserAchievements(user.id),\n          SupabaseService.getUserStats(user.id)\n        ]);\n        \n        setAchievements(achievementsData);\n        setUserStats(statsData);\n      } catch (error) {\n        console.error('Failed to load achievements:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadAchievements();\n  }, [user?.id]);\n\n  // Check for new achievements after game participation\n  const checkForNewAchievements = async () => {\n    if (!user?.id) return;\n\n    try {\n      const newAchievements = await SupabaseService.checkAndAwardAchievements(user.id);\n      \n      if (newAchievements.length > 0) {\n        // Show achievement toast notifications\n        newAchievements.forEach((achievement: Achievement) => {\n          showAchievementToast(achievement);\n        });\n\n        // Refresh achievements list\n        const updatedAchievements = await SupabaseService.getUserAchievements(user.id);\n        setAchievements(updatedAchievements);\n      }\n    } catch (error) {\n      console.error('Failed to check achievements:', error);\n    }\n  };\n\n  // Show achievement toast notification\n  const showAchievementToast = (achievement: Achievement) => {\n    toast.success(\n      `ðŸŽ‰ Achievement Unlocked!`,\n      {\n        description: `${achievement.icon} ${achievement.name} - ${achievement.description} (+${achievement.points} points)`,\n        duration: 6000,\n        action: {\n          label: 'View All',\n          onClick: () => {\n            // Navigate to achievements page\n            window.location.href = '/profile?tab=achievements';\n          }\n        }\n      }\n    );\n  };\n\n  // Calculate achievement progress\n  const getAchievementProgress = (achievement: Achievement, stats: UserStats) => {\n    const criteria = achievement.criteria;\n    let progress = 0;\n    let total = 1;\n\n    if (criteria.games_played) {\n      total = criteria.games_played;\n      progress = Math.min(stats.games_played, total);\n    } else if (criteria.games_hosted) {\n      total = criteria.games_hosted;\n      progress = Math.min(stats.games_hosted, total);\n    }\n\n    return { progress, total, percentage: Math.round((progress / total) * 100) };\n  };\n\n  // Get next achievements to unlock\n  const getNextAchievements = async () => {\n    if (!user?.id || !userStats) return [];\n\n    try {\n      const allAchievements = await SupabaseService.getAllAchievements();\n      const earnedIds = new Set(achievements.map(ua => ua.achievement_id));\n      \n      return allAchievements\n        .filter(achievement => !earnedIds.has(achievement.id) && achievement.is_active)\n        .map(achievement => ({\n          ...achievement,\n          progress: getAchievementProgress(achievement, userStats)\n        }))\n        .sort((a, b) => b.progress.percentage - a.progress.percentage)\n        .slice(0, 3); // Show top 3 closest achievements\n    } catch (error) {\n      console.error('Failed to get next achievements:', error);\n      return [];\n    }\n  };\n\n  return {\n    achievements,\n    userStats,\n    isLoading,\n    checkForNewAchievements,\n    showAchievementToast,\n    getAchievementProgress,\n    getNextAchievements\n  };\n}\n"],"names":["useAchievements","user","useAppStore","achievements","setAchievements","useState","userStats","setUserStats","isLoading","setIsLoading","useEffect","id","async","achievementsData","statsData","Promise","all","SupabaseService","getUserAchievements","getUserStats","error","loadAchievements","showAchievementToast","achievement","toast","success","description","icon","name","points","duration","action","label","onClick","window","location","href","getAchievementProgress","stats","criteria","progress","total","games_played","Math","min","games_hosted","percentage","round","checkForNewAchievements","newAchievements","checkAndAwardAchievements","length","forEach","updatedAchievements","getNextAchievements","allAchievements","getAllAchievements","earnedIds","Set","map","ua","achievement_id","filter","has","is_active","sort","a","b","slice"],"mappings":"2HAmCO,SAASA,IACd,MAAMC,KAAEA,GAASC,KACVC,EAAcC,GAAmBC,EAAAA,SAA4B,KAC7DC,EAAWC,GAAgBF,EAAAA,SAA2B,OACtDG,EAAWC,GAAgBJ,EAAAA,UAAS,GAG3CK,EAAAA,UAAU,KACR,IAAKT,GAAMU,GAAI,OAEUC,WACvB,IACEH,GAAa,GACb,MAAOI,EAAkBC,SAAmBC,QAAQC,IAAI,CACtDC,EAAgBC,oBAAoBjB,EAAKU,IACzCM,EAAgBE,aAAalB,EAAKU,MAGpCP,EAAgBS,GAChBN,EAAaO,EACf,OAASM,GAET,CAAA,QACEX,GAAa,EACf,GAGFY,IACC,CAACpB,GAAMU,KAGV,MAsBMW,EAAwBC,IAC5BC,EAAMC,QACJ,2BACA,CACEC,YAAa,GAAGH,EAAYI,QAAQJ,EAAYK,UAAUL,EAAYG,iBAAiBH,EAAYM,iBACnGC,SAAU,IACVC,OAAQ,CACNC,MAAO,WACPC,QAAS,KAEPC,OAAOC,SAASC,KAAO,iCAQ3BC,EAAyB,CAACd,EAA0Be,KACxD,MAAMC,EAAWhB,EAAYgB,SAC7B,IAAIC,EAAW,EACXC,EAAQ,EAUZ,OARIF,EAASG,cACXD,EAAQF,EAASG,aACjBF,EAAWG,KAAKC,IAAIN,EAAMI,aAAcD,IAC/BF,EAASM,eAClBJ,EAAQF,EAASM,aACjBL,EAAWG,KAAKC,IAAIN,EAAMO,aAAcJ,IAGnC,CAAED,WAAUC,QAAOK,WAAYH,KAAKI,MAAOP,EAAWC,EAAS,OAyBxE,MAAO,CACLtC,eACAG,YACAE,YACAwC,wBAlF8BpC,UAC9B,GAAKX,GAAMU,GAEX,IACE,MAAMsC,QAAwBhC,EAAgBiC,0BAA0BjD,EAAKU,IAE7E,GAAIsC,EAAgBE,OAAS,EAAG,CAE9BF,EAAgBG,QAAS7B,IACvBD,EAAqBC,KAIvB,MAAM8B,QAA4BpC,EAAgBC,oBAAoBjB,EAAKU,IAC3EP,EAAgBiD,EAClB,CACF,OAASjC,GAET,GAiEAE,uBACAe,yBACAiB,oBA5B0B1C,UAC1B,IAAKX,GAAMU,KAAOL,QAAkB,GAEpC,IACE,MAAMiD,QAAwBtC,EAAgBuC,qBACxCC,EAAY,IAAIC,IAAIvD,EAAawD,IAAIC,GAAMA,EAAGC,iBAEpD,OAAON,EACJO,OAAOvC,IAAgBkC,EAAUM,IAAIxC,EAAYZ,KAAOY,EAAYyC,WACpEL,IAAIpC,IAAA,IACAA,EACHiB,SAAUH,EAAuBd,EAAajB,MAE/C2D,KAAK,CAACC,EAAGC,IAAMA,EAAE3B,SAASM,WAAaoB,EAAE1B,SAASM,YAClDsB,MAAM,EAAG,EACd,OAAShD,GAEP,MAAO,EACT,GAYJ"}