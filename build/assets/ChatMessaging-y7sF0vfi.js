import{c as F,j as e,h as W,r,t as b,u as Y,k as J,l as H,g as q,B as M,S as G}from"./index-Cc4LGJhl.js";import{I as Q}from"./input-Cimo5Sw3.js";import{A as I,a as V}from"./avatar-57gEUNAQ.js";import{B as K}from"./badge-BZqIAurU.js";import{N as X}from"./empty-state-czLPiWRX.js";import{u as Z}from"./useDeepLinks-CBixCW8v.js";import{u as ee,P as se}from"./useKeyboardShortcuts-BjYqHNiJ.js";import{A as te}from"./arrow-left-B4jFT5KQ.js";import{K as B}from"./keyboard-q1eWkVZ_.js";import"./index-LLE0TcD7.js";import"./index-sz72u-6r.js";import"./index-BCKr6HAX.js";import"./bell-cACtwJAW.js";import"./calendar-y8SxkHJ-.js";import"./message-square-D-UZNuhx.js";import"./circle-check-big-RN8dYQhv.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],re=F("ellipsis-vertical",ne);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ie=F("send",ae);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],oe=F("video",ce);function _({className:o,variant:l="default",animation:i="pulse",width:f,height:y}){const S="bg-muted animate-pulse",h={default:"rounded-md",circular:"rounded-full",rectangular:"rounded-none",text:"rounded-sm h-4"},u={pulse:"animate-pulse",wave:"loading",none:""},p={width:f||void 0,height:y||void 0};return e.jsx("div",{className:W(S,h[l],u[i],o),style:p,"aria-label":"Loading...",role:"status"})}function le({isOwn:o=!1}){return e.jsxs("div",{className:`flex gap-3 ${o?"justify-end":"justify-start"}`,children:[!o&&e.jsx(_,{variant:"circular",className:"h-8 w-8"}),e.jsxs("div",{className:`max-w-xs ${o?"order-first":""}`,children:[!o&&e.jsx(_,{className:"h-3 w-16 mb-1"}),e.jsx(_,{className:`h-10 ${o?"w-32":"w-40"} rounded-2xl`})]})]})}function de({url:o="",chatId:l,userId:i,userName:f,autoConnect:y=!0,retryInterval:S=3e3,maxRetries:h=5}){const[u,p]=r.useState({isConnected:!1,isConnecting:!1,error:null,lastPing:null}),[w,n]=r.useState([]),[m,U]=r.useState(new Set),[$,C]=r.useState(new Set),x=r.useRef(null),R=r.useRef(0),j=r.useRef(null),D=r.useRef(null),g=r.useRef(null);r.useCallback(t=>{switch(t.type){case"message":n(c=>[...c,t]);break;case"typing":U(c=>{const d=new Set(c);return t.metadata?.isTyping?d.add(t.userId):d.delete(t.userId),d});break;case"user_joined":C(c=>new Set(c).add(t.userId)),b.success(`${t.userName} joined the chat`);break;case"user_left":C(c=>{const d=new Set(c);return d.delete(t.userId),d});break;case"game_update":b.info("Game details updated");break}},[]);const k=r.useCallback(()=>{if(x.current?.readyState!==WebSocket.OPEN){p(t=>({...t,isConnecting:!0,error:null}));try{console.log("WebSocket connection replaced with Supabase Realtime"),setTimeout(()=>{p(t=>({...t,isConnected:!0,isConnecting:!1,lastPing:new Date})),R.current=0,C(new Set([i,"other-user"])),D.current=setInterval(()=>{p(t=>({...t,lastPing:new Date}))},3e4)},1e3)}catch(t){E(t)}}},[l,i,f,createMockWebSocket]),T=r.useCallback(()=>{x.current&&(x.current.close(),x.current=null),D.current&&(clearInterval(D.current),D.current=null),j.current&&(clearTimeout(j.current),j.current=null),p({isConnected:!1,isConnecting:!1,error:null,lastPing:null}),U(new Set),C(new Set)},[]),E=r.useCallback(t=>{console.error("WebSocket error:",t),p(c=>({...c,isConnected:!1,isConnecting:!1,error:t.message||"Connection failed"})),R.current<h?j.current=setTimeout(()=>{R.current++,k()},S):b.error("Failed to connect to chat. Please check your connection.")},[k,h,S]),P=r.useCallback(t=>{if(!x.current||!u.isConnected){b.error("Not connected to chat");return}const c={type:"message",chatId:l,userId:i,userName:f,content:t};try{x.current.send(JSON.stringify({...c,id:Date.now().toString(),timestamp:new Date}))}catch(d){console.error("Failed to send message:",d),b.error("Failed to send message")}},[u.isConnected,l,i,f]),v=r.useCallback(t=>{if(!x.current||!u.isConnected)return;const c={type:"typing",chatId:l,userId:i,userName:f,metadata:{isTyping:t}};try{x.current.send(JSON.stringify(c))}catch(d){console.error("Failed to send typing indicator:",d)}},[u.isConnected,l,i,f]),L=r.useCallback(()=>{v(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{v(!1)},3e3)},[v]),A=r.useCallback(()=>{v(!1),g.current&&(clearTimeout(g.current),g.current=null)},[v]);return r.useEffect(()=>(y&&k(),()=>{T()}),[y,k,T]),r.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]),{...u,messages:w,typingUsers:Array.from(m).filter(t=>t!==i),onlineUsers:Array.from($),connect:k,disconnect:T,sendMessage:P,startTyping:L,stopTyping:A,isUserOnline:t=>$.has(t),isUserTyping:t=>m.has(t)}}function Ue(){const o=Y(),{type:l,id:i}=J(),f=H(),{navigateToUser:y,copyCurrentUrl:S}=Z(),[h,u]=r.useState(""),p=r.useRef(null),w=r.useRef(null),n=q.useMemo(()=>{if(!l||!i)return null;if(l==="game"){const s=f.find(a=>a.id===i);return{type:"game",id:i,title:s?.title||"Game Chat",gameData:s}}else if(l==="direct")return{type:"direct",id:i,title:"Unknown User"};return null},[l,i,f]),[m,U]=r.useState([]),[$,C]=r.useState(!1);r.useEffect(()=>{(async()=>{if(n){C(!0);try{let a=[];n.type==="game"?a=await G.getChatMessages("game",n.id):n.type==="direct"&&(a=await G.getChatMessages("direct",n.id)),U(a)}catch(a){console.error("Error loading messages:",a),U([])}finally{C(!1)}}})()},[n]),ee([{key:"i",description:"View user info",action:()=>{n?.type==="direct"?y(n.id):n?.type==="game"&&n.gameData&&o(`/game/${n.id}`)},disabled:!n},{key:"u",description:"Copy chat URL",action:async()=>{await S()&&b.success("Chat link copied!",{description:"Share this chat with others"})}},{key:"/",description:"Focus message input",action:()=>{w.current&&w.current.focus()}}]);const{isConnected:x,isConnecting:R,typingUsers:j,onlineUsers:D,sendMessage:g,startTyping:k,stopTyping:T,error:E}=de({chatId:`${n?.type}-${n?.id}`||"general",userId:"current-user",userName:"You",autoConnect:!0}),P=()=>{p.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{P()},[m]),r.useEffect(()=>{const a=new URLSearchParams(window.location.search).get("message");if(a&&w.current){u(decodeURIComponent(a)),w.current.focus();const N=new URL(window.location.href);N.searchParams.delete("message"),window.history.replaceState({},"",N.toString()),b.info("Message pre-filled from shared link")}},[]);const v=()=>{if(h.trim()){if(x)g(h);else{const s={id:Date.now().toString(),senderId:"current",senderName:"You",senderAvatar:"YO",message:h,timestamp:new Date,isCurrentUser:!0};U(a=>[...a,s])}u(""),T()}},L=s=>{s.key==="Enter"&&!s.shiftKey&&!s.ctrlKey?(s.preventDefault(),v()):s.key==="Enter"&&(s.shiftKey||s.ctrlKey)},A=s=>s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),t=s=>{const a=new Date,N=new Date(a);return N.setDate(N.getDate()-1),s.toDateString()===a.toDateString()?"Today":s.toDateString()===N.toDateString()?"Yesterday":s.toLocaleDateString([],{month:"short",day:"numeric"})},c=()=>{o(-1)},d=()=>{b.info("Voice calling feature coming soon!")},O=()=>{b.info("Video calling feature coming soon!")};return n?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{variant:"ghost",size:"icon",onClick:c,"aria-label":"Go back",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex items-center gap-3",children:n.type==="direct"?e.jsxs("button",{onClick:()=>y(n.id),className:"flex items-center gap-3 hover:opacity-80 transition-opacity","data-action":"view-profile",children:[e.jsx(I,{children:e.jsx(V,{children:n.title.split(" ").map(s=>s[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?"Online":"Offline"})]})]}):e.jsxs("button",{onClick:()=>o(`/game/${n.id}`),className:"flex items-center gap-3 hover:opacity-80 transition-opacity",children:[e.jsx(I,{children:e.jsx(V,{children:"ðŸ€"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.length," messages â€¢ ",D.length," online"]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.type==="direct"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{variant:"ghost",size:"icon",onClick:d,"aria-label":"Voice call",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx(M,{variant:"ghost",size:"icon",onClick:O,"aria-label":"Video call",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsx(M,{variant:"ghost",size:"icon","aria-label":"More options",children:e.jsx(re,{className:"w-5 h-5"})})]})]}),n.type==="game"&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(K,{variant:"secondary",className:"text-xs",children:["Game Chat â€¢ ",n.gameData?.sport||"Pickup Game"]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{children:"I = Game info"}),e.jsx("span",{children:"U = Copy link"}),e.jsx("span",{children:"/ = Focus input"})]})]})}),n.type==="direct"&&e.jsx("div",{className:"hidden lg:block px-4 pb-2",children:e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),"Shortcuts:"]}),e.jsx("span",{children:"I = User profile"}),e.jsx("span",{children:"U = Copy link"}),e.jsx("span",{children:"/ = Focus input"})]})})]}),E&&e.jsx("div",{className:"bg-destructive/10 border-b border-destructive/20 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-destructive",children:[e.jsx("div",{className:"w-2 h-2 bg-destructive rounded-full"}),e.jsx("span",{children:"Chat offline - messages will be sent when connection is restored"})]})}),R&&e.jsx("div",{className:"bg-warning/10 border-b border-warning/20 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-warning-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-warning rounded-full animate-pulse"}),e.jsx("span",{children:"Connecting to chat..."})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6",id:"main-content",children:$?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((s,a)=>e.jsx(le,{isOwn:a%3===0},a))}):m.length===0?e.jsx(X,{}):e.jsxs("div",{className:"space-y-4",children:[m.map((s,a)=>{const N=a===0||t(s.timestamp)!==t(m[a-1].timestamp),z=!s.isCurrentUser&&(a===m.length-1||m[a+1].senderId!==s.senderId||m[a+1].isCurrentUser);return e.jsxs("div",{children:[N&&e.jsx("div",{className:"flex justify-center my-6",children:e.jsx(K,{variant:"outline",className:"text-xs",children:t(s.timestamp)})}),e.jsxs("div",{className:`flex gap-3 ${s.isCurrentUser?"justify-end":"justify-start"}`,children:[!s.isCurrentUser&&e.jsx("button",{onClick:()=>y(s.senderId),className:`${z?"opacity-100":"opacity-0"} hover:opacity-80 transition-opacity`,children:e.jsx(I,{className:"w-8 h-8",children:e.jsx(V,{className:"text-xs",children:s.senderAvatar})})}),e.jsxs("div",{className:`max-w-xs lg:max-w-md ${s.isCurrentUser?"order-first":""}`,children:[!s.isCurrentUser&&z&&e.jsx("button",{onClick:()=>y(s.senderId),className:"text-xs text-muted-foreground mb-1 px-3 hover:text-primary transition-colors",children:s.senderName}),e.jsx("div",{className:`rounded-2xl px-4 py-2 ${s.isCurrentUser?"bg-primary text-primary-foreground ml-auto":"bg-muted"}`,children:e.jsx("p",{className:"text-sm leading-relaxed",children:s.message})}),e.jsx("div",{className:`text-xs text-muted-foreground mt-1 px-3 ${s.isCurrentUser?"text-right":"text-left"}`,children:A(s.timestamp)})]})]})]},s.id)}),j.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:j.length===1?`${j[0]} is typing...`:`${j.length} people are typing...`})]}),e.jsx("div",{ref:p})]})}),e.jsxs("div",{className:"border-t border-border p-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Q,{ref:w,value:h,onChange:s=>{u(s.target.value),k()},onKeyDown:L,onBlur:T,placeholder:`Message ${n.type==="game"?"the group":n.title}...`,className:"min-h-[44px] resize-none rounded-full px-4","data-action":"send-message"})}),e.jsx(M,{onClick:v,disabled:!h.trim(),size:"icon",className:"h-11 w-11 rounded-full",title:"Send message (Enter)",children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:e.jsx("span",{children:"Press Enter to send â€¢ / to focus input â€¢ ? for all shortcuts"})})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Chat not found"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"The chat you're looking for doesn't exist or you don't have access to it."}),e.jsx(M,{onClick:()=>o("/"),children:"Go Home"})]})})}export{Ue as ChatMessaging,Ue as default};
//# sourceMappingURL=ChatMessaging-y7sF0vfi.js.map
