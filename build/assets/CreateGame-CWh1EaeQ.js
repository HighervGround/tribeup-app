import{r as p,u as V,j as e,B as P,C as G,b as L,d as A,e as T,L as O,A as U,f as B,a as X,S as W}from"./index-D8JO7LOx.js";import{I as M}from"./input-Dk0Bi1Uu.js";import{T as Z}from"./textarea-C3K1ntXk.js";import{P as ee}from"./progress-CzzTkIfX.js";import{A as te}from"./arrow-left-TRIVfIJV.js";import{N as q}from"./navigation-C6HLfmxy.js";import{M as z}from"./map-pin-sGF-VLYY.js";import{C as H}from"./circle-check-big-h-bw40O5.js";import"./index-COrFSTZt.js";import"./index-DRG-Oofi.js";function se(b={}){const[i,N]=p.useState({latitude:null,longitude:null,error:null,loading:!0});return p.useEffect(()=>{if(console.log("useGeolocation hook initializing..."),!navigator.geolocation){console.log("Geolocation not supported"),N(m=>({...m,error:"Geolocation is not supported by this browser",loading:!1}));return}const v=m=>{console.log("GPS location obtained:",m.coords.latitude,m.coords.longitude),N({latitude:m.coords.latitude,longitude:m.coords.longitude,error:null,loading:!1})},x=m=>{let c="Unable to retrieve location";switch(m.code){case m.PERMISSION_DENIED:c="Location access denied by user";break;case m.POSITION_UNAVAILABLE:c="Location information unavailable";break;case m.TIMEOUT:c="Location request timed out";break}console.log("GPS error:",c,m),N(u=>({...u,error:c,loading:!1}))},g={enableHighAccuracy:b.enableHighAccuracy??!0,timeout:b.timeout??1e4,maximumAge:b.maximumAge??3e5};console.log("Requesting GPS permission with options:",g),navigator.geolocation.getCurrentPosition(v,x,g)},[b.enableHighAccuracy,b.timeout,b.maximumAge]),i}function ae(){const[b,i]=p.useState([]),[N,v]=p.useState(!1),x="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ",g=p.useCallback(async c=>{try{if(x&&x!=="demo_key"){const j=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(c)}&key=${x}`);if(j.ok){const r=await j.json();if(r.results&&r.results.length>0){const l=r.results[0].geometry.location;return{lat:l.lat,lng:l.lng}}}}const u=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=1`);if(!u.ok)throw new Error("Geocoding failed");const h=await u.json();return h.length>0?{lat:parseFloat(h[0].lat),lng:parseFloat(h[0].lon)}:null}catch(u){return console.error("Geocoding error:",u),null}},[x]),m=p.useCallback(async(c,u,h)=>{if(!c.trim()){i([]);return}v(!0);try{if(x&&x!=="demo_key"){let y="https://places.googleapis.com/v1/places:autocomplete";const _={input:c,...u&&h&&{locationBias:{circle:{center:{latitude:u,longitude:h},radius:5e4}}}},F=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":x},body:JSON.stringify(_)});if(F.ok){const $=await F.json();if($.suggestions&&$.suggestions.length>0){const s=$.suggestions.map((f,k)=>({place_id:f.placePrediction?.placeId||`google-${k}`,description:f.placePrediction?.text?.text||"",structured_formatting:{main_text:f.placePrediction?.structuredFormat?.mainText?.text||"",secondary_text:f.placePrediction?.structuredFormat?.secondaryText?.text||""}}));i(s),v(!1);return}}}let j=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=5&addressdetails=1`;u&&h&&(j+=`&lat=${u}&lon=${h}&bounded=1&viewbox=${h-.1},${u+.1},${h+.1},${u-.1}`);const w=(await(await fetch(j)).json()).map((y,_)=>({place_id:y.place_id||`osm-${_}`,description:y.display_name,structured_formatting:{main_text:y.name||y.display_name.split(",")[0],secondary_text:y.display_name.split(",").slice(1,3).join(",").trim()}}));i(w)}catch(j){console.error("Location search error:",j);const r=[{place_id:"1",description:`${c} Community Center`,structured_formatting:{main_text:`${c} Community Center`,secondary_text:"Recreation Center"}},{place_id:"2",description:`${c} Park`,structured_formatting:{main_text:`${c} Park`,secondary_text:"Public Park"}},{place_id:"3",description:`${c} Sports Complex`,structured_formatting:{main_text:`${c} Sports Complex`,secondary_text:"Athletic Facility"}}];i(r)}finally{v(!1)}},[x]);return{suggestions:b,loading:N,searchLocations:m,geocodeLocation:g}}const Y=[{value:"basketball",label:"Basketball",icon:"üèÄ"},{value:"soccer",label:"Soccer",icon:"‚öΩ"},{value:"tennis",label:"Tennis",icon:"üéæ"},{value:"pickleball",label:"Pickleball",icon:"ü•í"},{value:"volleyball",label:"Volleyball",icon:"üèê"},{value:"football",label:"Football",icon:"üèà"},{value:"baseball",label:"Baseball",icon:"‚öæ"}],E=[{id:1,title:"Game Details",fields:["sport","title"]},{id:2,title:"Date & Time",fields:["date","time"]},{id:3,title:"Location & Players",fields:["location","maxPlayers","cost"]}];function xe(){const b=V(),[i,N]=p.useState(1),[v,x]=p.useState(!1),[g,m]=p.useState({}),[c,u]=p.useState(null),[h,j]=p.useState(!1),{latitude:r,longitude:l,error:w}=se(),{suggestions:y,loading:_,searchLocations:F,geocodeLocation:$}=ae(),[s,f]=p.useState({title:"",sport:"",date:"",time:"",location:"",latitude:null,longitude:null,maxPlayers:"",cost:"Free",imageUrl:""});p.useEffect(()=>{console.log("Location effect triggered:",{userLat:r,userLng:l,location:s.location,latitude:s.latitude,geoError:w}),r&&l&&!s.location.trim()&&(console.log("Auto-filling location with GPS coordinates"),(async()=>{try{console.log("Fetching reverse geocoding for:",r,l);const o="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ";let n;if(o&&(n=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${l}&key=${o}`)),!n.ok)throw new Error(`HTTP ${n.status}`);const a=await n.json();console.log("Reverse geocoding response:",a);let d="";if(o&&a.results&&a.results.length>0)d=a.results[0].formatted_address;else if(a.address){const C=[];a.address.house_number&&a.address.road?C.push(`${a.address.house_number} ${a.address.road}`):a.address.road&&C.push(a.address.road),(a.address.city||a.address.town||a.address.village)&&C.push(a.address.city||a.address.town||a.address.village),a.address.state&&C.push(a.address.state),d=C.join(", ")}d||(d=a.display_name||`${r.toFixed(4)}, ${l.toFixed(4)}`),console.log("Setting location to:",d),f(C=>({...C,location:d,latitude:r,longitude:l}))}catch(o){console.error("Reverse geocoding failed:",o);const n=`${r.toFixed(4)}, ${l.toFixed(4)}`;console.log("Using fallback location:",n),f(a=>({...a,location:n,latitude:r,longitude:l}))}})())},[r,l,w]);const k=(t,o)=>{f(n=>({...n,[t]:o})),g[t]&&m(n=>{const{[t]:a,...d}=n;return d})},D=()=>{const t={};if(i===1&&(s.sport||(t.sport="Please select a sport."),s.title.trim()||(t.title="Game title is required.")),i===2&&(s.date||(t.date="Please choose a date."),s.time||(t.time="Please choose a time."),s.date)){const o=new Date;new Date(s.date+"T00:00:00")<new Date(o.toDateString())&&(t.date="Date cannot be in the past.")}if(i===3){s.location.trim()||(t.location="Location is required.");const o=parseInt(s.maxPlayers,10);s.maxPlayers?(Number.isNaN(o)||o<=0)&&(t.maxPlayers="Enter a valid number greater than 0."):t.maxPlayers="Max players is required.",s.cost||(t.cost="Please select a cost option.")}return m(t),Object.keys(t).length===0},Q=()=>{D()&&i<E.length&&N(i+1)},R=()=>{i>1?N(i-1):b(-1)},J=async()=>{if(D()){x(!0),u(null);try{const{user:t}=X.getState();if(console.log("[CreateGame] submit clicked. user =",t?.id),!t)throw new Error("You must be logged in to create a game");const o={title:s.title,sport:s.sport,date:s.date,time:s.time,location:s.location,latitude:s.latitude,longitude:s.longitude,max_players:parseInt(s.maxPlayers),cost:s.cost||"Free",description:"",requirements:"",image_url:s.imageUrl,creator_id:t.id};console.log("[CreateGame] creating game with data =",o),await W.createGame(o),b("/")}catch(t){console.error("Error creating game:",t),u(t instanceof Error?t.message:"Failed to create game")}finally{x(!1)}}},K=i/E.length*100,I=Y.find(t=>t.value===s.sport),S=(t,o,n="text",a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[o,E[i-1].fields.includes(t)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),n==="select"&&a?e.jsxs("select",{value:s[t],onChange:d=>k(t,d.target.value),className:`w-full p-2 border rounded-md ${g[t]?"border-destructive":""}`,children:[e.jsxs("option",{value:"",children:["Select ",o.toLowerCase()]}),a.map(d=>e.jsxs("option",{value:d.value,children:[d.icon," ",d.label]},d.value))]}):n==="textarea"?e.jsx(Z,{value:s[t],onChange:d=>k(t,d.target.value),placeholder:`Enter ${o.toLowerCase()}`,className:`resize-none ${g[t]?"border-destructive":""}`,rows:3}):e.jsx(M,{type:n,value:s[t],onChange:d=>k(t,d.target.value),placeholder:`Enter ${o.toLowerCase()}`,min:n==="date"?new Date().toISOString().split("T")[0]:void 0,className:g[t]?"border-destructive":""}),g[t]&&e.jsx("p",{className:"text-sm text-destructive",children:g[t]})]});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{variant:"ghost",size:"icon",onClick:R,children:e.jsx(te,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Create Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:E[i-1].title})]})]})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(ee,{value:K,className:"h-2"})})]}),e.jsxs("div",{className:"px-4 pb-40 pt-6",children:[I&&e.jsx("div",{className:"mb-6",children:e.jsx(G,{children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl",children:I.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.title||"New Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:I.label})]})]})})})}),i===1&&e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{children:[e.jsx(A,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"1"}),"Game Details"]})}),e.jsxs(L,{className:"space-y-6",children:[S("sport","Sport","select",Y),S("title","Game Title")]})]})}),i===2&&e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{children:[e.jsx(A,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"2"}),"Date & Time"]})}),e.jsxs(L,{className:"space-y-6",children:[S("date","Date","date"),S("time","Time","time")]})]})}),i===3&&e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{children:[e.jsx(A,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"3"}),"Location & Players"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{value:s.location,onChange:t=>{k("location",t.target.value),t.target.value.length>2?(F(t.target.value,r||void 0,l||void 0),j(!0)):j(!1)},placeholder:"Enter location or address",className:g.location?"border-destructive":""}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex gap-2",children:[_&&e.jsx(O,{className:"w-4 h-4 animate-spin text-muted-foreground"}),e.jsx(P,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:async()=>{if(r&&l)try{const n=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${l}`)).json()).display_name||`${r.toFixed(4)}, ${l.toFixed(4)}`;f(a=>({...a,location:n,latitude:r,longitude:l}))}catch(t){console.error("Reverse geocoding failed:",t),f(o=>({...o,location:`${r.toFixed(4)}, ${l.toFixed(4)}`,latitude:r,longitude:l}))}},disabled:!r||!l,title:r&&l?"Use my current location":w||"Location not available",children:e.jsx(q,{className:"w-4 h-4"})})]})]}),h&&y.length>0&&e.jsx("div",{className:"border border-border rounded-md bg-background shadow-lg max-h-48 overflow-y-auto",children:y.map(t=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted border-b border-border last:border-b-0 flex items-center gap-2",onClick:async()=>{f(n=>({...n,location:t.description})),j(!1);const o=await $(t.description);o&&f(n=>({...n,latitude:o.lat,longitude:o.lng}))},children:[e.jsx(z,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.structured_formatting.main_text}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.structured_formatting.secondary_text})]})]},t.place_id))}),g.location&&e.jsx("p",{className:"text-sm text-destructive",children:g.location}),s.latitude&&s.longitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(z,{className:"w-3 h-3"}),e.jsxs("span",{children:["üìç Location coordinates saved (",s.latitude.toFixed(4),", ",s.longitude.toFixed(4),")"]})]}),r&&l&&!s.latitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:"üéØ Your location detected - use GPS button to auto-fill"})]}),w&&e.jsxs("div",{className:"text-sm text-amber-600",children:["üìç ",w]})]}),S("maxPlayers","Max Players","number"),S("cost","Cost","select",[{value:"FREE",label:"Free"},{value:"$5",label:"$5 per person"},{value:"$10",label:"$10 per person"},{value:"$15",label:"$15 per person"},{value:"$20",label:"$20 per person"},{value:"custom",label:"Custom amount"}]),S("requirements","Requirements (Optional)","textarea")]})]})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border px-4 py-4 mt-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{variant:"outline",onClick:R,className:"w-auto px-4",disabled:v,children:i===1?"Cancel":"Back"}),i<E.length?e.jsx(P,{onClick:Q,className:"flex-1",disabled:v||Object.keys(g).length>0,children:"Next Step"}):e.jsx(P,{onClick:J,disabled:v,className:"flex-1",children:v?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Game..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]})}),c&&e.jsx("div",{className:"mt-4",children:e.jsx(U,{variant:"destructive",children:e.jsx(B,{children:c})})}),i===3&&s.sport&&e.jsx("div",{className:"mt-6",children:e.jsxs(U,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs(B,{children:['Ready to create "',s.title,'" for ',s.maxPlayers," players on ",s.date," at ",s.time,"?"]})]})})]})]})}export{xe as CreateGame};
//# sourceMappingURL=CreateGame-CWh1EaeQ.js.map
