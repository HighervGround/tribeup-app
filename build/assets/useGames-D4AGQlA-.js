import{u as l,a as p}from"./useMutation-M2-MJ6DD.js";import{b as o,o as Q,t as f,i as y}from"./index-Mzv7St__.js";const r={all:["games"],lists:()=>[...r.all,"list"],list:e=>[...r.lists(),{filters:e}],details:()=>[...r.all,"detail"],detail:e=>[...r.details(),e],participants:e=>[...r.detail(e),"participants"]};function m(){const{user:e}=o();return l({queryKey:r.lists(),queryFn:async()=>{console.log("ðŸ” Fetching games with React Query");const t=await y.getGames();return console.log("âœ… Games fetched:",t.length),t},staleTime:2*60*1e3,gcTime:5*60*1e3})}function K(e){return l({queryKey:r.detail(e),queryFn:async()=>await y.getGameById(e),enabled:!!e})}function P(e){return l({queryKey:r.participants(e),queryFn:()=>y.getGameParticipants(e),enabled:!!e,staleTime:1*60*1e3})}function D(){const e=Q(),{user:t}=o();return p({mutationFn:async i=>{console.log("ðŸ”§ Joining game:",i),await y.joinGame(i)},onMutate:async i=>{await e.cancelQueries({queryKey:r.lists()}),await e.cancelQueries({queryKey:r.detail(i)}),await e.cancelQueries({queryKey:r.participants(i)});const s=e.getQueryData(r.lists()),n=e.getQueryData(r.detail(i)),c=e.getQueryData(r.participants(i));return e.setQueryData(r.lists(),a=>a&&a.map(u=>u.id===i?{...u,isJoined:!0,currentPlayers:Math.min(u.currentPlayers+1,u.maxPlayers)}:u)),e.setQueryData(r.detail(i),a=>a&&{...a,isJoined:!0,currentPlayers:Math.min(a.currentPlayers+1,a.maxPlayers)}),t&&e.setQueryData(r.participants(i),a=>a?a.some(v=>v.id===t.id)?a:[...a,{id:t.id,name:t.name,avatar:t.avatar}]:[{id:t.id,name:t.name,avatar:t.avatar}]),{previousGames:s,previousGame:n,previousParticipants:c}},onError:(i,s,n)=>{console.error("âŒ Join game error:",i),n?.previousGames&&e.setQueryData(r.lists(),n.previousGames),n?.previousGame&&e.setQueryData(r.detail(s),n.previousGame),n?.previousParticipants&&e.setQueryData(r.participants(s),n.previousParticipants),f.error("Failed to join game",{description:"Please try again later"})},onSuccess:(i,s)=>{console.log("âœ… Successfully joined game:",s),e.refetchQueries({queryKey:r.detail(s)}),e.refetchQueries({queryKey:r.participants(s)}),e.refetchQueries({queryKey:r.lists()}),e.invalidateQueries({queryKey:r.detail(s)}),e.invalidateQueries({queryKey:r.participants(s)}),e.invalidateQueries({queryKey:r.lists()})}})}function h(){const e=Q();return p({mutationFn:async t=>{console.log("ðŸ”§ Leaving game:",t),await y.leaveGame(t)},onMutate:async t=>{await e.cancelQueries({queryKey:r.lists()}),await e.cancelQueries({queryKey:r.detail(t)}),await e.cancelQueries({queryKey:r.participants(t)});const i=e.getQueryData(r.lists()),s=e.getQueryData(r.detail(t)),n=e.getQueryData(r.participants(t));e.setQueryData(r.lists(),a=>a&&a.map(u=>u.id===t?{...u,isJoined:!1,currentPlayers:Math.max(u.currentPlayers-1,0)}:u)),e.setQueryData(r.detail(t),a=>a&&{...a,isJoined:!1,currentPlayers:Math.max(a.currentPlayers-1,0)});const{user:c}=o.getState();return c&&e.setQueryData(r.participants(t),a=>a?a.filter(u=>u.id!==c.id):[]),{previousGames:i,previousGame:s,previousParticipants:n}},onError:(t,i,s)=>{console.error("âŒ Leave game error:",t),s?.previousGames&&e.setQueryData(r.lists(),s.previousGames),s?.previousGame&&e.setQueryData(r.detail(i),s.previousGame),s?.previousParticipants&&e.setQueryData(r.participants(i),s.previousParticipants),f.error("Failed to leave game",{description:"Please try again later"})},onSuccess:(t,i)=>{console.log("âœ… Successfully left game:",i),e.refetchQueries({queryKey:r.detail(i)}),e.refetchQueries({queryKey:r.participants(i)}),e.refetchQueries({queryKey:r.lists()}),e.invalidateQueries({queryKey:r.detail(i)}),e.invalidateQueries({queryKey:r.participants(i)}),e.invalidateQueries({queryKey:r.lists()})}})}export{K as a,P as b,D as c,h as d,m as u};
//# sourceMappingURL=useGames-D4AGQlA-.js.map
