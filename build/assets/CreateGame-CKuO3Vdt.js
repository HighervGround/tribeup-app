import{r as g,u as Q,j as e,B as _,C as L,b as A,d as D,e as I,L as O,A as U,f as B,a as W,S as X}from"./index-zpPBrtBy.js";import{I as z}from"./input-2TDkEivg.js";import{T as Z}from"./textarea-frDzw24l.js";import{P as ee}from"./progress-2Cr8MO4T.js";import{A as te}from"./arrow-left-4l-hvJxO.js";import{N as M}from"./navigation-rC5eFexv.js";import{M as Y}from"./map-pin-CDKxPfsB.js";import{C as q}from"./circle-check-big-Dars4a0o.js";import"./index-CyN_7i2q.js";function se(f={}){const[i,N]=g.useState({latitude:null,longitude:null,error:null,loading:!0});return g.useEffect(()=>{if(console.log("useGeolocation hook initializing..."),!navigator.geolocation){console.log("Geolocation not supported"),N(m=>({...m,error:"Geolocation is not supported by this browser",loading:!1}));return}const j=m=>{console.log("GPS location obtained:",m.coords.latitude,m.coords.longitude),N({latitude:m.coords.latitude,longitude:m.coords.longitude,error:null,loading:!1})},x=m=>{let c="Unable to retrieve location";switch(m.code){case m.PERMISSION_DENIED:c="Location access denied by user";break;case m.POSITION_UNAVAILABLE:c="Location information unavailable";break;case m.TIMEOUT:c="Location request timed out";break}console.log("GPS error:",c,m),N(u=>({...u,error:c,loading:!1}))},p={enableHighAccuracy:f.enableHighAccuracy??!0,timeout:f.timeout??1e4,maximumAge:f.maximumAge??3e5};console.log("Requesting GPS permission with options:",p),navigator.geolocation.getCurrentPosition(j,x,p)},[f.enableHighAccuracy,f.timeout,f.maximumAge]),i}function ae(){const[f,i]=g.useState([]),[N,j]=g.useState(!1),x="AIzaSyATPbnuTvpYDDY0vLrKy0IoS80A27rpq-4",p=g.useCallback(async c=>{try{if(x&&x!=="demo_key"){const b=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(c)}&key=${x}`);if(b.ok){const r=await b.json();if(r.results&&r.results.length>0){const l=r.results[0].geometry.location;return{lat:l.lat,lng:l.lng}}}}const u=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=1`);if(!u.ok)throw new Error("Geocoding failed");const h=await u.json();return h.length>0?{lat:parseFloat(h[0].lat),lng:parseFloat(h[0].lon)}:null}catch(u){return console.error("Geocoding error:",u),null}},[x]),m=g.useCallback(async(c,u,h)=>{if(!c.trim()){i([]);return}j(!0);try{if(x&&x!=="demo_key"){let v=`https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${encodeURIComponent(c)}&key=${x}&types=establishment|geocode`;u&&h&&(v+=`&location=${u},${h}&radius=50000`);const $=await fetch(v);if($.ok){const k=await $.json();if(k.predictions&&k.predictions.length>0){const F=k.predictions.map(s=>({place_id:s.place_id,description:s.description,structured_formatting:{main_text:s.structured_formatting.main_text,secondary_text:s.structured_formatting.secondary_text||""}}));i(F),j(!1);return}}}let b=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=5&addressdetails=1`;u&&h&&(b+=`&lat=${u}&lon=${h}&bounded=1&viewbox=${h-.1},${u+.1},${h+.1},${u-.1}`);const w=(await(await fetch(b)).json()).map((v,$)=>({place_id:v.place_id||`osm-${$}`,description:v.display_name,structured_formatting:{main_text:v.name||v.display_name.split(",")[0],secondary_text:v.display_name.split(",").slice(1,3).join(",").trim()}}));i(w)}catch(b){console.error("Location search error:",b);const r=[{place_id:"1",description:`${c} Community Center`,structured_formatting:{main_text:`${c} Community Center`,secondary_text:"Recreation Center"}},{place_id:"2",description:`${c} Park`,structured_formatting:{main_text:`${c} Park`,secondary_text:"Public Park"}},{place_id:"3",description:`${c} Sports Complex`,structured_formatting:{main_text:`${c} Sports Complex`,secondary_text:"Athletic Facility"}}];i(r)}finally{j(!1)}},[x]);return{suggestions:f,loading:N,searchLocations:m,geocodeLocation:p}}const H=[{value:"basketball",label:"Basketball",icon:"üèÄ"},{value:"soccer",label:"Soccer",icon:"‚öΩ"},{value:"tennis",label:"Tennis",icon:"üéæ"},{value:"pickleball",label:"Pickleball",icon:"ü•í"},{value:"volleyball",label:"Volleyball",icon:"üèê"},{value:"football",label:"Football",icon:"üèà"},{value:"baseball",label:"Baseball",icon:"‚öæ"}],P=[{id:1,title:"Game Details",fields:["sport","title","description"]},{id:2,title:"Date & Time",fields:["date","time","duration"]},{id:3,title:"Location & Players",fields:["location","maxPlayers","cost","requirements"]}];function pe(){const f=Q(),[i,N]=g.useState(1),[j,x]=g.useState(!1),[p,m]=g.useState({}),[c,u]=g.useState(null),[h,b]=g.useState(!1),{latitude:r,longitude:l,error:w}=se(),{suggestions:v,loading:$,searchLocations:k,geocodeLocation:F}=ae(),[s,S]=g.useState({sport:"",title:"",description:"",date:"",time:"",duration:"",location:"",latitude:null,longitude:null,maxPlayers:"",cost:"",requirements:""});g.useEffect(()=>{console.log("Location effect triggered:",{userLat:r,userLng:l,location:s.location,latitude:s.latitude,geoError:w}),r&&l&&!s.location.trim()&&(console.log("Auto-filling location with GPS coordinates"),(async()=>{try{console.log("Fetching reverse geocoding for:",r,l);const o="AIzaSyATPbnuTvpYDDY0vLrKy0IoS80A27rpq-4";let n;if(o&&(n=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${l}&key=${o}`)),!n.ok)throw new Error(`HTTP ${n.status}`);const a=await n.json();console.log("Reverse geocoding response:",a);let d="";if(o&&a.results&&a.results.length>0)d=a.results[0].formatted_address;else if(a.address){const C=[];a.address.house_number&&a.address.road?C.push(`${a.address.house_number} ${a.address.road}`):a.address.road&&C.push(a.address.road),(a.address.city||a.address.town||a.address.village)&&C.push(a.address.city||a.address.town||a.address.village),a.address.state&&C.push(a.address.state),d=C.join(", ")}d||(d=a.display_name||`${r.toFixed(4)}, ${l.toFixed(4)}`),console.log("Setting location to:",d),S(C=>({...C,location:d,latitude:r,longitude:l}))}catch(o){console.error("Reverse geocoding failed:",o);const n=`${r.toFixed(4)}, ${l.toFixed(4)}`;console.log("Using fallback location:",n),S(a=>({...a,location:n,latitude:r,longitude:l}))}})())},[r,l,w]);const E=(t,o)=>{S(n=>({...n,[t]:o})),p[t]&&m(n=>{const{[t]:a,...d}=n;return d})},T=()=>{const t={};if(i===1&&(s.sport||(t.sport="Please select a sport."),s.title.trim()||(t.title="Game title is required."),s.description.trim()||(t.description="Description is required.")),i===2&&(s.date||(t.date="Please choose a date."),s.time||(t.time="Please choose a time."),s.date)){const o=new Date;new Date(s.date+"T00:00:00")<new Date(o.toDateString())&&(t.date="Date cannot be in the past.")}if(i===3){s.location.trim()||(t.location="Location is required.");const o=parseInt(s.maxPlayers,10);s.maxPlayers?(Number.isNaN(o)||o<=0)&&(t.maxPlayers="Enter a valid number greater than 0."):t.maxPlayers="Max players is required.",s.cost||(t.cost="Please select a cost option.")}return m(t),Object.keys(t).length===0},K=()=>{T()&&i<P.length&&N(i+1)},R=()=>{i>1?N(i-1):f(-1)},V=async()=>{if(T()){x(!0),u(null);try{const{user:t}=W.getState();if(console.log("[CreateGame] submit clicked. user =",t?.id),!t)throw new Error("You must be logged in to create a game");const o={title:s.title,sport:s.sport,location:s.location,date:s.date,time:s.time,cost:s.cost||"Free",maxPlayers:parseInt(s.maxPlayers),description:s.description,creatorId:t.id};console.log("[CreateGame] creating game with data =",o),await X.createGame(o),f("/")}catch(t){console.error("Error creating game:",t),u(t instanceof Error?t.message:"Failed to create game")}finally{x(!1)}}},J=i/P.length*100,G=H.find(t=>t.value===s.sport),y=(t,o,n="text",a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[o,P[i-1].fields.includes(t)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),n==="select"&&a?e.jsxs("select",{value:s[t],onChange:d=>E(t,d.target.value),className:`w-full p-2 border rounded-md ${p[t]?"border-destructive":""}`,children:[e.jsxs("option",{value:"",children:["Select ",o.toLowerCase()]}),a.map(d=>e.jsxs("option",{value:d.value,children:[d.icon," ",d.label]},d.value))]}):n==="textarea"?e.jsx(Z,{value:s[t],onChange:d=>E(t,d.target.value),placeholder:`Enter ${o.toLowerCase()}`,className:`resize-none ${p[t]?"border-destructive":""}`,rows:3}):e.jsx(z,{type:n,value:s[t],onChange:d=>E(t,d.target.value),placeholder:`Enter ${o.toLowerCase()}`,min:n==="date"?new Date().toISOString().split("T")[0]:void 0,className:p[t]?"border-destructive":""}),p[t]&&e.jsx("p",{className:"text-sm text-destructive",children:p[t]})]});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{variant:"ghost",size:"icon",onClick:R,children:e.jsx(te,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Create Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:P[i-1].title})]})]})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(ee,{value:J,className:"h-2"})})]}),e.jsxs("div",{className:"px-4 pb-40 pt-6",children:[G&&e.jsx("div",{className:"mb-6",children:e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl",children:G.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.title||"New Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:G.label})]})]})})})}),i===1&&e.jsx("div",{className:"space-y-6",children:e.jsxs(L,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"1"}),"Game Details"]})}),e.jsxs(A,{className:"space-y-6",children:[y("sport","Sport","select",H),y("title","Game Title"),y("description","Description","textarea")]})]})}),i===2&&e.jsx("div",{className:"space-y-6",children:e.jsxs(L,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"2"}),"Date & Time"]})}),e.jsxs(A,{className:"space-y-6",children:[y("date","Date","date"),y("time","Time","time"),y("duration","Duration","select",[{value:"30min",label:"30 minutes"},{value:"1hr",label:"1 hour"},{value:"1.5hr",label:"1.5 hours"},{value:"2hr",label:"2 hours"},{value:"3hr",label:"3 hours"}])]})]})}),i===3&&e.jsx("div",{className:"space-y-6",children:e.jsxs(L,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"3"}),"Location & Players"]})}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{value:s.location,onChange:t=>{E("location",t.target.value),t.target.value.length>2?(k(t.target.value,r||void 0,l||void 0),b(!0)):b(!1)},placeholder:"Enter location or address",className:p.location?"border-destructive":""}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex gap-2",children:[$&&e.jsx(O,{className:"w-4 h-4 animate-spin text-muted-foreground"}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:async()=>{if(r&&l)try{const n=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${l}`)).json()).display_name||`${r.toFixed(4)}, ${l.toFixed(4)}`;S(a=>({...a,location:n,latitude:r,longitude:l}))}catch(t){console.error("Reverse geocoding failed:",t),S(o=>({...o,location:`${r.toFixed(4)}, ${l.toFixed(4)}`,latitude:r,longitude:l}))}},disabled:!r||!l,title:r&&l?"Use my current location":w||"Location not available",children:e.jsx(M,{className:"w-4 h-4"})})]})]}),h&&v.length>0&&e.jsx("div",{className:"border border-border rounded-md bg-background shadow-lg max-h-48 overflow-y-auto",children:v.map(t=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted border-b border-border last:border-b-0 flex items-center gap-2",onClick:async()=>{S(n=>({...n,location:t.description})),b(!1);const o=await F(t.description);o&&S(n=>({...n,latitude:o.lat,longitude:o.lng}))},children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.structured_formatting.main_text}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.structured_formatting.secondary_text})]})]},t.place_id))}),p.location&&e.jsx("p",{className:"text-sm text-destructive",children:p.location}),s.latitude&&s.longitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsxs("span",{children:["üìç Location coordinates saved (",s.latitude.toFixed(4),", ",s.longitude.toFixed(4),")"]})]}),r&&l&&!s.latitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:"üéØ Your location detected - use GPS button to auto-fill"})]}),w&&e.jsxs("div",{className:"text-sm text-amber-600",children:["üìç ",w]})]}),y("maxPlayers","Max Players","number"),y("cost","Cost","select",[{value:"FREE",label:"Free"},{value:"$5",label:"$5 per person"},{value:"$10",label:"$10 per person"},{value:"$15",label:"$15 per person"},{value:"$20",label:"$20 per person"},{value:"custom",label:"Custom amount"}]),y("requirements","Requirements (Optional)","textarea")]})]})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border px-4 py-4 mt-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{variant:"outline",onClick:R,className:"w-auto px-4",disabled:j,children:i===1?"Cancel":"Back"}),i<P.length?e.jsx(_,{onClick:K,className:"flex-1",disabled:j||Object.keys(p).length>0,children:"Next Step"}):e.jsx(_,{onClick:V,disabled:j,className:"flex-1",children:j?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Game..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]})}),c&&e.jsx("div",{className:"mt-4",children:e.jsx(U,{variant:"destructive",children:e.jsx(B,{children:c})})}),i===3&&s.sport&&e.jsx("div",{className:"mt-6",children:e.jsxs(U,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsxs(B,{children:['Ready to create "',s.title,'" for ',s.maxPlayers," players on ",s.date," at ",s.time,"?"]})]})})]})]})}export{pe as CreateGame};
//# sourceMappingURL=CreateGame-CKuO3Vdt.js.map
