import{c as v,i as b,j as G,k as m,l as C,n as d,m as y,o as P,p as S,b as g,S as c,t as l}from"./index-B8K4da9u.js";import{r as u}from"./vendor-IUqyc6Bg.js";import{u as p}from"./useQuery-CBrP0Umh.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],E=v("clock",M);var O=class extends b{#s;#i=void 0;#e;#t;constructor(e,t){super(),this.#s=e,this.setOptions(t),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#s.defaultMutationOptions(e),G(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&m(t.mutationKey)!==m(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#i}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#r(),this.#a()}mutate(e,t){return this.#t=t,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(e)}#r(){const e=this.#e?.state??C();this.#i={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){d.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#i.variables,i=this.#i.context;e?.type==="success"?(this.#t.onSuccess?.(e.data,t,i),this.#t.onSettled?.(e.data,null,t,i)):e?.type==="error"&&(this.#t.onError?.(e.error,t,i),this.#t.onSettled?.(void 0,e.error,t,i))}this.listeners.forEach(t=>{t(this.#i)})})}};function f(e,t){const i=y(),[s]=u.useState(()=>new O(i,e));u.useEffect(()=>{s.setOptions(e)},[s,e]);const r=u.useSyncExternalStore(u.useCallback(n=>s.subscribe(d.batchCalls(n)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),o=u.useCallback((n,h)=>{s.mutate(n,h).catch(P)},[s]);if(r.error&&S(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:o,mutateAsync:r.mutate}}const a={all:["games"],lists:()=>[...a.all,"list"],list:e=>[...a.lists(),{filters:e}],details:()=>[...a.all,"detail"],detail:e=>[...a.details(),e],participants:e=>[...a.detail(e),"participants"]};function k(){const{user:e}=g();return p({queryKey:a.lists(),queryFn:async()=>{console.log("ðŸ” Fetching games with React Query");const t=await c.getGames();return console.log("âœ… Games fetched:",t.length),t},staleTime:2*60*1e3,gcTime:5*60*1e3,enabled:!!e})}function L(e){return p({queryKey:a.detail(e),queryFn:async()=>await c.getGameById(e),enabled:!!e})}function x(e){return p({queryKey:a.participants(e),queryFn:()=>c.getGameParticipants(e),enabled:!!e,staleTime:1*60*1e3})}function q(){const e=y(),{user:t}=g();return f({mutationFn:async i=>{console.log("ðŸ”§ Joining game:",i),await c.joinGame(i)},onMutate:async i=>{await e.cancelQueries({queryKey:a.lists()});const s=e.getQueryData(a.lists());return e.setQueryData(a.lists(),r=>r&&r.map(o=>o.id===i?{...o,isJoined:!0,currentPlayers:Math.min(o.currentPlayers+1,o.maxPlayers)}:o)),{previousGames:s}},onError:(i,s,r)=>{console.error("âŒ Join game error:",i),r?.previousGames&&e.setQueryData(a.lists(),r.previousGames),l.error("Failed to join game",{description:"Please try again later"})},onSuccess:(i,s)=>{console.log("âœ… Successfully joined game:",s),e.invalidateQueries({queryKey:a.participants(s)}),l.success("Joined game!",{description:"You're now part of this game"})}})}function w(){const e=y();return f({mutationFn:async t=>{console.log("ðŸ”§ Leaving game:",t),await c.leaveGame(t)},onMutate:async t=>{await e.cancelQueries({queryKey:a.lists()});const i=e.getQueryData(a.lists());return e.setQueryData(a.lists(),s=>s&&s.map(r=>r.id===t?{...r,isJoined:!1,currentPlayers:Math.max(r.currentPlayers-1,0)}:r)),{previousGames:i}},onError:(t,i,s)=>{console.error("âŒ Leave game error:",t),s?.previousGames&&e.setQueryData(a.lists(),s.previousGames),l.error("Failed to leave game",{description:"Please try again later"})},onSuccess:(t,i)=>{console.log("âœ… Successfully left game:",i),e.invalidateQueries({queryKey:a.participants(i)}),l.success("Left game successfully",{description:"You've left this game"})}})}function F(){const e=q(),t=w(),i=u.useCallback((n,h)=>{h?.stopPropagation(),n.isJoined?t.mutate(n.id):e.mutate(n.id)},[e,t]),s=u.useCallback(n=>r?"...":n.isJoined?"Leave":"Join",[e.isPending,t.isPending]),r=e.isPending||t.isPending,o=u.useCallback(n=>n.isJoined?"outline":"default",[]);return{toggleJoin:i,isLoading:r,getButtonText:s,getButtonVariant:o,isJoining:e.isPending,isLeaving:t.isPending}}export{E as C,F as a,L as b,x as c,k as u};
//# sourceMappingURL=useGameJoinToggle-DsFmobOk.js.map
