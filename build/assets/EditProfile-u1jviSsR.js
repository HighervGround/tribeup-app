import{j as e}from"./ui-B4gQYcc6.js";import{e as s,r as a,R as r}from"./vendor-CTE-63Sz.js";import{u as t,S as l,B as n,C as i,d as o,e as c,a as m,A as d,g as u,h as f,b as x}from"./index-KT6d_1Zf.js";import{I as h}from"./input-Blmf8RA4.js";import{T as p}from"./textarea-COgLkNn7.js";import{A as j,n as g,o as v,X as b,t as N}from"./utils-B5KmqWpW.js";import{c as y}from"./useUserProfile-1tF3GCgx.js";import"./data-pHbUkPVm.js";const w=["Basketball","Soccer","Tennis","Volleyball","Football","Baseball","Swimming","Running","Cycling","Yoga"];function U(){const U=s(),{user:P,setUser:C}=t(),S=y(),k=S.isPending,[L,A]=a.useState({fullName:"",username:"",bio:"",location:"",avatarUrl:"",sportsPreferences:[]}),[E,B]=a.useState(null),[F,I]=a.useState(!1),[J,O]=a.useState(null),[R,T]=a.useState(""),[z,_]=a.useState(null),D=r.useRef(null),G=200,M=/^[a-zA-Z0-9._-]{3,20}$/;a.useEffect(()=>{(async()=>{if(P)try{const e=await l.getUserProfile(P.id);if(!e)return;const s={fullName:e.name||"",username:e.username||"",bio:e.bio||"",location:e.location||"",avatarUrl:e.avatar||"",sportsPreferences:Array.isArray(e.preferences?.sports)?e.preferences.sports:[]};A(s),D.current=s}catch(e){N.error("Failed to load profile data")}else U("/auth")})()},[P,U]),a.useEffect(()=>{let e;const s=(L.username||"").trim();if(s)if(M.test(s)){if(!P?.username||P.username.trim().toLowerCase()!==s.toLowerCase())return I(!0),e=setTimeout(async()=>{try{const e=await l.isUsernameAvailable(s,P?.id);B(e?null:"Username is already taken")}catch{B("Unable to validate username right now")}finally{I(!1)}},450),()=>clearTimeout(e);B(null)}else B("3-20 chars. Letters, numbers, dot, underscore, or hyphen.");else B(null)},[L.username,P]);const V=(e,s)=>{A(a=>({...a,[e]:s})),"username"===e&&B(null),"bio"===e&&"string"==typeof s&&s.length>G&&A(e=>({...e,bio:s.slice(0,G)}))};a.useEffect(()=>{const e=D.current&&JSON.stringify(D.current)!==JSON.stringify(L),s=s=>{e&&(s.preventDefault(),s.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[L]);const W=D.current&&JSON.stringify(D.current)!==JSON.stringify(L)||null!==J;return P?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-12 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>{if(D.current&&JSON.stringify(D.current)!==JSON.stringify(L)){if(!window.confirm("Discard unsaved changes?"))return}U("/profile")},children:e.jsx(j,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Edit Profile"})]}),e.jsxs(n,{onClick:async()=>{if(P)try{const s=(L.username||"").trim();if(s){if(!M.test(s))return void B("3-20 chars. Letters, numbers, dot, underscore, or hyphen.");if(!(await l.isUsernameAvailable(s,P.id)))return void B("Username is already taken")}let a=L.avatarUrl;if(J)try{a=await l.uploadAvatar(J)}catch(e){N.error("Failed to upload profile picture. Profile will be saved without image.")}S.mutate({userId:P.id,profileData:{full_name:L.fullName,username:L.username,bio:L.bio,location:L.location,avatar_url:a,preferred_sports:L.sportsPreferences}},{onSuccess:e=>{C(e),U("/profile")},onError:e=>{N.error("Failed to update profile: "+e.message)}})}catch(s){N.error("Failed to validate profile data")}},disabled:!W||k||F||!!E||!!z||!L.fullName||!L.username,className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),k?"Saving...":"Save"]})]}),e.jsxs("div",{className:"px-4 space-y-6",children:[e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"Profile Picture"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(d,{className:"w-20 h-20",children:[(R||L.avatarUrl)&&e.jsx(u,{src:R||L.avatarUrl,alt:"Avatar preview"}),e.jsx(f,{className:"text-xl",children:L.fullName?L.fullName.charAt(0).toUpperCase():"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{placeholder:"Avatar URL (optional)",value:L.avatarUrl,onChange:e=>V("avatarUrl",e.target.value)}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx(h,{type:"file",accept:"image/*",onChange:e=>{const s=e.target.files?.[0]||null;if(O(s),_(null),s){const e=5242880;if(!["image/jpeg","image/png","image/webp","image/gif"].includes(s.type))return _("Please upload a JPG, PNG, WEBP, or GIF image."),void O(null);if(s.size>e)return _("Image is too large. Max size is 5 MB."),void O(null);const a=URL.createObjectURL(s);T(a)}else T("")}}),e.jsx(v,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enter a URL or upload an image"}),z&&e.jsx("p",{className:"text-xs text-red-500 mt-1",role:"alert","aria-live":"polite",children:z})]})]})})]}),e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"Basic Information"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Full Name"}),e.jsx(h,{placeholder:"Enter your full name",value:L.fullName,onChange:e=>V("fullName",e.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Username ",e.jsx("span",{className:"text-muted-foreground font-normal",children:"(3–20 chars)"})]}),e.jsx(h,{placeholder:"Choose a username",value:L.username,onChange:e=>V("username",e.target.value),onBlur:async()=>{if(!P)return;const e=(L.username||"").trim();if(e)if(M.test(e)){if(!P.username||P.username.trim().toLowerCase()!==e.toLowerCase())try{I(!0);await l.isUsernameAvailable(e,P.id)||B("Username is already taken")}catch(s){B("Unable to validate username right now")}finally{I(!1)}}else B("3-20 chars. Letters, numbers, dot, underscore, or hyphen.")},"aria-describedby":E?"username-error":"username-help"}),F&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1","aria-live":"polite",children:"Checking availability…"}),E&&e.jsx("p",{id:"username-error",className:"text-xs text-red-500 mt-1",role:"alert","aria-live":"polite",children:E}),!E&&!F&&L.username&&e.jsx("p",{id:"username-help",className:"text-xs text-muted-foreground mt-1",children:"Allowed: letters, numbers, dot, underscore, hyphen."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(h,{placeholder:"City, State",value:L.location,onChange:e=>V("location",e.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Bio ",e.jsxs("span",{className:"text-muted-foreground font-normal",children:["(max ",G," chars)"]})]}),e.jsx(p,{placeholder:"Tell us about yourself...",value:L.bio,onChange:e=>V("bio",e.target.value),rows:3,maxLength:G,"aria-describedby":"bio-counter"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("span",{id:"bio-counter",className:"text-xs "+(L.bio.length>=G?"text-red-500":"text-muted-foreground"),children:[L.bio.length,"/",G]})})]})]})]}),e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"Sports I Play"})}),e.jsxs(m,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(s=>e.jsxs(x,{variant:L.sportsPreferences.includes(s)?"default":"secondary",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>(e=>{A(s=>({...s,sportsPreferences:s.sportsPreferences.includes(e)?s.sportsPreferences.filter(s=>s!==e):[...s.sportsPreferences,e]}))})(s),children:[s,L.sportsPreferences.includes(s)&&e.jsx(b,{className:"w-3 h-3 ml-1"})]},s))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:"Click on sports to add or remove them from your preferences"})]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl mb-4",children:"Please sign in"}),e.jsx(n,{onClick:()=>U("/auth"),children:"Sign In"})]})})}export{U as default};
//# sourceMappingURL=EditProfile-u1jviSsR.js.map
