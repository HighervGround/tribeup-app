import{u as T,a as P,r as i,S as m,j as e,B as x,R as b}from"./index-1UwNT_Si.js";import{P as C}from"./plus-BV2OykyI.js";function g({game:t,onSelect:a}){return e.jsxs("div",{className:"bg-card rounded-lg p-4 border border-border cursor-pointer hover:shadow-md transition-shadow",onClick:a,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.sport})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-sm font-medium",children:t.cost}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.currentPlayers,"/",t.maxPlayers," players"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"ðŸ“"}),e.jsx("span",{children:t.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"ðŸ•’"}),e.jsxs("span",{children:[t.date," at ",t.time]})]}),t.distance&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"ðŸ“"}),e.jsx("span",{children:t.distance})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:t.description}),t.isJoined&&e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:"inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"Joined"})})]})}function M(){const t=T(),{games:a,setGames:h,isLoading:o,setLoading:c,user:v}=P(),[E,y]=i.useState(!1),[w,u]=i.useState(!1),k=8e3,p=i.useMemo(()=>v?.preferences?.sports??[],[v]),[n,S]=i.useState("all");i.useEffect(()=>{G()},[n]),i.useEffect(()=>{const s=m.subscribeToAllGames(l=>{console.log("[Realtime] games INSERT received",l?.new?.id||""),(async()=>{try{const d=n==="recommended"?await m.getRecommendedGames(p):await m.getGames();await h(d)}catch(d){console.warn("Realtime refresh failed:",d)}})()});return()=>{try{s.unsubscribe()}catch{}}},[n,h,p.join?.("|")??""]),i.useEffect(()=>()=>{c(!1)},[c]);const G=async()=>{const s=`Home loadGames (${n}) ${Date.now()}-${Math.random().toString(36).slice(2,6)}`;u(!1),console.time?.(s);try{c(!0);const l=(async()=>{const r=n==="recommended"?await m.getRecommendedGames(p):await m.getGames();await h(r)})(),d=new Promise(r=>{setTimeout(()=>r("timeout"),k)});if(await Promise.race([l.then(()=>"ok"),d])==="timeout")if(console.warn(`[Home] loadGames timed out after ${k}ms`),n==="recommended"){u(!1),c(!1),m.getGames().then(r=>h(r)).catch(r=>console.error("Fallback getGames failed:",r));return}else{u(!0),c(!1);return}}catch(l){console.error("Error loading games:",l)}finally{console.timeEnd?.(s),w||c(!1)}},N=async()=>{u(!1),y(!0),await G(),y(!1)},j=s=>{t(`/game/${s}`)},R=()=>{t("/create-game")},f=a.filter(s=>{const l=new Date(s.date),d=new Date;return l.toDateString()===d.toDateString()});return o&&a.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading games..."})]})}):w&&a.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"This is taking longer than expected."}),e.jsxs(x,{onClick:N,variant:"outline",children:[e.jsx(b,{className:"w-4 h-4 mr-2"})," Retry"]})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"px-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsx(x,{onClick:R,size:"icon","aria-label":"Create new game",children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:a.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Games"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Players Online"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"This Week"})]})]})]}),f.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-lg mb-4",children:"Happening Soon"}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:f.map(s=>e.jsx("div",{className:"flex-shrink-0 w-72",children:e.jsx(g,{game:s,onSelect:()=>j(s.id)})},s.id))})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"All Games"}),e.jsx(x,{variant:"ghost",size:"sm",onClick:N,disabled:o,"aria-label":"Refresh games",children:e.jsx(b,{className:`w-4 h-4 ${o?"animate-spin":""}`})})]}),e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx("div",{children:e.jsx(g,{game:s,onSelect:()=>j(s.id)})},s.id))})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-muted rounded-md p-1 flex",children:[e.jsx("button",{className:`px-3 py-1 text-sm rounded ${n==="recommended"?"bg-background shadow font-medium":"text-muted-foreground"}`,onClick:()=>S("recommended"),children:"Recommended"}),e.jsx("button",{className:`px-3 py-1 text-sm rounded ${n==="all"?"bg-background shadow font-medium":"text-muted-foreground"}`,onClick:()=>S("all"),children:"All"})]}),e.jsxs(x,{onClick:R,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Create Game"]})]})]}),f.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Happening Today"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(s=>e.jsx(g,{game:s,onSelect:()=>j(s.id)},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:n==="recommended"?"Recommended For You":"All Games"}),e.jsxs(x,{variant:"outline",onClick:N,disabled:o,children:[e.jsx(b,{className:`w-4 h-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(s=>e.jsx("div",{children:e.jsx(g,{game:s,onSelect:()=>j(s.id)})},s.id))})]}),e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Active Games"}),e.jsx("span",{className:"font-semibold",children:a.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Players Online"}),e.jsx("span",{className:"font-semibold",children:"0"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"This Week"}),e.jsx("span",{className:"font-semibold",children:"0"})]})]})]})})]})})})]})}export{M as HomeScreen};
//# sourceMappingURL=HomeScreen-CuBjAbQd.js.map
