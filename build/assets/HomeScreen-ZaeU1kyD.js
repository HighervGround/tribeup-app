import{j as e}from"./ui-B4gQYcc6.js";import{r as s,e as a}from"./vendor-CTE-63Sz.js";import{s as t,C as n,a as r,u as i,B as l}from"./index-KT6d_1Zf.js";import{u as c}from"./useGames-CpBXuS7z.js";import{U as m}from"./UnifiedGameCard-CPtUx44q.js";import{S as d}from"./skeleton-BClfNuO0.js";import{R as o,P as x}from"./utils-B5KmqWpW.js";import"./data-pHbUkPVm.js";import"./ImageWithFallback-CGJF3SkS.js";import"./useGameJoinToggle-BuvaL-1K.js";import"./dateUtils-DKSG3jUc.js";function u(){return e.jsx(n,{className:"w-full",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(d,{className:"h-5 w-3/4"}),e.jsx(d,{className:"h-4 w-1/2"})]}),e.jsx(d,{className:"h-8 w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(d,{className:"h-4 w-2/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(d,{className:"h-4 w-1/3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(d,{className:"h-4 w-1/4"})]})]}),e.jsx(d,{className:"h-4 w-full"}),e.jsx(d,{className:"h-4 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(d,{className:"h-6 w-20"}),e.jsx(d,{className:"h-8 w-16"})]})]})})})}function h(){const n=a(),{user:r}=i(),{data:d=[],isLoading:h,error:g,refetch:j}=c(),[f,N]=s.useState(!1),[v,p]=s.useState(!1);s.useMemo(()=>r?.preferences?.sports??[],[r]);const{onlineCount:w,isLoading:y}=function(){const[e,a]=s.useState([]),[n,r]=s.useState(0),[i,l]=s.useState(!0),[c,m]=s.useState(null);return s.useEffect(()=>{let e,s,n;return(async()=>{try{n=setTimeout(()=>{l(!1),m("Connection failed"),a([{id:"1",name:"Player 1",avatar:"",lastSeen:(new Date).toISOString()},{id:"2",name:"Player 2",avatar:"",lastSeen:(new Date).toISOString()},{id:"3",name:"Player 3",avatar:"",lastSeen:(new Date).toISOString()}]),r(3)},3e3);const{data:{user:c}}=await t.auth.getUser();if(!c)return clearTimeout(n),l(!1),a([{id:"1",name:"Demo User 1",avatar:"",lastSeen:(new Date).toISOString()},{id:"2",name:"Demo User 2",avatar:"",lastSeen:(new Date).toISOString()}]),void r(2);const{data:d}=await t.from("users").select("full_name, username, avatar_url").eq("id",c.id).single();try{e=t.channel("online-users",{config:{presence:{key:c.id}}})}catch(i){return clearTimeout(n),l(!1),m("Connection failed"),a([{id:"1",name:"Offline User 1",avatar:"",lastSeen:(new Date).toISOString()},{id:"2",name:"Offline User 2",avatar:"",lastSeen:(new Date).toISOString()}]),void r(2)}e.on("presence",{event:"sync"},()=>{try{const s=e.presenceState(),t=Object.keys(s).map(e=>{const a=s[e][0];return{id:e,name:a.name||"Anonymous",avatar:a.avatar,lastSeen:(new Date).toISOString()}});a(t),r(t.length),l(!1)}catch(s){l(!1)}}).on("presence",{event:"join"},({key:e,newPresences:s})=>{}).on("presence",{event:"leave"},({key:e,leftPresences:s})=>{}),await e.subscribe(async a=>{"SUBSCRIBED"===a?(clearTimeout(n),await e.track({user_id:c.id,name:d?.full_name||d?.username||"Anonymous",avatar:d?.avatar_url,online_at:(new Date).toISOString()}),s=setInterval(async()=>{try{await e.track({user_id:c.id,name:d?.full_name||d?.username||"Anonymous",avatar:d?.avatar_url,online_at:(new Date).toISOString()})}catch(s){}},6e4)):"CHANNEL_ERROR"===a&&(clearTimeout(n),m("Presence channel error"),l(!1))})}catch(c){clearTimeout(n),m("Failed to initialize presence system"),l(!1)}})(),()=>{n&&clearTimeout(n),s&&clearInterval(s),e&&e.unsubscribe()}},[]),{onlineUsers:e,onlineCount:n,isLoading:i,error:c}}(),b=s.useMemo(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-e.getDay()),s.setHours(0,0,0,0);const a=new Date(s);a.setDate(s.getDate()+6),a.setHours(23,59,59,999);const t=d.filter(e=>{const t=new Date(e.date);return t>=s&&t<=a}).length;return{totalGames:d.length,thisWeekGames:t,onlinePlayers:w}},[d,w]),S=async()=>{if(!f){p(!1),N(!0);try{await j()}finally{N(!1)}}},D=d.map(e=>{const s=new Date(e.date),a=new Date,t=new Date(a);t.setDate(t.getDate()+1);let n="future",r=s.getTime();return s.toDateString()===a.toDateString()?(n="today",r=0):s.toDateString()===t.toDateString()&&(n="tomorrow",r=1),{...e,category:n,sortOrder:r,gameDate:s}}).sort((e,s)=>e.sortOrder!==s.sortOrder?e.sortOrder-s.sortOrder:e.gameDate.getTime()-s.gameDate.getTime());return h&&0===d.length?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading games..."})]})}):v&&0===d.length?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"Connection issues detected. Showing sample games."}),e.jsxs(l,{onClick:S,variant:"outline",children:[e.jsx(o,{className:"w-4 h-4 mr-2"})," Try Again"]})]})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"TribeUp"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your next game"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(l,{onClick:()=>n("/create-game"),className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Upcoming Games"}),e.jsxs(l,{variant:"outline",size:"sm",onClick:S,disabled:h,className:"hidden md:flex",children:[e.jsx(o,{className:"w-4 h-4 mr-2 "+(h?"animate-spin":"")}),"Refresh"]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:S,disabled:h,className:"md:hidden","aria-label":"Refresh games",children:e.jsx(o,{className:"w-4 h-4 "+(h?"animate-spin":"")})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h?Array.from({length:6}).map((s,a)=>e.jsx(u,{},a)):D.map(s=>e.jsx("div",{children:e.jsx(m,{game:s,variant:"simple",onSelect:()=>{return e=s.id,void n(`/game/${e}`);var e}})},s.id))})]}),e.jsx("div",{className:"hidden lg:block lg:col-span-4",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Active Games"}),e.jsx("span",{className:"font-semibold",children:b.totalGames})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Players Online"}),e.jsx("span",{className:"font-semibold",children:y?"...":b.onlinePlayers})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"This Week"}),e.jsx("span",{className:"font-semibold",children:b.thisWeekGames})]})]})]})}),e.jsx("div",{className:"lg:col-span-4 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-1 gap-4",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:y?"...":b.onlinePlayers}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Players Online"})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:b.thisWeekGames}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"This Week"})]})]})})]})})})}export{h as default};
//# sourceMappingURL=HomeScreen-ZaeU1kyD.js.map
