{"version":3,"file":"realtime-avatar-stack-CO3u1Ogv.js","sources":["../../src/components/ui/clickable-avatar.tsx","../../src/hooks/useGameJoinToggle.ts","../../src/components/avatar-stack.tsx","../../src/components/realtime-avatar-stack.tsx","../../src/hooks/use-realtime-presence-room.ts"],"sourcesContent":["import React from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Avatar, AvatarImage, AvatarFallback } from './avatar';\nimport { cn } from './utils';\n\ninterface ClickableAvatarProps {\n  userId?: string;\n  src?: string;\n  alt?: string;\n  fallback?: string;\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  className?: string;\n  onClick?: () => void;\n  disabled?: boolean;\n}\n\nconst sizeClasses = {\n  sm: 'size-6',\n  md: 'size-8', \n  lg: 'size-10',\n  xl: 'size-12'\n};\n\nexport function ClickableAvatar({\n  userId,\n  src,\n  alt,\n  fallback,\n  size = 'md',\n  className,\n  onClick,\n  disabled = false\n}: ClickableAvatarProps) {\n  const navigate = useNavigate();\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    \n    if (onClick) {\n      onClick();\n    } else if (userId && !disabled) {\n      navigate(`/user/${userId}`);\n    }\n  };\n\n  const getInitials = (name?: string) => {\n    if (!name) return '?';\n    \n    // Handle \"Unknown User\" case specifically\n    if (name.startsWith('Unknown User')) {\n      return '??';\n    }\n    \n    return name\n      .split(' ')\n      .map(word => word.charAt(0))\n      .join('')\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  return (\n    <Avatar\n      className={cn(\n        sizeClasses[size],\n        (userId || onClick) && !disabled && 'cursor-pointer hover:ring-2 hover:ring-primary/20 transition-all',\n        disabled && 'opacity-50 cursor-not-allowed',\n        className\n      )}\n      onClick={handleClick}\n    >\n      {src && (\n        <AvatarImage \n          src={src} \n          alt={alt || 'User avatar'} \n        />\n      )}\n      <AvatarFallback className=\"bg-primary/10 text-primary font-medium\">\n        {fallback || getInitials(alt)}\n      </AvatarFallback>\n    </Avatar>\n  );\n}\n","import { useCallback } from 'react';\nimport { toast } from 'sonner';\nimport { useJoinGame, useLeaveGame } from './useGames';\nimport { useAppStore } from '../store/appStore';\n\ninterface Game {\n  id: string;\n  isJoined: boolean;\n  [key: string]: any;\n}\n\n/**\n * Custom hook to handle game join/leave toggle functionality\n * Eliminates duplication of join/leave logic across components\n */\nexport function useGameJoinToggle() {\n  const joinGameMutation = useJoinGame();\n  const leaveGameMutation = useLeaveGame();\n  const { user } = useAppStore();\n  \n  /**\n   * Check if the current user is the creator of the game\n   */\n  const isGameCreator = useCallback((game: Game) => {\n    if (!user?.id) return false;\n    \n    // Check multiple possible creator ID fields\n    return game.creatorId === user.id || \n           game.creator_id === user.id || \n           game.createdBy === user.id ||\n           game.creatorData?.id === user.id;\n  }, [user?.id]);\n  \n  /**\n   * Toggle join/leave status for a game\n   * @param game - Game object with id and isJoined status\n   * @param e - Optional React MouseEvent to prevent propagation\n   */\n  const toggleJoin = useCallback((game: Game, e?: React.MouseEvent) => {\n    // Prevent event bubbling if provided (useful for cards)\n    e?.stopPropagation();\n    \n    console.log('ðŸŽ¯ toggleJoin called with game:', game.id, 'isJoined:', game.isJoined);\n    \n    if (game.isJoined) {\n      // Prevent creators from leaving their own games\n      if (isGameCreator(game)) {\n        toast.error('Cannot leave your own game', {\n          description: 'Use the menu options to delete the game instead.'\n        });\n        return;\n      }\n      \n      console.log('ðŸ”„ Attempting to leave game:', game.id);\n      leaveGameMutation.mutate(game.id, {\n        onSuccess: () => {\n          console.log('âœ… Leave game success callback');\n          toast.success('Left game successfully');\n        },\n        onError: (error) => {\n          console.error('âŒ Leave game error callback:', error);\n        }\n      });\n    } else {\n      console.log('ðŸ”„ Attempting to join game:', game.id);\n      joinGameMutation.mutate(game.id, {\n        onSuccess: () => {\n          console.log('âœ… Join game success callback');\n          toast.success('Joined game successfully!');\n        },\n        onError: (error) => {\n          console.error('âŒ Join game error callback:', error);\n        }\n      });\n    }\n  }, [joinGameMutation, leaveGameMutation, isGameCreator]);\n  \n  /**\n   * Check if join/leave operations are currently loading\n   */\n  const isLoading = joinGameMutation.isPending || leaveGameMutation.isPending;\n  \n  /**\n   * Get the appropriate button text based on game state and loading\n   * @param game - Game object with isJoined status\n   * @returns Button text string\n   */\n  const getButtonText = useCallback((game: Game) => {\n    if (isLoading) return '...';\n    \n    if (game.isJoined) {\n      // Creators shouldn't see a leave button since they can't leave\n      return isGameCreator(game) ? 'Joined' : 'Leave';\n    }\n    \n    return 'Join';\n  }, [isLoading, isGameCreator]);\n  \n  /**\n   * Get appropriate button variant based on game state\n   * @param game - Game object with isJoined status\n   * @returns Button variant string\n   */\n  const getButtonVariant = useCallback((game: Game) => {\n    if (game.isJoined) {\n      // Creators get secondary variant (disabled-like), participants get outline\n      return isGameCreator(game) ? 'secondary' : 'outline';\n    }\n    return 'default';\n  }, [isGameCreator]);\n  \n  return {\n    toggleJoin,\n    isLoading,\n    getButtonText,\n    getButtonVariant,\n    isGameCreator,\n    // Individual mutation states for advanced use cases\n    isJoining: joinGameMutation.isPending,\n    isLeaving: leaveGameMutation.isPending,\n  };\n}\n","import { cn } from '@/lib/utils'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport * as React from 'react'\n\nconst avatarStackVariants = cva('flex -space-x-4 -space-y-4', {\n  variants: {\n    orientation: {\n      vertical: 'flex-row',\n      horizontal: 'flex-col',\n    },\n  },\n  defaultVariants: {\n    orientation: 'vertical',\n  },\n})\n\nexport interface AvatarStackProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof avatarStackVariants> {\n  avatars: { name: string; image: string }[]\n  maxAvatarsAmount?: number\n}\n\nconst AvatarStack = ({\n  className,\n  orientation,\n  avatars,\n  maxAvatarsAmount = 3,\n  ...props\n}: AvatarStackProps) => {\n  const shownAvatars = avatars.slice(0, maxAvatarsAmount)\n  const hiddenAvatars = avatars.slice(maxAvatarsAmount)\n\n  return (\n    <div\n      className={cn(\n        avatarStackVariants({ orientation }),\n        className,\n        orientation === 'horizontal' ? '-space-x-0' : '-space-y-0'\n      )}\n      {...props}\n    >\n      {shownAvatars.map(({ name, image }, index) => (\n        <Tooltip key={`${name}-${image}-${index}`}>\n          <TooltipTrigger asChild>\n            <Avatar className=\"hover:z-10\">\n              <AvatarImage src={image} />\n              <AvatarFallback>\n                {name\n                  ?.split(' ')\n                  ?.map((word) => word[0])\n                  ?.join('')\n                  ?.toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p>{name}</p>\n          </TooltipContent>\n        </Tooltip>\n      ))}\n\n      {hiddenAvatars.length ? (\n        <Tooltip key=\"hidden-avatars\">\n          <TooltipTrigger asChild>\n            <Avatar>\n              <AvatarFallback>+{avatars.length - shownAvatars.length}</AvatarFallback>\n            </Avatar>\n          </TooltipTrigger>\n          <TooltipContent>\n            {hiddenAvatars.map(({ name }, index) => (\n              <p key={`${name}-${index}`}>{name}</p>\n            ))}\n          </TooltipContent>\n        </Tooltip>\n      ) : null}\n    </div>\n  )\n}\n\nexport { AvatarStack, avatarStackVariants }\n","import { AvatarStack } from '@/components/avatar-stack'\nimport { useRealtimePresenceRoom } from '@/hooks/use-realtime-presence-room'\nimport { useMemo } from 'react'\n\nexport const RealtimeAvatarStack = ({ roomName }: { roomName: string }) => {\n  const { users: usersMap } = useRealtimePresenceRoom(roomName)\n  const avatars = useMemo(() => {\n    return Object.values(usersMap).map((user) => ({\n      name: user.name,\n      image: user.image,\n    }))\n  }, [usersMap])\n\n  return <AvatarStack avatars={avatars} />\n}\n","import { useCurrentUserImage } from '@/hooks/use-current-user-image'\nimport { useCurrentUserName } from '@/hooks/use-current-user-name'\nimport { supabase } from '@/lib/supabase'\nimport { useEffect, useState } from 'react'\n\nexport type RealtimeUser = {\n  id: string\n  name: string\n  image: string\n}\n\nexport const useRealtimePresenceRoom = (roomName: string) => {\n  const currentUserImage = useCurrentUserImage()\n  const currentUserName = useCurrentUserName()\n\n  const [users, setUsers] = useState<Record<string, RealtimeUser>>({})\n\n  useEffect(() => {\n    const room = supabase.channel(roomName)\n\n    room\n      .on('presence', { event: 'sync' }, () => {\n        const newState = room.presenceState()\n\n        const newUsers = Object.fromEntries(\n          Object.entries(newState).map(([key, values]) => {\n            const userValues = values as Array<{ image: string; name: string }>;\n            return [\n              key,\n              { id: key, name: userValues[0]?.name || '', image: userValues[0]?.image || '' },\n            ];\n          })\n        ) as Record<string, RealtimeUser>\n        setUsers(newUsers)\n      })\n      .subscribe(async (status: string) => {\n        if (status !== 'SUBSCRIBED') {\n          return\n        }\n\n        await room.track({\n          name: currentUserName,\n          image: currentUserImage,\n        })\n      })\n\n    return () => {\n      room.unsubscribe()\n    }\n  }, [roomName, currentUserName, currentUserImage])\n\n  return { users }\n}\n"],"names":["sizeClasses","sm","md","lg","xl","ClickableAvatar","userId","src","alt","fallback","size","className","onClick","disabled","navigate","useNavigate","jsxs","Avatar","cn","e","stopPropagation","children","jsx","AvatarImage","AvatarFallback","name","startsWith","split","map","word","charAt","join","toUpperCase","slice","useGameJoinToggle","joinGameMutation","useJoinGame","leaveGameMutation","useLeaveGame","user","useAppStore","isGameCreator","useCallback","game","id","creatorId","creator_id","createdBy","creatorData","toggleJoin","isJoined","toast","error","description","mutate","onSuccess","success","onError","isLoading","isPending","getButtonText","getButtonVariant","isJoining","isLeaving","avatarStackVariants","cva","variants","orientation","vertical","horizontal","defaultVariants","AvatarStack","avatars","maxAvatarsAmount","props","shownAvatars","hiddenAvatars","image","index","Tooltip","TooltipTrigger","asChild","TooltipContent","length","RealtimeAvatarStack","roomName","users","usersMap","currentUserImage","useCurrentUserImage","currentUserName","useCurrentUserName","setUsers","useState","useEffect","room","supabase","channel","on","event","newState","presenceState","newUsers","Object","fromEntries","entries","key","values","userValues","subscribe","async","status","track","unsubscribe","useRealtimePresenceRoom","useMemo"],"mappings":"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"}