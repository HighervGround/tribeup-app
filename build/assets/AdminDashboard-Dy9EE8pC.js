import{j as e}from"./ui-CuzVkv4o.js";import{r as w}from"./vendor-Dit9F4CM.js";import{c as k,o as S,b as C,h as o,t as c,u as Q,C as n,f as m,g as u,a as i,B as d,d as A,T as B}from"./index-RcbufgnR.js";import{T as $}from"./textarea-C7cl1V-L.js";import{u as g,a as G}from"./useMutation-BCOebnYM.js";import{u as V}from"./useGames-CR7Qf6lm.js";import{S as f}from"./shield-CnvUxBqK.js";import{A as q}from"./arrow-left-C_jR-xpn.js";import{U as D}from"./users-BTv1k2s6.js";import{C as P}from"./calendar-CmJEM6gn.js";import{E as Y}from"./eye-Dg1QrU2t.js";import{T as O}from"./trash-2-DEHvnD5o.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],R=k("activity",J);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],W=k("user-check",X);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],I=k("user-x",Z),l={all:["admin"],users:()=>[...l.all,"users"],auditLog:()=>[...l.all,"auditLog"],permissions:a=>[...l.all,"permissions",a]};function ee(){const{user:a}=C();return g({queryKey:["admin","isAdmin",a?.id],queryFn:async()=>a?.id?await o.hasAdminRole(a.id):!1,enabled:!!a?.id,staleTime:5*60*1e3})}function se(){const{user:a}=C();return g({queryKey:["admin","isModerator",a?.id],queryFn:async()=>a?.id?await o.hasModeratorRole(a.id):!1,enabled:!!a?.id,staleTime:5*60*1e3})}function ae(){return g({queryKey:l.users(),queryFn:async()=>await o.getAllUsers(),staleTime:2*60*1e3})}function te(a=50){return g({queryKey:[...l.auditLog(),a],queryFn:async()=>await o.getAdminAuditLog(a),staleTime:1*60*1e3})}function re(){const a=S();return G({mutationFn:async({userId:t,role:r})=>await o.updateUserRole(t,r),onSuccess:(t,{userId:r,role:p})=>{a.invalidateQueries({queryKey:l.users()}),a.invalidateQueries({queryKey:l.auditLog()}),c.success("User role updated successfully!",{description:`User role changed to ${p}`})},onError:t=>{console.error("Update user role error:",t),c.error("Failed to update user role",{description:t instanceof Error?t.message:"Please try again later"})}})}function ne(){const a=S();return G({mutationFn:async({gameId:t,reason:r})=>await o.deleteGame(t,r),onSuccess:(t,{gameId:r})=>{a.invalidateQueries({queryKey:["games"]}),a.invalidateQueries({queryKey:l.auditLog()}),c.success("Game deleted successfully!",{description:"The game has been removed and participants have been notified"})},onError:t=>{console.error("Delete game error:",t),c.error("Failed to delete game",{description:t instanceof Error?t.message:"Please try again later"})}})}function ie(){const{data:a}=ee(),{data:t}=se();return{canDeleteAnyGame:a||t,canManageUsers:a,canViewAuditLog:a,canAssignModerators:a}}function Ne(){const a=Q(),{user:t}=C(),[r,p]=w.useState("overview"),[x,v]=w.useState(""),[L,N]=w.useState(null),{data:y,isLoading:_}=ae(),{data:U,isLoading:K}=V(),{data:M,isLoading:z}=te(),b=re(),h=ne();if(!ie()?.canViewAuditLog)return e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(n,{children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Access Denied"]})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"You don't have permission to access the admin dashboard."}),e.jsxs(d,{onClick:()=>a("/"),variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]})})});if(!t||t.role!=="admin")return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(n,{className:"w-full max-w-md",children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You don't have permission to access the admin dashboard."}),e.jsx(d,{onClick:()=>a("/"),children:"Return to Home"})]})})})});const T=(s,j)=>{if(s===t.id&&j!=="admin"){c.error("You cannot remove your own admin privileges");return}b.mutate({userId:s,role:j})},E=s=>{if(!x.trim()){c.error("Please provide a reason for deletion");return}h.mutate({gameId:s,reason:x},{onSuccess:()=>{N(null),v("")}})},F=s=>{switch(s){case"admin":return"destructive";case"moderator":return"default";default:return"secondary"}},H=[{id:"overview",label:"Overview",icon:R},{id:"users",label:"Users",icon:D},{id:"games",label:"Games",icon:P},{id:"audit",label:"Audit Log",icon:Y}];return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-12 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>a("/"),children:e.jsx(q,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage users, games, and platform settings"})]})]}),e.jsxs(A,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),"Admin"]})]}),e.jsx("div",{className:"px-4 mb-6",children:e.jsx("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg",children:H.map(s=>{const j=s.icon;return e.jsxs("button",{onClick:()=>p(s.id),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${r===s.id?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(j,{className:"w-4 h-4"}),s.label]},s.id)})})}),e.jsxs("div",{className:"px-4 space-y-6",children:[r==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:y?.length||0})]}),e.jsx(D,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Games"}),e.jsx("p",{className:"text-2xl font-bold",children:U?.length||0})]}),e.jsx(P,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Moderators"}),e.jsx("p",{className:"text-2xl font-bold",children:y?.filter(s=>s.role==="moderator").length||0})]}),e.jsx(f,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Recent Actions"}),e.jsx("p",{className:"text-2xl font-bold",children:M?.length||0})]}),e.jsx(R,{className:"w-8 h-8 text-muted-foreground"})]})})})]}),r==="users"&&e.jsxs(n,{children:[e.jsx(m,{children:e.jsx(u,{children:"User Management"})}),e.jsx(i,{children:_?e.jsx("p",{children:"Loading users..."}):e.jsx("div",{className:"space-y-4",children:y?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:s.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",s.username]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:F(s.role),children:s.role}),s.id!==t.id&&e.jsxs("div",{className:"flex gap-1",children:[s.role!=="moderator"&&e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>T(s.id,"moderator"),disabled:b.isPending,children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Make Moderator"]}),s.role!=="user"&&e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>T(s.id,"user"),disabled:b.isPending,children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Remove Role"]})]})]})]},s.id))})})]}),r==="games"&&e.jsxs(n,{children:[e.jsx(m,{children:e.jsx(u,{children:"Game Management"})}),e.jsx(i,{children:K?e.jsx("p",{children:"Loading games..."}):e.jsx("div",{className:"space-y-4",children:U?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.sport," • ",s.date," at ",s.time]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.location," • ",s.currentPlayers,"/",s.maxPlayers," players"]})]}),e.jsxs(d,{size:"sm",variant:"destructive",onClick:()=>N(s.id),disabled:h.isPending,children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Delete"]})]},s.id))})})]}),r==="audit"&&e.jsxs(n,{children:[e.jsx(m,{children:e.jsx(u,{children:"Audit Log"})}),e.jsx(i,{children:z?e.jsx("p",{children:"Loading audit log..."}):e.jsx("div",{className:"space-y-4",children:M?.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(A,{variant:"outline",children:s.action}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:s.admin?.full_name||"Unknown Admin"})," performed"," ",e.jsx("strong",{children:s.action})," on ",s.target_type,s.target_id&&` (${s.target_id.slice(0,8)}...)`]}),s.details&&e.jsx("pre",{className:"text-xs text-muted-foreground mt-2 bg-muted p-2 rounded",children:JSON.stringify(s.details,null,2)})]},s.id))})})]})]}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(n,{className:"w-full max-w-md",children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-destructive"}),"Delete Game"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone. Please provide a reason for deleting this game."}),e.jsx($,{placeholder:"Reason for deletion...",value:x,onChange:s=>v(s.target.value),rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{N(null),v("")},className:"flex-1",children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:()=>E(L),disabled:h.isPending||!x.trim(),className:"flex-1",children:h.isPending?"Deleting...":"Delete Game"})]})]})]})})]})}export{Ne as default};
//# sourceMappingURL=AdminDashboard-Dy9EE8pC.js.map
