import{j as e}from"./ui-Bqrh-KgM.js";import{e as s,r as a}from"./vendor-CVaDA-xz.js";import{u as r,S as i,C as t,d as n,e as d,a as l,B as c,b as o}from"./index-Dn2wyjF3.js";import{T as m}from"./textarea-Ca9ZlOmN.js";import{t as x,z as u,A as h,ae as j,h as g,f,a0 as p,af as N,ag as v,y as b,T as y}from"./utils-CNK9eq93.js";import{u as w,b as A,d as k}from"./data-D6RrWw63.js";import{u as L}from"./useGames-CLXKBZLD.js";const C={all:["admin"],users:()=>[...C.all,"users"],auditLog:()=>[...C.all,"auditLog"],permissions:e=>[...C.all,"permissions",e]};function q(){const{data:e}=function(){const{user:e}=r();return w({queryKey:["admin","isAdmin",e?.id],queryFn:async()=>!!e?.id&&await i.hasAdminRole(e.id),enabled:!!e?.id,staleTime:3e5})}(),{data:s}=function(){const{user:e}=r();return w({queryKey:["admin","isModerator",e?.id],queryFn:async()=>!!e?.id&&await i.hasModeratorRole(e.id),enabled:!!e?.id,staleTime:3e5})}();return{canDeleteAnyGame:e||s,canManageUsers:e,canViewAuditLog:e,canAssignModerators:e}}function P(){const P=s(),{user:U}=r(),[M,D]=a.useState("overview"),[G,S]=a.useState(""),[T,F]=a.useState(null),{data:K,isLoading:R}=w({queryKey:C.users(),queryFn:async()=>await i.getAllUsers(),staleTime:12e4}),{data:z,isLoading:I}=L(),{data:_,isLoading:E}=function(e=50){return w({queryKey:[...C.auditLog(),e],queryFn:async()=>await i.getAdminAuditLog(e),staleTime:6e4})}(),Q=function(){const e=A();return k({mutationFn:async({userId:e,role:s})=>await i.updateUserRole(e,s),onSuccess:(s,{userId:a,role:r})=>{e.invalidateQueries({queryKey:C.users()}),e.invalidateQueries({queryKey:C.auditLog()}),x.success("User role updated successfully!",{description:`User role changed to ${r}`})},onError:e=>{x.error("Failed to update user role",{description:e instanceof Error?e.message:"Please try again later"})}})}(),Y=function(){const e=A();return k({mutationFn:async({gameId:e,reason:s})=>await i.deleteGame(e,s),onSuccess:(s,{gameId:a})=>{e.invalidateQueries({queryKey:["games"]}),e.invalidateQueries({queryKey:C.auditLog()}),x.success("Game deleted successfully!",{description:"The game has been removed and participants have been notified"})},onError:e=>{x.error("Failed to delete game",{description:e instanceof Error?e.message:"Please try again later"})}})}(),B=q();if(!B?.canViewAuditLog)return e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5"}),"Access Denied"]})}),e.jsxs(l,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"You don't have permission to access the admin dashboard."}),e.jsxs(c,{onClick:()=>P("/"),variant:"outline",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]})})});if(!U||"admin"!==U.role)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(t,{className:"w-full max-w-md",children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You don't have permission to access the admin dashboard."}),e.jsx(c,{onClick:()=>P("/"),children:"Return to Home"})]})})})});const H=(e,s)=>{e!==U.id||"admin"===s?Q.mutate({userId:e,role:s}):x.error("You cannot remove your own admin privileges")},O=e=>{switch(e){case"admin":return"destructive";case"moderator":return"default";default:return"secondary"}},V=[{id:"overview",label:"Overview",icon:j},{id:"users",label:"Users",icon:g},{id:"games",label:"Games",icon:f},{id:"audit",label:"Audit Log",icon:p}];return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-12 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>P("/"),children:e.jsx(h,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage users, games, and platform settings"})]})]}),e.jsxs(o,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(u,{className:"w-3 h-3"}),"Admin"]})]}),e.jsx("div",{className:"px-4 mb-6",children:e.jsx("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg",children:V.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>D(s.id),className:"flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors "+(M===s.id?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(a,{className:"w-4 h-4"}),s.label]},s.id)})})}),e.jsxs("div",{className:"px-4 space-y-6",children:["overview"===M&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(t,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:K?.length||0})]}),e.jsx(g,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(t,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Games"}),e.jsx("p",{className:"text-2xl font-bold",children:z?.length||0})]}),e.jsx(f,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(t,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Moderators"}),e.jsx("p",{className:"text-2xl font-bold",children:K?.filter(e=>"moderator"===e.role).length||0})]}),e.jsx(u,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(t,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Recent Actions"}),e.jsx("p",{className:"text-2xl font-bold",children:_?.length||0})]}),e.jsx(j,{className:"w-8 h-8 text-muted-foreground"})]})})})]}),"users"===M&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(d,{children:"User Management"})}),e.jsx(l,{children:R?e.jsx("p",{children:"Loading users..."}):e.jsx("div",{className:"space-y-4",children:K?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:s.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",s.username]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:O(s.role),children:s.role}),s.id!==U.id&&e.jsxs("div",{className:"flex gap-1",children:["moderator"!==s.role&&e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>H(s.id,"moderator"),disabled:Q.isPending,children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"Make Moderator"]}),"user"!==s.role&&e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>H(s.id,"user"),disabled:Q.isPending,children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"Remove Role"]})]})]})]},s.id))})})]}),"games"===M&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(d,{children:"Game Management"})}),e.jsx(l,{children:I?e.jsx("p",{children:"Loading games..."}):e.jsx("div",{className:"space-y-4",children:z?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.sport," • ",s.date," at ",s.time]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.location," • ",s.currentPlayers,"/",s.maxPlayers," players"]})]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>F(s.id),disabled:Y.isPending,children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Delete"]})]},s.id))})})]}),"audit"===M&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(d,{children:"Audit Log"})}),e.jsx(l,{children:E?e.jsx("p",{children:"Loading audit log..."}):e.jsx("div",{className:"space-y-4",children:_?.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(o,{variant:"outline",children:s.action}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:s.admin?.full_name||"Unknown Admin"})," performed"," ",e.jsx("strong",{children:s.action})," on ",s.target_type,s.target_id&&` (${s.target_id.slice(0,8)}...)`]}),s.details&&e.jsx("pre",{className:"text-xs text-muted-foreground mt-2 bg-muted p-2 rounded",children:JSON.stringify(s.details,null,2)})]},s.id))})})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(t,{className:"w-full max-w-md",children:[e.jsx(n,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-destructive"}),"Delete Game"]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone. Please provide a reason for deleting this game."}),e.jsx(m,{placeholder:"Reason for deletion...",value:G,onChange:e=>S(e.target.value),rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{F(null),S("")},className:"flex-1",children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:()=>{return e=T,void(G.trim()?Y.mutate({gameId:e,reason:G},{onSuccess:()=>{F(null),S("")}}):x.error("Please provide a reason for deletion"));var e},disabled:Y.isPending||!G.trim(),className:"flex-1",children:Y.isPending?"Deleting...":"Delete Game"})]})]})]})})]})}export{P as default};
//# sourceMappingURL=AdminDashboard-ZoubyOb2.js.map
