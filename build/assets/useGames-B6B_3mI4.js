import{u as e,b as a,d as t}from"./data-pHbUkPVm.js";import{u as i,S as r}from"./index-9DMutt-e.js";import{t as s}from"./utils-B5KmqWpW.js";const u={all:["games"],lists:()=>[...u.all,"list"],list:e=>[...u.lists(),{filters:e}],details:()=>[...u.all,"detail"],detail:e=>[...u.details(),e],participants:e=>[...u.detail(e),"participants"]};function n(){const{user:a}=i();return e({queryKey:u.lists(),queryFn:async()=>await r.getGames(),staleTime:12e4,gcTime:3e5})}function y(a){return e({queryKey:u.detail(a),queryFn:async()=>await r.getGameById(a),enabled:!!a})}function l(a){return e({queryKey:u.participants(a),queryFn:()=>r.getGameParticipants(a),enabled:!!a,staleTime:6e4})}function c(){const e=a(),{user:n}=i();return t({mutationFn:async e=>{await r.joinGame(e)},onMutate:async a=>{await e.cancelQueries({queryKey:u.lists()}),await e.cancelQueries({queryKey:u.detail(a)}),await e.cancelQueries({queryKey:u.participants(a)});const t=e.getQueryData(u.lists()),i=e.getQueryData(u.detail(a)),r=e.getQueryData(u.participants(a));return e.setQueryData(u.lists(),e=>e?e.map(e=>e.id===a?{...e,isJoined:!0,currentPlayers:Math.min(e.currentPlayers+1,e.maxPlayers)}:e):e),e.setQueryData(u.detail(a),e=>e?{...e,isJoined:!0,currentPlayers:Math.min(e.currentPlayers+1,e.maxPlayers)}:e),n&&e.setQueryData(u.participants(a),e=>{if(!e)return[{id:n.id,name:n.name,avatar:n.avatar}];return e.some(e=>e.id===n.id)?e:[...e,{id:n.id,name:n.name,avatar:n.avatar}]}),{previousGames:t,previousGame:i,previousParticipants:r}},onError:(a,t,i)=>{i?.previousGames&&e.setQueryData(u.lists(),i.previousGames),i?.previousGame&&e.setQueryData(u.detail(t),i.previousGame),i?.previousParticipants&&e.setQueryData(u.participants(t),i.previousParticipants),s.error("Failed to join game",{description:"Please try again later"})},onSuccess:(a,t)=>{e.refetchQueries({queryKey:u.detail(t)}),e.refetchQueries({queryKey:u.participants(t)}),e.refetchQueries({queryKey:u.lists()}),e.invalidateQueries({queryKey:u.detail(t)}),e.invalidateQueries({queryKey:u.participants(t)}),e.invalidateQueries({queryKey:u.lists()})}})}function p(){const e=a();return t({mutationFn:async e=>{await r.leaveGame(e)},onMutate:async a=>{await e.cancelQueries({queryKey:u.lists()}),await e.cancelQueries({queryKey:u.detail(a)}),await e.cancelQueries({queryKey:u.participants(a)});const t=e.getQueryData(u.lists()),r=e.getQueryData(u.detail(a)),s=e.getQueryData(u.participants(a));e.setQueryData(u.lists(),e=>e?e.map(e=>e.id===a?{...e,isJoined:!1,currentPlayers:Math.max(e.currentPlayers-1,0)}:e):e),e.setQueryData(u.detail(a),e=>e?{...e,isJoined:!1,currentPlayers:Math.max(e.currentPlayers-1,0)}:e);const{user:n}=i.getState();return n&&e.setQueryData(u.participants(a),e=>e?e.filter(e=>e.id!==n.id):[]),{previousGames:t,previousGame:r,previousParticipants:s}},onError:(a,t,i)=>{i?.previousGames&&e.setQueryData(u.lists(),i.previousGames),i?.previousGame&&e.setQueryData(u.detail(t),i.previousGame),i?.previousParticipants&&e.setQueryData(u.participants(t),i.previousParticipants),s.error("Failed to leave game",{description:"Please try again later"})},onSuccess:(a,t)=>{e.refetchQueries({queryKey:u.detail(t)}),e.refetchQueries({queryKey:u.participants(t)}),e.refetchQueries({queryKey:u.lists()}),e.invalidateQueries({queryKey:u.detail(t)}),e.invalidateQueries({queryKey:u.participants(t)}),e.invalidateQueries({queryKey:u.lists()})}})}export{y as a,l as b,c,p as d,n as u};
//# sourceMappingURL=useGames-B6B_3mI4.js.map
