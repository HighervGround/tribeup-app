{"version":3,"file":"AuthCallback-CeblsoIa.js","sources":["../../src/components/AuthCallback.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { supabase } from '../lib/supabase';\nimport { SupabaseService } from '../lib/supabaseService';\nimport { useAppStore } from '../store/appStore';\nimport { LoadingSpinner } from './ui/loading-spinner';\nimport { Card, CardContent } from './ui/card';\nimport { Alert, AlertDescription } from './ui/alert';\nimport { CheckCircle, XCircle } from 'lucide-react';\n\nfunction AuthCallback() {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');\n  const [message, setMessage] = useState('Processing authentication...');\n  const { setUser } = useAppStore();\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        // Handle the OAuth callback\n        const { data, error } = await supabase.auth.getSession();\n        \n        if (error) {\n          console.error('Auth callback error:', error);\n          setStatus('error');\n          setMessage(error.message || 'Authentication failed');\n          return;\n        }\n\n        if (!data.session?.user) {\n          setStatus('error');\n          setMessage('No user session found');\n          return;\n        }\n\n        const user = data.session.user;\n        console.log('OAuth user authenticated:', user.id);\n\n        // Check if user profile exists\n        let userProfile = await SupabaseService.getUserProfile(user.id);\n        \n        if (!userProfile) {\n          // Create profile for OAuth user\n          console.log('Creating profile for OAuth user...');\n          \n          const profileData = {\n            email: user.email || '',\n            name: user.user_metadata?.full_name || user.user_metadata?.name || user.email?.split('@')[0] || 'User',\n            username: user.user_metadata?.preferred_username || \n                     user.user_metadata?.user_name || \n                     user.email?.split('@')[0] || \n                     `user_${Math.random().toString(36).substring(2, 10)}`,\n            avatar: user.user_metadata?.avatar_url || user.user_metadata?.picture || '',\n            bio: '',\n            location: '',\n            role: 'user' as const,\n            selectedSports: []\n          };\n\n          try {\n            await SupabaseService.createUserProfile(user.id, profileData);\n            userProfile = await SupabaseService.getUserProfile(user.id);\n          } catch (profileError) {\n            console.error('Error creating OAuth user profile:', profileError);\n            // Continue with basic user data\n            userProfile = {\n              id: user.id,\n              email: user.email || '',\n              name: profileData.name,\n              username: profileData.username,\n              avatar: profileData.avatar,\n              bio: '',\n              location: '',\n              role: 'user' as const,\n              preferences: {\n                theme: 'auto' as const,\n                highContrast: false,\n                largeText: false,\n                reducedMotion: false,\n                colorBlindFriendly: false,\n                notifications: {\n                  push: true,\n                  email: false,\n                  gameReminders: true,\n                },\n                privacy: {\n                  locationSharing: true,\n                  profileVisibility: 'public' as const,\n                },\n                sports: []\n              }\n            };\n          }\n        }\n\n        // Set user in app store\n        setUser(userProfile);\n        \n        setStatus('success');\n        setMessage('Authentication successful! Redirecting...');\n\n        // Check for pending game join\n        const pendingGameId = localStorage.getItem('pendingGameJoin');\n        if (pendingGameId) {\n          localStorage.removeItem('pendingGameJoin');\n          // Redirect to game page\n          setTimeout(() => navigate(`/game/${pendingGameId}`), 1500);\n        } else {\n          // Check if profile is complete\n          if (userProfile) {\n            const isComplete = userProfile.name && userProfile.username;\n            if (!isComplete) {\n              setTimeout(() => navigate('/onboarding'), 1500);\n            } else {\n              setTimeout(() => navigate('/'), 1500);\n            }\n          } else {\n            setTimeout(() => navigate('/onboarding'), 1500);\n          }\n        }\n\n      } catch (error) {\n        console.error('Auth callback error:', error);\n        setStatus('error');\n        setMessage('Authentication failed. Please try again.');\n        setTimeout(() => navigate('/auth'), 3000);\n      }\n    };\n\n    handleAuthCallback();\n  }, [navigate, setUser, searchParams]);\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center space-y-4\">\n            {status === 'loading' && (\n              <>\n                <LoadingSpinner size=\"lg\" />\n                <h2 className=\"text-xl font-semibold\">Completing Sign In</h2>\n                <p className=\"text-muted-foreground\">{message}</p>\n              </>\n            )}\n            \n            {status === 'success' && (\n              <>\n                <CheckCircle className=\"w-12 h-12 text-green-500 mx-auto\" />\n                <h2 className=\"text-xl font-semibold text-green-700\">Success!</h2>\n                <p className=\"text-muted-foreground\">{message}</p>\n              </>\n            )}\n            \n            {status === 'error' && (\n              <>\n                <XCircle className=\"w-12 h-12 text-red-500 mx-auto\" />\n                <h2 className=\"text-xl font-semibold text-red-700\">Authentication Error</h2>\n                <Alert variant=\"destructive\">\n                  <AlertDescription>{message}</AlertDescription>\n                </Alert>\n                <p className=\"text-sm text-muted-foreground\">\n                  Redirecting to sign in page...\n                </p>\n              </>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default AuthCallback;\n"],"names":["AuthCallback","navigate","useNavigate","searchParams","useSearchParams","status","setStatus","useState","message","setMessage","setUser","useAppStore","useEffect","async","data","error","supabase","auth","getSession","session","user","userProfile","SupabaseService","getUserProfile","id","profileData","email","name","user_metadata","full_name","split","username","preferred_username","user_name","Math","random","toString","substring","avatar","avatar_url","picture","bio","location","role","selectedSports","createUserProfile","profileError","preferences","theme","highContrast","largeText","reducedMotion","colorBlindFriendly","notifications","push","gameReminders","privacy","locationSharing","profileVisibility","sports","pendingGameId","localStorage","getItem","removeItem","setTimeout","handleAuthCallback","jsx","className","children","Card","CardContent","jsxs","Fragment","LoadingSpinner","size","CheckCircle","XCircle","Alert","variant","AlertDescription"],"mappings":"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"}