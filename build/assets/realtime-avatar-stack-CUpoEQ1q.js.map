{"version":3,"file":"realtime-avatar-stack-CUpoEQ1q.js","sources":["../../src/hooks/useGameJoinToggle.ts","../../src/components/avatar-stack.tsx","../../src/hooks/use-realtime-presence-room.ts","../../src/hooks/use-current-user-image.ts","../../src/hooks/use-current-user-name.ts","../../src/components/realtime-avatar-stack.tsx"],"sourcesContent":["import { useCallback } from 'react';\nimport { toast } from 'sonner';\nimport { useJoinGame, useLeaveGame } from './useGames';\nimport { useAppStore } from '../store/appStore';\n\ninterface Game {\n  id: string;\n  isJoined: boolean;\n  [key: string]: any;\n}\n\n/**\n * Custom hook to handle game join/leave toggle functionality\n * Eliminates duplication of join/leave logic across components\n */\nexport function useGameJoinToggle() {\n  const joinGameMutation = useJoinGame();\n  const leaveGameMutation = useLeaveGame();\n  const { user } = useAppStore();\n  \n  /**\n   * Check if the current user is the creator of the game\n   */\n  const isGameCreator = useCallback((game: Game) => {\n    if (!user?.id) return false;\n    \n    // Check multiple possible creator ID fields\n    return game.creatorId === user.id || \n           game.creator_id === user.id || \n           game.createdBy === user.id ||\n           game.creatorData?.id === user.id;\n  }, [user?.id]);\n  \n  /**\n   * Toggle join/leave status for a game\n   * @param game - Game object with id and isJoined status\n   * @param e - Optional React MouseEvent to prevent propagation\n   */\n  const toggleJoin = useCallback((game: Game, e?: React.MouseEvent) => {\n    // Prevent event bubbling if provided (useful for cards)\n    e?.stopPropagation();\n    \n    console.log('ðŸŽ¯ toggleJoin called with game:', game.id, 'isJoined:', game.isJoined);\n    \n    if (game.isJoined) {\n      // Prevent creators from leaving their own games\n      if (isGameCreator(game)) {\n        toast.error('Cannot leave your own game', {\n          description: 'Use the menu options to delete the game instead.'\n        });\n        return;\n      }\n      \n      console.log('ðŸ”„ Attempting to leave game:', game.id);\n      leaveGameMutation.mutate(game.id, {\n        onSuccess: () => {\n          console.log('âœ… Leave game success callback');\n          toast.success('Left game successfully');\n        },\n        onError: (error) => {\n          console.error('âŒ Leave game error callback:', error);\n        }\n      });\n    } else {\n      console.log('ðŸ”„ Attempting to join game:', game.id);\n      joinGameMutation.mutate(game.id, {\n        onSuccess: () => {\n          console.log('âœ… Join game success callback');\n          toast.success('Joined game successfully!');\n        },\n        onError: (error) => {\n          console.error('âŒ Join game error callback:', error);\n        }\n      });\n    }\n  }, [joinGameMutation, leaveGameMutation, isGameCreator]);\n  \n  /**\n   * Check if join/leave operations are currently loading\n   */\n  const isLoading = joinGameMutation.isPending || leaveGameMutation.isPending;\n  \n  /**\n   * Get the appropriate button text based on game state and loading\n   * @param game - Game object with isJoined status\n   * @returns Button text string\n   */\n  const getButtonText = useCallback((game: Game) => {\n    if (isLoading) return '...';\n    \n    if (game.isJoined) {\n      // Creators shouldn't see a leave button since they can't leave\n      return isGameCreator(game) ? 'Joined' : 'Leave';\n    }\n    \n    return 'Join';\n  }, [isLoading, isGameCreator]);\n  \n  /**\n   * Get appropriate button variant based on game state\n   * @param game - Game object with isJoined status\n   * @returns Button variant string\n   */\n  const getButtonVariant = useCallback((game: Game) => {\n    if (game.isJoined) {\n      // Creators get secondary variant (disabled-like), participants get outline\n      return isGameCreator(game) ? 'secondary' : 'outline';\n    }\n    return 'default';\n  }, [isGameCreator]);\n  \n  return {\n    toggleJoin,\n    isLoading,\n    getButtonText,\n    getButtonVariant,\n    isGameCreator,\n    // Individual mutation states for advanced use cases\n    isJoining: joinGameMutation.isPending,\n    isLeaving: leaveGameMutation.isPending,\n  };\n}\n","import { cn } from '@/lib/utils'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport * as React from 'react'\n\nconst avatarStackVariants = cva('flex -space-x-4 -space-y-4', {\n  variants: {\n    orientation: {\n      vertical: 'flex-row',\n      horizontal: 'flex-col',\n    },\n  },\n  defaultVariants: {\n    orientation: 'vertical',\n  },\n})\n\nexport interface AvatarStackProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof avatarStackVariants> {\n  avatars: { name: string; image: string }[]\n  maxAvatarsAmount?: number\n}\n\nconst AvatarStack = ({\n  className,\n  orientation,\n  avatars,\n  maxAvatarsAmount = 3,\n  ...props\n}: AvatarStackProps) => {\n  const shownAvatars = avatars.slice(0, maxAvatarsAmount)\n  const hiddenAvatars = avatars.slice(maxAvatarsAmount)\n\n  return (\n    <div\n      className={cn(\n        avatarStackVariants({ orientation }),\n        className,\n        orientation === 'horizontal' ? '-space-x-0' : '-space-y-0'\n      )}\n      {...props}\n    >\n      {shownAvatars.map(({ name, image }, index) => (\n        <Tooltip key={`${name}-${image}-${index}`}>\n          <TooltipTrigger asChild>\n            <Avatar className=\"hover:z-10\">\n              <AvatarImage src={image} />\n              <AvatarFallback>\n                {name\n                  ?.split(' ')\n                  ?.map((word) => word[0])\n                  ?.join('')\n                  ?.toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p>{name}</p>\n          </TooltipContent>\n        </Tooltip>\n      ))}\n\n      {hiddenAvatars.length ? (\n        <Tooltip key=\"hidden-avatars\">\n          <TooltipTrigger asChild>\n            <Avatar>\n              <AvatarFallback>+{avatars.length - shownAvatars.length}</AvatarFallback>\n            </Avatar>\n          </TooltipTrigger>\n          <TooltipContent>\n            {hiddenAvatars.map(({ name }, index) => (\n              <p key={`${name}-${index}`}>{name}</p>\n            ))}\n          </TooltipContent>\n        </Tooltip>\n      ) : null}\n    </div>\n  )\n}\n\nexport { AvatarStack, avatarStackVariants }\n","import { useCurrentUserImage } from '@/hooks/use-current-user-image'\nimport { useCurrentUserName } from '@/hooks/use-current-user-name'\nimport { supabase } from '@/lib/supabase'\nimport { useEffect, useState } from 'react'\n\nexport type RealtimeUser = {\n  id: string\n  name: string\n  image: string\n}\n\nexport const useRealtimePresenceRoom = (roomName: string) => {\n  const currentUserImage = useCurrentUserImage()\n  const currentUserName = useCurrentUserName()\n\n  const [users, setUsers] = useState<Record<string, RealtimeUser>>({})\n\n  useEffect(() => {\n    const room = supabase.channel(roomName)\n\n    room\n      .on('presence', { event: 'sync' }, () => {\n        const newState = room.presenceState()\n\n        const newUsers = Object.fromEntries(\n          Object.entries(newState).map(([key, values]) => {\n            const userValues = values as Array<{ image: string; name: string }>;\n            return [\n              key,\n              { id: key, name: userValues[0]?.name || '', image: userValues[0]?.image || '' },\n            ];\n          })\n        ) as Record<string, RealtimeUser>\n        setUsers(newUsers)\n      })\n      .subscribe(async (status: string) => {\n        if (status !== 'SUBSCRIBED') {\n          return\n        }\n\n        await room.track({\n          name: currentUserName,\n          image: currentUserImage,\n        })\n      })\n\n    return () => {\n      room.unsubscribe()\n    }\n  }, [roomName, currentUserName, currentUserImage])\n\n  return { users }\n}\n","import { useAppStore } from '@/store/appStore'\n\nexport const useCurrentUserImage = () => {\n  const { user } = useAppStore()\n  \n  return user?.avatar || ''\n}\n","import { useAppStore } from '@/store/appStore'\n\nexport const useCurrentUserName = () => {\n  const { user } = useAppStore()\n  \n  return user?.name || user?.email?.split('@')[0] || 'Anonymous'\n}\n","import { AvatarStack } from '@/components/avatar-stack'\nimport { useRealtimePresenceRoom } from '@/hooks/use-realtime-presence-room'\nimport { useMemo } from 'react'\n\nexport const RealtimeAvatarStack = ({ roomName }: { roomName: string }) => {\n  const { users: usersMap } = useRealtimePresenceRoom(roomName)\n  const avatars = useMemo(() => {\n    return Object.values(usersMap).map((user) => ({\n      name: user.name,\n      image: user.image,\n    }))\n  }, [usersMap])\n\n  return <AvatarStack avatars={avatars} />\n}\n"],"names":["useGameJoinToggle","joinGameMutation","useJoinGame","leaveGameMutation","useLeaveGame","user","useAppStore","isGameCreator","useCallback","game","id","creatorId","creator_id","createdBy","creatorData","toggleJoin","e","stopPropagation","isJoined","toast","error","description","mutate","onSuccess","success","onError","isLoading","isPending","getButtonText","getButtonVariant","isJoining","isLeaving","avatarStackVariants","cva","variants","orientation","vertical","horizontal","defaultVariants","AvatarStack","className","avatars","maxAvatarsAmount","props","shownAvatars","slice","hiddenAvatars","jsxs","cn","children","map","name","image","index","Tooltip","jsx","TooltipTrigger","asChild","Avatar","AvatarImage","src","AvatarFallback","split","word","join","toUpperCase","TooltipContent","length","useRealtimePresenceRoom","roomName","currentUserImage","avatar","useCurrentUserImage","currentUserName","email","useCurrentUserName","users","setUsers","useState","useEffect","room","supabase","channel","on","event","newState","presenceState","newUsers","Object","fromEntries","entries","key","values","userValues","subscribe","async","status","track","unsubscribe","RealtimeAvatarStack","usersMap","useMemo"],"mappings":"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"}