{"version":3,"file":"HomeScreen-DadnCdyn.js","sources":["../../src/stores/presenceStore.ts","../../src/hooks/useUserPresence.ts","../../src/components/GameCardSkeleton.tsx","../../src/components/HomeScreen.tsx"],"sourcesContent":["import { create } from 'zustand';\n\nexport type PresenceUser = {\n  user_id: string;\n  name: string;\n  avatar?: string;\n  last_seen: string;\n  status?: 'online' | 'in_game' | 'away';\n};\n\ntype PresenceState = {\n  onlineUsers: Record<string, PresenceUser>;\n  channelStatus: 'closed' | 'joining' | 'joined' | 'error';\n  usePolling: boolean;\n  isLoading: boolean;\n  error: string | null;\n  \n  // Actions\n  setOnlineUsers: (users: Record<string, PresenceUser>) => void;\n  setChannelStatus: (status: PresenceState['channelStatus']) => void;\n  setUsePolling: (value: boolean) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n};\n\nexport const usePresenceStore = create<PresenceState>((set) => ({\n  onlineUsers: {},\n  channelStatus: 'closed',\n  usePolling: false,\n  isLoading: true,\n  error: null,\n  \n  setOnlineUsers: (users) => set({ onlineUsers: users }),\n  setChannelStatus: (status) => set({ channelStatus: status }),\n  setUsePolling: (value) => set({ usePolling: value }),\n  setLoading: (loading) => set({ isLoading: loading }),\n  setError: (error) => set({ error }),\n}));\n","import { useEffect, useRef } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { useAppStore } from '../store/appStore';\nimport { usePresenceStore, type PresenceUser } from '../stores/presenceStore';\n\nexport function useUserPresence() {\n  const { user } = useAppStore();\n  const { \n    onlineUsers, \n    channelStatus, \n    usePolling, \n    isLoading, \n    error,\n    setOnlineUsers,\n    setChannelStatus,\n    setUsePolling,\n    setLoading,\n    setError\n  } = usePresenceStore();\n  \n  const pollTimer = useRef<number | null>(null);\n  const channelRef = useRef<any>(null);\n\n  // Polling fallback function\n  const startPolling = async () => {\n    if (pollTimer.current) return;\n    \n    console.log('ðŸ”„ Starting presence polling fallback');\n    setUsePolling(true);\n    \n    const pollPresence = async () => {\n      try {\n        if (!user?.id) return;\n        \n        // Update our presence (now with name/avatar columns)\n        await supabase\n          .from('user_presence')\n          .upsert({\n            user_id: user.id,\n            name: user.name,\n            avatar: user.avatar,\n            last_seen: new Date().toISOString(),\n            is_online: true,\n          });\n\n        // Get active users (last 5 minutes)\n        const { data: presenceData } = await supabase\n          .from('user_presence')\n          .select('*')\n          .gte('last_seen', new Date(Date.now() - 5 * 60 * 1000).toISOString());\n\n        if (presenceData) {\n          const usersMap: Record<string, PresenceUser> = {};\n          presenceData.forEach((p) => {\n            usersMap[p.user_id] = {\n              user_id: p.user_id,\n              name: p.name || 'Anonymous',\n              avatar: p.avatar || '',\n              last_seen: p.last_seen,\n              status: 'online'\n            };\n          });\n          \n          setOnlineUsers(usersMap);\n          setError(null);\n        }\n      } catch (err) {\n        console.error('Polling error:', err);\n        setError('Polling failed');\n      }\n    };\n\n    // Poll immediately, then every 30 seconds\n    await pollPresence();\n    pollTimer.current = window.setInterval(pollPresence, 30000);\n  };\n\n  const stopPolling = () => {\n    if (pollTimer.current) {\n      console.log('â¹ï¸ Stopping presence polling');\n      window.clearInterval(pollTimer.current);\n      pollTimer.current = null;\n    }\n    setUsePolling(false);\n  };\n\n  // Realtime presence function\n  const startRealtime = () => {\n    if (!user?.id) return;\n    \n    console.log('ðŸ”— Starting realtime presence');\n    \n    const channel = supabase.channel('global-presence', {\n      config: {\n        presence: {\n          key: user.id,\n        },\n      },\n    });\n\n    channelRef.current = channel;\n\n    channel\n      .on('presence', { event: 'sync' }, () => {\n        console.log('ï¿½ï¿½ Presence sync');\n        const state = channel.presenceState();\n        const usersMap = Object.keys(state).reduce<Record<string, PresenceUser>>((acc, userId) => {\n          const presence = state[userId][0];\n          acc[userId] = {\n            user_id: userId,\n            name: presence.name || 'Anonymous',\n            avatar: presence.avatar || '',\n            last_seen: new Date().toISOString(),\n            status: 'online'\n          };\n          return acc;\n        }, {});\n        \n        setOnlineUsers(usersMap);\n        setLoading(false);\n        setError(null);\n      })\n      .on('presence', { event: 'join' }, ({ key, newPresences }) => {\n        console.log('ðŸ‘‹ User joined:', key);\n      })\n      .on('presence', { event: 'leave' }, ({ key, leftPresences }) => {\n        console.log('ðŸ‘‹ User left:', key);\n      })\n      .subscribe(async (status) => {\n        console.log('ðŸ“¡ Channel status:', status);\n        \n        if (status === 'SUBSCRIBED') {\n          setChannelStatus('joined');\n          stopPolling(); // Stop polling when realtime works\n          \n          // Track our presence\n          await channel.track({\n            name: user.name,\n            avatar: user.avatar,\n            online_at: new Date().toISOString(),\n          });\n          \n          // Also update database for persistence\n          await supabase\n            .from('user_presence')\n            .upsert({\n              user_id: user.id,\n              name: user.name,\n              avatar: user.avatar,\n              last_seen: new Date().toISOString(),\n              is_online: true,\n            });\n          \n        } else if (status === 'CHANNEL_ERROR') {\n          setChannelStatus('error');\n          setError('Realtime connection failed');\n          startPolling(); // Fallback to polling\n          \n        } else if (status === 'CLOSED') {\n          setChannelStatus('closed');\n          startPolling(); // Fallback to polling\n          \n        } else {\n          setChannelStatus('joining');\n        }\n      });\n  };\n\n  useEffect(() => {\n    console.log('ðŸ”„ PRESENCE SYSTEM v2.0 - useUserPresence hook called');\n    console.log('ðŸ”„ User state:', user ? `ID: ${user.id}, Name: ${user.name}` : 'NO USER');\n    \n    if (!user?.id) {\n      console.log('ðŸ‘¤ No authenticated user - presence disabled');\n      setLoading(false);\n      setOnlineUsers({});\n      return;\n    }\n\n    console.log('ðŸ‘¤ Authenticated user found:', user.id, 'Starting presence system');\n    setLoading(true);\n    \n    // Try realtime first\n    try {\n      startRealtime();\n    } catch (error) {\n      console.error('Failed to start realtime, falling back to polling:', error);\n      startPolling();\n    }\n\n    // Cleanup function\n    return () => {\n      if (channelRef.current) {\n        channelRef.current.unsubscribe();\n      }\n      stopPolling();\n      setChannelStatus('closed');\n    };\n  }, [user?.id]);\n\n  return {\n    onlineUsers: Object.values(onlineUsers),\n    onlineCount: Object.keys(onlineUsers).length,\n    isLoading,\n    error,\n    isRealtime: channelStatus === 'joined',\n    isPolling: usePolling,\n    connectionStatus: channelStatus,\n  };\n}\n","import { Card, CardContent } from './ui/card';\nimport { Skeleton } from './ui/skeleton';\n\nexport function GameCardSkeleton() {\n  return (\n    <Card className=\"w-full\">\n      <CardContent className=\"p-4\">\n        <div className=\"space-y-3\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between\">\n            <div className=\"space-y-2 flex-1\">\n              <Skeleton className=\"h-5 w-3/4\" />\n              <Skeleton className=\"h-4 w-1/2\" />\n            </div>\n            <Skeleton className=\"h-8 w-16\" />\n          </div>\n          \n          {/* Location and time */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2\">\n              <Skeleton className=\"h-4 w-4\" />\n              <Skeleton className=\"h-4 w-2/3\" />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Skeleton className=\"h-4 w-4\" />\n              <Skeleton className=\"h-4 w-1/3\" />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Skeleton className=\"h-4 w-4\" />\n              <Skeleton className=\"h-4 w-1/4\" />\n            </div>\n          </div>\n          \n          {/* Description */}\n          <Skeleton className=\"h-4 w-full\" />\n          <Skeleton className=\"h-4 w-3/4\" />\n          \n          {/* Footer */}\n          <div className=\"flex items-center justify-between pt-2\">\n            <Skeleton className=\"h-6 w-20\" />\n            <Skeleton className=\"h-8 w-16\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function GameDetailsSkeleton() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"sticky top-0 z-10 bg-background/95 backdrop-blur-sm border-b border-border\">\n        <div className=\"flex items-center justify-between p-4\">\n          <Skeleton className=\"h-8 w-8\" />\n          <div className=\"flex gap-2\">\n            <Skeleton className=\"h-8 w-8\" />\n            <Skeleton className=\"h-8 w-8\" />\n            <Skeleton className=\"h-8 w-8\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"px-4 py-6 space-y-6\">\n        {/* Hero Image */}\n        <Skeleton className=\"h-48 w-full rounded-lg\" />\n        \n        {/* Basic Info */}\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-8 w-3/4\" />\n            <Skeleton className=\"h-4 w-1/2\" />\n          </div>\n          \n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-4 w-16\" />\n              <Skeleton className=\"h-4 w-24\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-4 w-16\" />\n              <Skeleton className=\"h-4 w-20\" />\n            </div>\n          </div>\n        </div>\n        \n        {/* Description */}\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-20\" />\n          <Skeleton className=\"h-4 w-full\" />\n          <Skeleton className=\"h-4 w-3/4\" />\n        </div>\n        \n        {/* Join Button */}\n        <Skeleton className=\"h-12 w-full\" />\n        \n        {/* Players List */}\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-6 w-32\" />\n          <div className=\"space-y-3\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded-full\" />\n                <div className=\"space-y-2 flex-1\">\n                  <Skeleton className=\"h-4 w-24\" />\n                  <Skeleton className=\"h-3 w-16\" />\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Button } from './ui/button';\nimport { Plus, RefreshCw, MapPin, Clock, Users } from 'lucide-react';\nimport { formatEventHeader, formatCalendarInfo, formatTimeString } from '../lib/dateUtils';\nimport { SupabaseService } from '../lib/supabaseService';\nimport { useAppStore } from '../store/appStore';\nimport { useUserPresence } from '../hooks/useUserPresence';\nimport { useGames } from '../hooks/useGames';\nimport { UnifiedGameCard } from './UnifiedGameCard';\nimport { GameCardSkeleton } from './GameCardSkeleton';\n\n\n\n// Using UnifiedGameCard component for consistency\n\nfunction HomeScreen() {\n  const navigate = useNavigate();\n  const { user } = useAppStore();\n  const { data: games = [], isLoading, error, refetch } = useGames();\n  const [refreshing, setRefreshing] = useState(false);\n  const [timedOut, setTimedOut] = useState(false);\n  const userPreferredSports = useMemo(() => user?.preferences?.sports ?? [], [user]);\n  // Real-time presence tracking (no polling)\n  const { onlineCount, isLoading: presenceLoading } = useUserPresence();\n  \n  // Game selection handler\n  const handleGameSelect = (gameId: string) => {\n    navigate(`/game/${gameId}`);\n  };\n  \n\n  // Calculate real stats\n  const stats = useMemo(() => {\n    const now = new Date();\n    const startOfWeek = new Date(now);\n    startOfWeek.setDate(now.getDate() - now.getDay()); // Start of current week (Sunday)\n    startOfWeek.setHours(0, 0, 0, 0);\n    \n    const endOfWeek = new Date(startOfWeek);\n    endOfWeek.setDate(startOfWeek.getDate() + 6); // End of current week (Saturday)\n    endOfWeek.setHours(23, 59, 59, 999);\n\n    // Count games this week\n    const thisWeekGames = games.filter(game => {\n      const gameDate = new Date(game.date);\n      return gameDate >= startOfWeek && gameDate <= endOfWeek;\n    }).length;\n\n    return {\n      totalGames: games.length,\n      thisWeekGames,\n      onlinePlayers: onlineCount\n    };\n  }, [games, onlineCount]);\n\n  // No need for manual loading with React Query\n\n\n  // Disabled realtime to prevent WebSocket connection issues\n  // useEffect(() => {\n  //   let timeoutId: NodeJS.Timeout;\n  //   \n  //   const sub = SupabaseService.subscribeToAllGames((payload) => {\n  //     console.log('[Realtime] games INSERT received', payload?.new?.id || '');\n  //     \n  //     // Debounce realtime updates to avoid excessive API calls\n  //     clearTimeout(timeoutId);\n  //     timeoutId = setTimeout(async () => {\n  //       try {\n  //         const data = feedMode === 'recommended'\n  //           ? await SupabaseService.getRecommendedGames(userPreferredSports)\n  //           : await SupabaseService.getGames();\n  //         setGames(data);\n  //       } catch (error) {\n  //         console.error('[Realtime] Failed to refresh games:', error);\n  //       }\n  //     }, 1000);\n  //   });\n  //   \n  //   return () => {\n  //     clearTimeout(timeoutId);\n  //     try { sub.unsubscribe(); } catch {}\n  //   };\n  //   // eslint-disable-next-line react-hooks/exhaustive-deps\n  // }, [feedMode, userPreferredSports.join?.('|') ?? '']);\n\n  // No need for manual loading state cleanup with React Query\n\n\n  // loadGames function removed - using React Query instead\n\n  const handleRefresh = async () => {\n    if (refreshing) return; // Prevent multiple concurrent refreshes\n    \n    setTimedOut(false);\n    setRefreshing(true);\n    try {\n      await refetch();\n    } finally {\n      setRefreshing(false);\n    }\n  };\n\n  const handleCreateGame = () => {\n    navigate('/create');\n  };\n\n  // Sort games chronologically with smart grouping\n  const sortedGames = games\n    .map(game => {\n      const gameDate = new Date(game.date);\n      const today = new Date();\n      const tomorrow = new Date(today);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n      \n      // Determine game category for sorting and display\n      let category = 'future';\n      let sortOrder = gameDate.getTime();\n      \n      if (gameDate.toDateString() === today.toDateString()) {\n        category = 'today';\n        sortOrder = 0; // Today's games first\n      } else if (gameDate.toDateString() === tomorrow.toDateString()) {\n        category = 'tomorrow';\n        sortOrder = 1; // Tomorrow's games second\n      }\n      \n      return {\n        ...game,\n        category,\n        sortOrder,\n        gameDate\n      };\n    })\n    .sort((a, b) => {\n      // First sort by category (today, tomorrow, future)\n      if (a.sortOrder !== b.sortOrder) {\n        return a.sortOrder - b.sortOrder;\n      }\n      // Then sort by time within each category\n      return a.gameDate.getTime() - b.gameDate.getTime();\n    });\n\n  // Show loading state\n  if (isLoading && games.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading games...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Timed-out empty state with retry - only show if no games at all\n  if (timedOut && games.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-3\">\n          <p className=\"text-muted-foreground\">Connection issues detected. Showing sample games.</p>\n          <Button onClick={handleRefresh} variant=\"outline\">\n            <RefreshCw className=\"w-4 h-4 mr-2\" /> Try Again\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-7xl mx-auto p-4 md:p-6\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\n          {/* Main Content */}\n          <div className=\"lg:col-span-8\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h1 className=\"text-2xl md:text-3xl font-bold\">TribeUp</h1>\n                <p className=\"text-muted-foreground\">Find your next game</p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={() => navigate('/create-game')}\n                  className=\"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold\"\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Create Game\n                </Button>\n              </div>\n            </div>\n\n            {/* Games List */}\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-lg md:text-xl font-semibold\">Upcoming Games</h2>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleRefresh}\n                disabled={isLoading}\n                className=\"hidden md:flex\"\n              >\n                <RefreshCw className={`w-4 h-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\n                Refresh\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleRefresh}\n                disabled={isLoading}\n                className=\"md:hidden\"\n                aria-label=\"Refresh games\"\n              >\n                <RefreshCw className={`w-4 h-4 ${isLoading ? 'animate-spin' : ''}`} />\n              </Button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {isLoading ? (\n                // Show skeleton loading\n                Array.from({ length: 6 }).map((_, index) => (\n                  <GameCardSkeleton key={index} />\n                ))\n              ) : (\n                sortedGames.map((game) => (\n                  <div key={game.id}>\n                    <UnifiedGameCard\n                      game={game}\n                      variant=\"simple\"\n                      onSelect={() => handleGameSelect(game.id)}\n                    />\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Sidebar - Desktop Only */}\n          <div className=\"hidden lg:block lg:col-span-4\">\n            <div className=\"bg-card rounded-lg p-6 sticky top-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Quick Stats</h3>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-muted-foreground\">Active Games</span>\n                  <span className=\"font-semibold\">{stats.totalGames}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-muted-foreground\">Players Online</span>\n                  <span className=\"font-semibold\">\n                    {presenceLoading ? '...' : stats.onlinePlayers}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-muted-foreground\">This Week</span>\n                  <span className=\"font-semibold\">{stats.thisWeekGames}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"lg:col-span-4 space-y-6\">\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-2 lg:grid-cols-1 gap-4\">\n              <div className=\"bg-card rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-primary\">\n                  {presenceLoading ? '...' : stats.onlinePlayers}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Players Online</div>\n              </div>\n              <div className=\"bg-card rounded-lg p-4 text-center\">\n                <div className=\"text-2xl font-bold text-primary\">{stats.thisWeekGames}</div>\n                <div className=\"text-sm text-muted-foreground\">This Week</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default HomeScreen;\n"],"names":["usePresenceStore","create","set","onlineUsers","channelStatus","usePolling","isLoading","error","setOnlineUsers","users","setChannelStatus","status","setUsePolling","value","setLoading","loading","setError","useUserPresence","user","useAppStore","pollTimer","useRef","channelRef","startPolling","async","current","pollPresence","id","supabase","from","upsert","user_id","name","avatar","last_seen","Date","toISOString","is_online","data","presenceData","select","gte","now","usersMap","forEach","p","err","window","setInterval","stopPolling","clearInterval","useEffect","channel","config","presence","key","on","event","state","presenceState","Object","keys","reduce","acc","userId","newPresences","leftPresences","subscribe","track","online_at","startRealtime","unsubscribe","values","onlineCount","length","isRealtime","isPolling","connectionStatus","GameCardSkeleton","jsx","Card","className","children","CardContent","jsxs","Skeleton","HomeScreen","navigate","useNavigate","games","refetch","useGames","refreshing","setRefreshing","useState","timedOut","setTimedOut","useMemo","preferences","sports","presenceLoading","stats","startOfWeek","setDate","getDate","getDay","setHours","endOfWeek","thisWeekGames","filter","game","gameDate","date","totalGames","onlinePlayers","handleRefresh","sortedGames","map","today","tomorrow","category","sortOrder","getTime","toDateString","sort","a","b","Button","onClick","variant","RefreshCw","Plus","size","disabled","Array","_","index","UnifiedGameCard","onSelect","handleGameSelect","gameId"],"mappings":"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"}