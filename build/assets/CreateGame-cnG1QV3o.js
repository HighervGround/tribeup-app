import{r as p,u as ae,j as e,B as E,C as I,b as A,d as O,e as R,L as z,A as H,f as J,a as oe,S as re}from"./index-ChktVQKv.js";import{I as Y}from"./input-LMyc2trP.js";import{T as le}from"./textarea-0VeWYNDS.js";import{P as ie}from"./progress-D2xFThia.js";import{A as ne}from"./arrow-left-5UEu9aN0.js";import{N as Q}from"./navigation-DX58YumU.js";import{M as K}from"./map-pin-DAX6B8da.js";import{C as V}from"./circle-check-big-BVBb-qKQ.js";import"./index-DlI-cDXE.js";import"./index-Qid7FhcW.js";function ce(y={}){const[n,w]=p.useState({latitude:null,longitude:null,error:null,loading:!0});return p.useEffect(()=>{if(console.log("useGeolocation hook initializing..."),!navigator.geolocation){console.log("Geolocation not supported"),w(u=>({...u,error:"Geolocation is not supported by this browser",loading:!1}));return}const v=u=>{console.log("GPS location obtained:",u.coords.latitude,u.coords.longitude),w({latitude:u.coords.latitude,longitude:u.coords.longitude,error:null,loading:!1})},h=u=>{let d="Unable to retrieve location";switch(u.code){case u.PERMISSION_DENIED:d="Location access denied by user";break;case u.POSITION_UNAVAILABLE:d="Location information unavailable";break;case u.TIMEOUT:d="Location request timed out";break}console.log("GPS error:",d,u),w(x=>({...x,error:d,loading:!1}))},m={enableHighAccuracy:y.enableHighAccuracy??!0,timeout:y.timeout??1e4,maximumAge:y.maximumAge??3e5};console.log("Requesting GPS permission with options:",m),navigator.geolocation.getCurrentPosition(v,h,m)},[y.enableHighAccuracy,y.timeout,y.maximumAge]),n}function de(){const[y,n]=p.useState([]),[w,v]=p.useState(!1),h="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ",m=p.useCallback(async d=>{try{if(h&&h!=="demo_key"){const j=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(d)}&key=${h}`);if(j.ok){const i=await j.json();if(i.results&&i.results.length>0){const c=i.results[0].geometry.location;return{lat:c.lat,lng:c.lng}}}}const x=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}&limit=1`);if(!x.ok)throw new Error("Geocoding failed");const f=await x.json();return f.length>0?{lat:parseFloat(f[0].lat),lng:parseFloat(f[0].lon)}:null}catch(x){return console.error("Geocoding error:",x),null}},[h]),u=p.useCallback(async(d,x,f)=>{if(!d.trim()){n([]);return}v(!0);try{if(h&&h!=="demo_key"){let N="https://places.googleapis.com/v1/places:autocomplete";const C={input:d,...x&&f&&{locationBias:{circle:{center:{latitude:x,longitude:f},radius:5e4}}}},G=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":h},body:JSON.stringify(C)});if(G.ok){const k=await G.json();if(k.suggestions&&k.suggestions.length>0){const a=k.suggestions.map((b,L)=>({place_id:b.placePrediction?.placeId||`google-${L}`,description:b.placePrediction?.text?.text||"",structured_formatting:{main_text:b.placePrediction?.structuredFormat?.mainText?.text||"",secondary_text:b.placePrediction?.structuredFormat?.secondaryText?.text||""}}));n(a),v(!1);return}}}let j=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}&limit=5&addressdetails=1`;x&&f&&(j+=`&lat=${x}&lon=${f}&bounded=1&viewbox=${f-.1},${x+.1},${f+.1},${x-.1}`);const $=(await(await fetch(j)).json()).map((N,C)=>({place_id:N.place_id||`osm-${C}`,description:N.display_name,structured_formatting:{main_text:N.name||N.display_name.split(",")[0],secondary_text:N.display_name.split(",").slice(1,3).join(",").trim()}}));n($)}catch(j){console.error("Location search error:",j);const i=[{place_id:"1",description:`${d} Community Center`,structured_formatting:{main_text:`${d} Community Center`,secondary_text:"Recreation Center"}},{place_id:"2",description:`${d} Park`,structured_formatting:{main_text:`${d} Park`,secondary_text:"Public Park"}},{place_id:"3",description:`${d} Sports Complex`,structured_formatting:{main_text:`${d} Sports Complex`,secondary_text:"Athletic Facility"}}];n(i)}finally{v(!1)}},[h]);return{suggestions:y,loading:w,searchLocations:u,geocodeLocation:m}}const X=[{value:"basketball",label:"Basketball",icon:"üèÄ"},{value:"soccer",label:"Soccer",icon:"‚öΩ"},{value:"tennis",label:"Tennis",icon:"üéæ"},{value:"pickleball",label:"Pickleball",icon:"ü•í"},{value:"volleyball",label:"Volleyball",icon:"üèê"},{value:"football",label:"Football",icon:"üèà"},{value:"baseball",label:"Baseball",icon:"‚öæ"}],F=[{id:1,title:"Game Details",fields:["sport","title"]},{id:2,title:"Date & Time",fields:["date","time"]},{id:3,title:"Location & Players",fields:["location","maxPlayers","cost"]}];function ve(){const y=ae(),[n,w]=p.useState(1),[v,h]=p.useState(!1),[m,u]=p.useState({}),[d,x]=p.useState(null),[f,j]=p.useState(!1),{latitude:i,longitude:c,error:$}=ce(),{suggestions:N,loading:C,searchLocations:G,geocodeLocation:k}=de(),[a,b]=p.useState({title:"",sport:"",date:"",time:"",location:"",latitude:null,longitude:null,maxPlayers:"",cost:"Free",imageUrl:""}),L={basketball:{maxPlayers:10},soccer:{maxPlayers:22},football:{maxPlayers:22},tennis:{maxPlayers:4},volleyball:{maxPlayers:12},baseball:{maxPlayers:18},hockey:{maxPlayers:12},badminton:{maxPlayers:4},pickleball:{maxPlayers:4},golf:{maxPlayers:4},running:{maxPlayers:20},cycling:{maxPlayers:15},swimming:{maxPlayers:8},yoga:{maxPlayers:15},crossfit:{maxPlayers:12}},W=["09:00","10:00","11:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"],[T,Z]=p.useState(()=>{try{return JSON.parse(localStorage.getItem("recentGameLocations")||"[]")}catch{return[]}});p.useEffect(()=>{console.log("Location effect triggered:",{userLat:i,userLng:c,location:a.location,latitude:a.latitude,geoError:$}),i&&c&&!a.location.trim()&&(console.log("Auto-filling location with GPS coordinates"),(async()=>{try{console.log("Fetching reverse geocoding for:",i,c);const s="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ";let r;if(s&&(r=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${i},${c}&key=${s}`)),!r.ok)throw new Error(`HTTP ${r.status}`);const o=await r.json();console.log("Reverse geocoding response:",o);let l="";if(s&&o.results&&o.results.length>0)l=o.results[0].formatted_address;else if(o.address){const g=[];o.address.house_number&&o.address.road?g.push(`${o.address.house_number} ${o.address.road}`):o.address.road&&g.push(o.address.road),(o.address.city||o.address.town||o.address.village)&&g.push(o.address.city||o.address.town||o.address.village),o.address.state&&g.push(o.address.state),l=g.join(", ")}l||(l=o.display_name||`${i.toFixed(4)}, ${c.toFixed(4)}`),console.log("Setting location to:",l),b(g=>({...g,location:l,latitude:i,longitude:c}))}catch(s){console.error("Reverse geocoding failed:",s);const r=`${i.toFixed(4)}, ${c.toFixed(4)}`;console.log("Using fallback location:",r),b(o=>({...o,location:r,latitude:i,longitude:c}))}})())},[i,c,$]);const M=(t,s,r)=>{if(!t||!s||!r)return"";const o=parseInt(s.split(":")[0]);let l="Morning";o>=12&&o<17?l="Afternoon":o>=17&&(l="Evening");const g=r.split(",")[0].trim(),_=t.charAt(0).toUpperCase()+t.slice(1),q=[`${l} ${_} at ${g}`,`${_} Game - ${g}`,`${l} ${_} Session`,`${g} ${_} Meetup`,`${_} @ ${g}`];return q[Math.floor(Math.random()*q.length)]},S=(t,s)=>{b(r=>{const o={...r,[t]:s};if((t==="sport"||t==="time"||t==="location")&&(!r.title||r.title===M(r.sport,r.time,r.location))&&(o.title=M(t==="sport"?s:r.sport,t==="time"?s:r.time,t==="location"?s:r.location)),t==="sport"&&L[s.toLowerCase()]&&(o.maxPlayers=L[s.toLowerCase()].maxPlayers.toString()),t==="location"&&s.trim()){const l=[s,...T.filter(g=>g!==s)].slice(0,5);Z(l),localStorage.setItem("recentGameLocations",JSON.stringify(l))}return o}),m[t]&&u(r=>{const{[t]:o,...l}=r;return l})},U=()=>{const t={};if(n===1&&(a.sport||(t.sport="Please select a sport."),a.title.trim()||(t.title="Game title is required.")),n===2&&(a.date||(t.date="Please choose a date."),a.time||(t.time="Please choose a time."),a.date)){const s=new Date;new Date(a.date+"T00:00:00")<new Date(s.toDateString())&&(t.date="Date cannot be in the past.")}if(n===3){a.location.trim()||(t.location="Location is required.");const s=parseInt(a.maxPlayers,10);a.maxPlayers?(Number.isNaN(s)||s<=0)&&(t.maxPlayers="Enter a valid number greater than 0."):t.maxPlayers="Max players is required.",a.cost||(t.cost="Please select a cost option.")}return u(t),Object.keys(t).length===0},ee=()=>{U()&&n<F.length&&w(n+1)},B=()=>{n>1?w(n-1):y(-1)},te=async()=>{if(U()){h(!0),x(null);try{const{user:t}=oe.getState();if(console.log("[CreateGame] submit clicked. user =",t?.id),!t)throw new Error("You must be logged in to create a game");const s={title:a.title,sport:a.sport,date:a.date,time:a.time,location:a.location,latitude:a.latitude,longitude:a.longitude,max_players:parseInt(a.maxPlayers),cost:a.cost||"Free",description:"",requirements:"",image_url:a.imageUrl,creator_id:t.id};console.log("[CreateGame] creating game with data =",s),await re.createGame(s),y("/")}catch(t){console.error("Error creating game:",t),x(t instanceof Error?t.message:"Failed to create game")}finally{h(!1)}}},se=n/F.length*100,D=X.find(t=>t.value===a.sport),P=(t,s,r="text",o)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[s,F[n-1].fields.includes(t)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),r==="select"&&o?e.jsxs("select",{value:a[t],onChange:l=>S(t,l.target.value),className:`w-full p-2 border rounded-md ${m[t]?"border-destructive":""}`,children:[e.jsxs("option",{value:"",children:["Select ",s.toLowerCase()]}),o.map(l=>e.jsxs("option",{value:l.value,children:[l.icon," ",l.label]},l.value))]}):r==="textarea"?e.jsx(le,{value:a[t],onChange:l=>S(t,l.target.value),placeholder:`Enter ${s.toLowerCase()}`,className:`resize-none ${m[t]?"border-destructive":""}`,rows:3}):e.jsx(Y,{type:r,value:a[t],onChange:l=>S(t,l.target.value),placeholder:`Enter ${s.toLowerCase()}`,min:r==="date"?new Date().toISOString().split("T")[0]:void 0,className:m[t]?"border-destructive":""}),m[t]&&e.jsx("p",{className:"text-sm text-destructive",children:m[t]})]});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:B,children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Create Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:F[n-1].title})]})]})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(ie,{value:se,className:"h-2"})})]}),e.jsxs("div",{className:"px-4 pb-40 pt-6",children:[D&&e.jsx("div",{className:"mb-6",children:e.jsx(I,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl",children:D.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.title||"New Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:D.label})]})]})})})}),n===1&&e.jsx("div",{className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"1"}),"Game Details"]})}),e.jsxs(A,{className:"space-y-6",children:[P("sport","Sport","select",X),P("title","Game Title")]})]})}),n===2&&e.jsx("div",{className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"2"}),"Date & Time"]})}),e.jsxs(A,{className:"space-y-6",children:[P("date","Date","date"),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Time"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"time",value:a.time,onChange:t=>S("time",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 w-full",children:"Popular times:"}),W.map(t=>{const s=parseInt(t.split(":")[0]),r=s>=12?"PM":"AM",l=`${s>12?s-12:s===0?12:s}:${t.split(":")[1]} ${r}`;return e.jsx("button",{type:"button",onClick:()=>S("time",t),className:`px-3 py-1 text-xs rounded-full border transition-colors ${a.time===t?"bg-primary text-white border-primary":"bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100"}`,children:l},t)})]})]}),m.time&&e.jsx("p",{className:"text-red-500 text-sm",children:m.time})]})]})]})}),n===3&&e.jsx("div",{className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"3"}),"Location & Players"]})}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),T.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-2",children:"Recent locations:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map((t,s)=>e.jsx("button",{type:"button",onClick:()=>S("location",t),className:`px-3 py-1 text-xs rounded-full border transition-colors ${a.location===t?"bg-primary text-white border-primary":"bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100"}`,children:t.split(",")[0]},s))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{value:a.location,onChange:t=>{S("location",t.target.value),t.target.value.length>2?(G(t.target.value,i||void 0,c||void 0),j(!0)):j(!1)},placeholder:"Enter location or address",className:m.location?"border-destructive":""}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex gap-2",children:[C&&e.jsx(z,{className:"w-4 h-4 animate-spin text-muted-foreground"}),e.jsx(E,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:async()=>{if(i&&c)try{const r=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${i}&lon=${c}`)).json()).display_name||`${i.toFixed(4)}, ${c.toFixed(4)}`;b(o=>({...o,location:r,latitude:i,longitude:c}))}catch(t){console.error("Reverse geocoding failed:",t),b(s=>({...s,location:`${i.toFixed(4)}, ${c.toFixed(4)}`,latitude:i,longitude:c}))}},disabled:!i||!c,title:i&&c?"Use my current location":$||"Location not available",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),f&&N.length>0&&e.jsx("div",{className:"border border-border rounded-md bg-background shadow-lg max-h-48 overflow-y-auto",children:N.map(t=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted border-b border-border last:border-b-0 flex items-center gap-2",onClick:async()=>{b(r=>({...r,location:t.description})),j(!1);const s=await k(t.description);s&&b(r=>({...r,latitude:s.lat,longitude:s.lng}))},children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.structured_formatting.main_text}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.structured_formatting.secondary_text})]})]},t.place_id))}),m.location&&e.jsx("p",{className:"text-sm text-destructive",children:m.location}),a.latitude&&a.longitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(K,{className:"w-3 h-3"}),e.jsxs("span",{children:["üìç Location coordinates saved (",a.latitude.toFixed(4),", ",a.longitude.toFixed(4),")"]})]}),i&&c&&!a.latitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{children:"üéØ Your location detected - use GPS button to auto-fill"})]}),$&&e.jsxs("div",{className:"text-sm text-amber-600",children:["üìç ",$]})]}),P("maxPlayers","Max Players","number"),P("cost","Cost","select",[{value:"FREE",label:"Free"},{value:"$5",label:"$5 per person"},{value:"$10",label:"$10 per person"},{value:"$15",label:"$15 per person"},{value:"$20",label:"$20 per person"},{value:"custom",label:"Custom amount"}]),P("requirements","Requirements (Optional)","textarea")]})]})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border px-4 py-4 mt-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(E,{variant:"outline",onClick:B,className:"w-auto px-4",disabled:v,children:n===1?"Cancel":"Back"}),n<F.length?e.jsx(E,{onClick:ee,className:"flex-1",disabled:v||Object.keys(m).length>0,children:"Next Step"}):e.jsx(E,{onClick:te,disabled:v,className:"flex-1",children:v?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Game..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]})}),d&&e.jsx("div",{className:"mt-4",children:e.jsx(H,{variant:"destructive",children:e.jsx(J,{children:d})})}),n===3&&a.sport&&e.jsx("div",{className:"mt-6",children:e.jsxs(H,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs(J,{children:['Ready to create "',a.title,'" for ',a.maxPlayers," players on ",a.date," at ",a.time,"?"]})]})})]})]})}export{ve as CreateGame};
//# sourceMappingURL=CreateGame-cnG1QV3o.js.map
