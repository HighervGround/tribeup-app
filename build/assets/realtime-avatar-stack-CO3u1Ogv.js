import{j as e}from"./ui-BV8hHw1h.js";import{f as s,j as a,g as i,h as n,u as r,i as t,m as o,n as c,o as l,s as m}from"./index-B8aSsUS3.js";import{e as d,r as u}from"./vendor-C07EgOn8.js";import{t as p}from"./utils-sWWcUyIH.js";import{c as h,d as g}from"./useGames-jIarMnPb.js";import{a as j,b as x,c as f}from"./tooltip-CxXGEiMo.js";const v={sm:"size-6",md:"size-8",lg:"size-10",xl:"size-12"};function b({userId:r,src:t,alt:o,fallback:c,size:l="md",className:m,onClick:u,disabled:p=!1}){const h=d();return e.jsxs(s,{className:a(v[l],(r||u)&&!p&&"cursor-pointer hover:ring-2 hover:ring-primary/20 transition-all",p&&"opacity-50 cursor-not-allowed",m),onClick:e=>{e.stopPropagation(),u?u():r&&!p&&h(`/user/${r}`)},children:[t&&e.jsx(i,{src:t,alt:o||"User avatar"}),e.jsx(n,{className:"bg-primary/10 text-primary font-medium",children:c||(g=o,g?g.startsWith("Unknown User")?"??":g.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2):"?")})]});var g}function C(){const e=h(),s=g(),{user:a}=r(),i=u.useCallback(e=>!!a?.id&&(e.creatorId===a.id||e.creator_id===a.id||e.createdBy===a.id||e.creatorData?.id===a.id),[a?.id]),n=u.useCallback((a,n)=>{if(n?.stopPropagation(),a.isJoined){if(i(a))return void p.error("Cannot leave your own game",{description:"Use the menu options to delete the game instead."});s.mutate(a.id,{onSuccess:()=>{p.success("Left game successfully")},onError:e=>{}})}else e.mutate(a.id,{onSuccess:()=>{p.success("Joined game successfully!")},onError:e=>{}})},[e,s,i]),t=e.isPending||s.isPending,o=u.useCallback(e=>t?"...":e.isJoined?i(e)?"Joined":"Leave":"Join",[t,i]),c=u.useCallback(e=>e.isJoined?i(e)?"secondary":"outline":"default",[i]);return{toggleJoin:n,isLoading:t,getButtonText:o,getButtonVariant:c,isGameCreator:i,isJoining:e.isPending,isLeaving:s.isPending}}const y=o("flex -space-x-4 -space-y-4",{variants:{orientation:{vertical:"flex-row",horizontal:"flex-col"}},defaultVariants:{orientation:"vertical"}}),k=({className:a,orientation:r,avatars:o,maxAvatarsAmount:c=3,...l})=>{const m=o.slice(0,c),d=o.slice(c);return e.jsxs("div",{className:t(y({orientation:r}),a,"horizontal"===r?"-space-x-0":"-space-y-0"),...l,children:[m.map(({name:a,image:r},t)=>e.jsxs(j,{children:[e.jsx(x,{asChild:!0,children:e.jsxs(s,{className:"hover:z-10",children:[e.jsx(i,{src:r}),e.jsx(n,{children:a?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()})]})}),e.jsx(f,{children:e.jsx("p",{children:a})})]},`${a}-${r}-${t}`)),d.length?e.jsxs(j,{children:[e.jsx(x,{asChild:!0,children:e.jsx(s,{children:e.jsxs(n,{children:["+",o.length-m.length]})})}),e.jsx(f,{children:d.map(({name:s},a)=>e.jsx("p",{children:s},`${s}-${a}`))})]},"hidden-avatars"):null]})},z=({roomName:s})=>{const{users:a}=(e=>{const s=c(),a=l(),[i,n]=u.useState({});return u.useEffect(()=>{const i=m.channel(e);return i.on("presence",{event:"sync"},()=>{const e=i.presenceState(),s=Object.fromEntries(Object.entries(e).map(([e,s])=>{const a=s;return[e,{id:e,name:a[0]?.name||"",image:a[0]?.image||""}]}));n(s)}).subscribe(async e=>{"SUBSCRIBED"===e&&await i.track({name:a,image:s})}),()=>{i.unsubscribe()}},[e,a,s]),{users:i}})(s),i=u.useMemo(()=>Object.values(a).map(e=>({name:e.name,image:e.image})),[a]);return e.jsx(k,{avatars:i})};export{b as C,z as R,C as u};
//# sourceMappingURL=realtime-avatar-stack-CO3u1Ogv.js.map
