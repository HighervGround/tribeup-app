import{r as p,u as V,j as e,B as k,C as P,b as E,d as G,e as I,L as R,A as T,f as O,a as W,S as X}from"./index-BP2KWh-A.js";import{I as U}from"./input-M7-INsWF.js";import{T as Z}from"./textarea-CPkbhV0I.js";import{P as ee}from"./progress-DzUmBASs.js";import{A as te}from"./arrow-left-BEf2Fmbk.js";import{N as q}from"./navigation-ClFtdQ3f.js";import{M}from"./map-pin-BoUV1lx8.js";import{C as B}from"./circle-check-big-DeWjdXcb.js";import"./index-DPhlQSAt.js";import"./index-B5dcZ9Mn.js";function se(g={}){const[n,y]=p.useState({latitude:null,longitude:null,error:null,loading:!0});return p.useEffect(()=>{if(console.log("useGeolocation hook initializing..."),!navigator.geolocation){console.log("Geolocation not supported"),y(m=>({...m,error:"Geolocation is not supported by this browser",loading:!1}));return}const j=m=>{console.log("GPS location obtained:",m.coords.latitude,m.coords.longitude),y({latitude:m.coords.latitude,longitude:m.coords.longitude,error:null,loading:!1})},f=m=>{let c="Unable to retrieve location";switch(m.code){case m.PERMISSION_DENIED:c="Location access denied by user";break;case m.POSITION_UNAVAILABLE:c="Location information unavailable";break;case m.TIMEOUT:c="Location request timed out";break}console.log("GPS error:",c,m),y(x=>({...x,error:c,loading:!1}))},u={enableHighAccuracy:g.enableHighAccuracy??!0,timeout:g.timeout??1e4,maximumAge:g.maximumAge??3e5};console.log("Requesting GPS permission with options:",u),navigator.geolocation.getCurrentPosition(j,f,u)},[g.enableHighAccuracy,g.timeout,g.maximumAge]),n}function ae(){const[g,n]=p.useState([]),[y,j]=p.useState(!1),f="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ",u=p.useCallback(async c=>{try{if(f&&f!=="demo_key"){const h=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(c)}&key=${f}`);if(h.ok){const r=await h.json();if(r.results&&r.results.length>0){const i=r.results[0].geometry.location;return{lat:i.lat,lng:i.lng}}}}const x=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=1`);if(!x.ok)throw new Error("Geocoding failed");const b=await x.json();return b.length>0?{lat:parseFloat(b[0].lat),lng:parseFloat(b[0].lon)}:null}catch(x){return console.error("Geocoding error:",x),null}},[f]),m=p.useCallback(async(c,x,b)=>{if(!c.trim()){n([]);return}j(!0);try{let h=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=5&addressdetails=1`;x&&b&&(h+=`&lat=${x}&lon=${b}&bounded=1&viewbox=${b-.1},${x+.1},${b+.1},${x-.1}`);const w=(await(await fetch(h)).json()).map((N,L)=>({place_id:N.place_id||`osm-${L}`,description:N.display_name,structured_formatting:{main_text:N.name||N.display_name.split(",")[0],secondary_text:N.display_name.split(",").slice(1,3).join(",").trim()}}));n(w)}catch(h){console.error("Location search error:",h);const r=[{place_id:"1",description:`${c} Community Center`,structured_formatting:{main_text:`${c} Community Center`,secondary_text:"Recreation Center"}},{place_id:"2",description:`${c} Park`,structured_formatting:{main_text:`${c} Park`,secondary_text:"Public Park"}},{place_id:"3",description:`${c} Sports Complex`,structured_formatting:{main_text:`${c} Sports Complex`,secondary_text:"Athletic Facility"}}];n(r)}finally{j(!1)}},[f]);return{suggestions:g,loading:y,searchLocations:m,geocodeLocation:u}}const z=[{value:"basketball",label:"Basketball",icon:"üèÄ"},{value:"soccer",label:"Soccer",icon:"‚öΩ"},{value:"tennis",label:"Tennis",icon:"üéæ"},{value:"pickleball",label:"Pickleball",icon:"ü•í"},{value:"volleyball",label:"Volleyball",icon:"üèê"},{value:"football",label:"Football",icon:"üèà"},{value:"baseball",label:"Baseball",icon:"‚öæ"}],$=[{id:1,title:"Game Details",fields:["sport","title","description"]},{id:2,title:"Date & Time",fields:["date","time","duration"]},{id:3,title:"Location & Players",fields:["location","maxPlayers","cost","requirements"]}];function pe(){const g=V(),[n,y]=p.useState(1),[j,f]=p.useState(!1),[u,m]=p.useState({}),[c,x]=p.useState(null),[b,h]=p.useState(!1),{latitude:r,longitude:i,error:w}=se(),{suggestions:N,loading:L,searchLocations:H,geocodeLocation:Y}=ae(),[s,S]=p.useState({sport:"",title:"",description:"",date:"",time:"",duration:"",location:"",latitude:null,longitude:null,maxPlayers:"",cost:"",requirements:""});p.useEffect(()=>{console.log("Location effect triggered:",{userLat:r,userLng:i,location:s.location,latitude:s.latitude,geoError:w}),r&&i&&!s.location.trim()&&(console.log("Auto-filling location with GPS coordinates"),(async()=>{try{console.log("Fetching reverse geocoding for:",r,i);const o="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ";let l;if(o&&(l=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${i}&key=${o}`)),!l.ok)throw new Error(`HTTP ${l.status}`);const a=await l.json();console.log("Reverse geocoding response:",a);let d="";if(o&&a.results&&a.results.length>0)d=a.results[0].formatted_address;else if(a.address){const C=[];a.address.house_number&&a.address.road?C.push(`${a.address.house_number} ${a.address.road}`):a.address.road&&C.push(a.address.road),(a.address.city||a.address.town||a.address.village)&&C.push(a.address.city||a.address.town||a.address.village),a.address.state&&C.push(a.address.state),d=C.join(", ")}d||(d=a.display_name||`${r.toFixed(4)}, ${i.toFixed(4)}`),console.log("Setting location to:",d),S(C=>({...C,location:d,latitude:r,longitude:i}))}catch(o){console.error("Reverse geocoding failed:",o);const l=`${r.toFixed(4)}, ${i.toFixed(4)}`;console.log("Using fallback location:",l),S(a=>({...a,location:l,latitude:r,longitude:i}))}})())},[r,i,w]);const _=(t,o)=>{S(l=>({...l,[t]:o})),u[t]&&m(l=>{const{[t]:a,...d}=l;return d})},A=()=>{const t={};if(n===1&&(s.sport||(t.sport="Please select a sport."),s.title.trim()||(t.title="Game title is required."),s.description.trim()||(t.description="Description is required.")),n===2&&(s.date||(t.date="Please choose a date."),s.time||(t.time="Please choose a time."),s.date)){const o=new Date;new Date(s.date+"T00:00:00")<new Date(o.toDateString())&&(t.date="Date cannot be in the past.")}if(n===3){s.location.trim()||(t.location="Location is required.");const o=parseInt(s.maxPlayers,10);s.maxPlayers?(Number.isNaN(o)||o<=0)&&(t.maxPlayers="Enter a valid number greater than 0."):t.maxPlayers="Max players is required.",s.cost||(t.cost="Please select a cost option.")}return m(t),Object.keys(t).length===0},Q=()=>{A()&&n<$.length&&y(n+1)},D=()=>{n>1?y(n-1):g(-1)},J=async()=>{if(A()){f(!0),x(null);try{const{user:t}=W.getState();if(console.log("[CreateGame] submit clicked. user =",t?.id),!t)throw new Error("You must be logged in to create a game");const o={title:s.title,sport:s.sport,location:s.location,date:s.date,time:s.time,cost:s.cost||"Free",maxPlayers:parseInt(s.maxPlayers),description:s.description,creatorId:t.id};console.log("[CreateGame] creating game with data =",o),await X.createGame(o),g("/")}catch(t){console.error("Error creating game:",t),x(t instanceof Error?t.message:"Failed to create game")}finally{f(!1)}}},K=n/$.length*100,F=z.find(t=>t.value===s.sport),v=(t,o,l="text",a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[o,$[n-1].fields.includes(t)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),l==="select"&&a?e.jsxs("select",{value:s[t],onChange:d=>_(t,d.target.value),className:`w-full p-2 border rounded-md ${u[t]?"border-destructive":""}`,children:[e.jsxs("option",{value:"",children:["Select ",o.toLowerCase()]}),a.map(d=>e.jsxs("option",{value:d.value,children:[d.icon," ",d.label]},d.value))]}):l==="textarea"?e.jsx(Z,{value:s[t],onChange:d=>_(t,d.target.value),placeholder:`Enter ${o.toLowerCase()}`,className:`resize-none ${u[t]?"border-destructive":""}`,rows:3}):e.jsx(U,{type:l,value:s[t],onChange:d=>_(t,d.target.value),placeholder:`Enter ${o.toLowerCase()}`,min:l==="date"?new Date().toISOString().split("T")[0]:void 0,className:u[t]?"border-destructive":""}),u[t]&&e.jsx("p",{className:"text-sm text-destructive",children:u[t]})]});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:D,children:e.jsx(te,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Create Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:$[n-1].title})]})]})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(ee,{value:K,className:"h-2"})})]}),e.jsxs("div",{className:"px-4 pb-40 pt-6",children:[F&&e.jsx("div",{className:"mb-6",children:e.jsx(P,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl",children:F.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.title||"New Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:F.label})]})]})})})}),n===1&&e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{children:[e.jsx(G,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"1"}),"Game Details"]})}),e.jsxs(E,{className:"space-y-6",children:[v("sport","Sport","select",z),v("title","Game Title"),v("description","Description","textarea")]})]})}),n===2&&e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{children:[e.jsx(G,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"2"}),"Date & Time"]})}),e.jsxs(E,{className:"space-y-6",children:[v("date","Date","date"),v("time","Time","time"),v("duration","Duration","select",[{value:"30min",label:"30 minutes"},{value:"1hr",label:"1 hour"},{value:"1.5hr",label:"1.5 hours"},{value:"2hr",label:"2 hours"},{value:"3hr",label:"3 hours"}])]})]})}),n===3&&e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{children:[e.jsx(G,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"3"}),"Location & Players"]})}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{value:s.location,onChange:t=>{_("location",t.target.value),t.target.value.length>2?(H(t.target.value,r||void 0,i||void 0),h(!0)):h(!1)},placeholder:"Enter location or address",className:u.location?"border-destructive":""}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex gap-2",children:[L&&e.jsx(R,{className:"w-4 h-4 animate-spin text-muted-foreground"}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:async()=>{if(r&&i)try{const l=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${i}`)).json()).display_name||`${r.toFixed(4)}, ${i.toFixed(4)}`;S(a=>({...a,location:l,latitude:r,longitude:i}))}catch(t){console.error("Reverse geocoding failed:",t),S(o=>({...o,location:`${r.toFixed(4)}, ${i.toFixed(4)}`,latitude:r,longitude:i}))}},disabled:!r||!i,title:r&&i?"Use my current location":w||"Location not available",children:e.jsx(q,{className:"w-4 h-4"})})]})]}),b&&N.length>0&&e.jsx("div",{className:"border border-border rounded-md bg-background shadow-lg max-h-48 overflow-y-auto",children:N.map(t=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted border-b border-border last:border-b-0 flex items-center gap-2",onClick:async()=>{S(l=>({...l,location:t.description})),h(!1);const o=await Y(t.description);o&&S(l=>({...l,latitude:o.lat,longitude:o.lng}))},children:[e.jsx(M,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.structured_formatting.main_text}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.structured_formatting.secondary_text})]})]},t.place_id))}),u.location&&e.jsx("p",{className:"text-sm text-destructive",children:u.location}),s.latitude&&s.longitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsxs("span",{children:["üìç Location coordinates saved (",s.latitude.toFixed(4),", ",s.longitude.toFixed(4),")"]})]}),r&&i&&!s.latitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:"üéØ Your location detected - use GPS button to auto-fill"})]}),w&&e.jsxs("div",{className:"text-sm text-amber-600",children:["üìç ",w]})]}),v("maxPlayers","Max Players","number"),v("cost","Cost","select",[{value:"FREE",label:"Free"},{value:"$5",label:"$5 per person"},{value:"$10",label:"$10 per person"},{value:"$15",label:"$15 per person"},{value:"$20",label:"$20 per person"},{value:"custom",label:"Custom amount"}]),v("requirements","Requirements (Optional)","textarea")]})]})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border px-4 py-4 mt-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",onClick:D,className:"w-auto px-4",disabled:j,children:n===1?"Cancel":"Back"}),n<$.length?e.jsx(k,{onClick:Q,className:"flex-1",disabled:j||Object.keys(u).length>0,children:"Next Step"}):e.jsx(k,{onClick:J,disabled:j,className:"flex-1",children:j?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Game..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]})}),c&&e.jsx("div",{className:"mt-4",children:e.jsx(T,{variant:"destructive",children:e.jsx(O,{children:c})})}),n===3&&s.sport&&e.jsx("div",{className:"mt-6",children:e.jsxs(T,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs(O,{children:['Ready to create "',s.title,'" for ',s.maxPlayers," players on ",s.date," at ",s.time,"?"]})]})})]})]})}export{pe as CreateGame};
//# sourceMappingURL=CreateGame-fGXYFcOE.js.map
