import{r as h,u as J,j as e,B as k,C as E,b as F,d as D,e as I,L as R,A as O,f as U,a as Q,S as W}from"./index-Cc4LGJhl.js";import{I as B}from"./input-Cimo5Sw3.js";import{T as X}from"./textarea-CkBSuRpE.js";import{P as Z}from"./progress-D4t79-qq.js";import{A as ee}from"./arrow-left-B4jFT5KQ.js";import{N as M}from"./navigation-BO1vVKDZ.js";import{M as z}from"./map-pin-DYOO4G7j.js";import{C as q}from"./circle-check-big-RN8dYQhv.js";import"./index-LLE0TcD7.js";function te(f={}){const[i,N]=h.useState({latitude:null,longitude:null,error:null,loading:!0});return h.useEffect(()=>{if(console.log("useGeolocation hook initializing..."),!navigator.geolocation){console.log("Geolocation not supported"),N(d=>({...d,error:"Geolocation is not supported by this browser",loading:!1}));return}const j=d=>{console.log("GPS location obtained:",d.coords.latitude,d.coords.longitude),N({latitude:d.coords.latitude,longitude:d.coords.longitude,error:null,loading:!1})},p=d=>{let n="Unable to retrieve location";switch(d.code){case d.PERMISSION_DENIED:n="Location access denied by user";break;case d.POSITION_UNAVAILABLE:n="Location information unavailable";break;case d.TIMEOUT:n="Location request timed out";break}console.log("GPS error:",n,d),N(m=>({...m,error:n,loading:!1}))},u={enableHighAccuracy:f.enableHighAccuracy??!0,timeout:f.timeout??1e4,maximumAge:f.maximumAge??3e5};console.log("Requesting GPS permission with options:",u),navigator.geolocation.getCurrentPosition(j,p,u)},[f.enableHighAccuracy,f.timeout,f.maximumAge]),i}function se(){const[f,i]=h.useState([]),[N,j]=h.useState(!1),p="AIzaSyATPbnuTvpYDDY0vLrKy0IoS80A27rpq-4",u=h.useCallback(async n=>{try{if(p&&p!=="demo_key"){const b=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(n)}&key=${p}`);if(b.ok){const r=await b.json();if(r.results&&r.results.length>0){const l=r.results[0].geometry.location;return{lat:l.lat,lng:l.lng}}}}const m=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(n)}&limit=1`);if(!m.ok)throw new Error("Geocoding failed");const g=await m.json();return g.length>0?{lat:parseFloat(g[0].lat),lng:parseFloat(g[0].lon)}:null}catch(m){return console.error("Geocoding error:",m),null}},[p]),d=h.useCallback(async(n,m,g)=>{if(!n.trim()){i([]);return}j(!0);try{if(p&&p!=="demo_key"){let v=`https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${encodeURIComponent(n)}&key=${p}&types=establishment|geocode`;m&&g&&(v+=`&location=${m},${g}&radius=50000`);const C=await fetch(v);if(C.ok){const $=await C.json();if($.predictions&&$.predictions.length>0){const G=$.predictions.map(s=>({place_id:s.place_id,description:s.description,structured_formatting:{main_text:s.structured_formatting.main_text,secondary_text:s.structured_formatting.secondary_text||""}}));i(G),j(!1);return}}}let b=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(n)}&limit=5&addressdetails=1`;m&&g&&(b+=`&lat=${m}&lon=${g}&bounded=1&viewbox=${g-.1},${m+.1},${g+.1},${m-.1}`);const w=(await(await fetch(b)).json()).map((v,C)=>({place_id:v.place_id||`osm-${C}`,description:v.display_name,structured_formatting:{main_text:v.name||v.display_name.split(",")[0],secondary_text:v.display_name.split(",").slice(1,3).join(",").trim()}}));i(w)}catch(b){console.error("Location search error:",b);const r=[{place_id:"1",description:`${n} Community Center`,structured_formatting:{main_text:`${n} Community Center`,secondary_text:"Recreation Center"}},{place_id:"2",description:`${n} Park`,structured_formatting:{main_text:`${n} Park`,secondary_text:"Public Park"}},{place_id:"3",description:`${n} Sports Complex`,structured_formatting:{main_text:`${n} Sports Complex`,secondary_text:"Athletic Facility"}}];i(r)}finally{j(!1)}},[p]);return{suggestions:f,loading:N,searchLocations:d,geocodeLocation:u}}const H=[{value:"basketball",label:"Basketball",icon:"üèÄ"},{value:"soccer",label:"Soccer",icon:"‚öΩ"},{value:"tennis",label:"Tennis",icon:"üéæ"},{value:"pickleball",label:"Pickleball",icon:"ü•í"},{value:"volleyball",label:"Volleyball",icon:"üèê"},{value:"football",label:"Football",icon:"üèà"},{value:"baseball",label:"Baseball",icon:"‚öæ"}],_=[{id:1,title:"Game Details",fields:["sport","title","description"]},{id:2,title:"Date & Time",fields:["date","time","duration"]},{id:3,title:"Location & Players",fields:["location","maxPlayers","cost","requirements"]}];function ue(){const f=J(),[i,N]=h.useState(1),[j,p]=h.useState(!1),[u,d]=h.useState({}),[n,m]=h.useState(null),[g,b]=h.useState(!1),{latitude:r,longitude:l,error:w}=te(),{suggestions:v,loading:C,searchLocations:$,geocodeLocation:G}=se(),[s,S]=h.useState({sport:"",title:"",description:"",date:"",time:"",duration:"",location:"",latitude:null,longitude:null,maxPlayers:"",cost:"",requirements:""});h.useEffect(()=>{console.log("Location effect triggered:",{userLat:r,userLng:l,location:s.location,latitude:s.latitude,geoError:w}),r&&l&&!s.location.trim()&&(console.log("Auto-filling location with GPS coordinates"),(async()=>{try{console.log("Fetching reverse geocoding for:",r,l);const o=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${l}&addressdetails=1`);if(!o.ok)throw new Error(`HTTP ${o.status}`);const a=await o.json();console.log("Reverse geocoding response:",a);let x="";if(a.address){const c=[];a.address.house_number&&a.address.road?c.push(`${a.address.house_number} ${a.address.road}`):a.address.road&&c.push(a.address.road),(a.address.city||a.address.town||a.address.village)&&c.push(a.address.city||a.address.town||a.address.village),a.address.state&&c.push(a.address.state),x=c.join(", ")}x||(x=a.display_name||`${r.toFixed(4)}, ${l.toFixed(4)}`),console.log("Setting location to:",x),S(c=>({...c,location:x,latitude:r,longitude:l}))}catch(o){console.error("Reverse geocoding failed:",o);const a=`${r.toFixed(4)}, ${l.toFixed(4)}`;console.log("Using fallback location:",a),S(x=>({...x,location:a,latitude:r,longitude:l}))}})())},[r,l,w]);const P=(t,o)=>{S(a=>({...a,[t]:o})),u[t]&&d(a=>{const{[t]:x,...c}=a;return c})},A=()=>{const t={};if(i===1&&(s.sport||(t.sport="Please select a sport."),s.title.trim()||(t.title="Game title is required."),s.description.trim()||(t.description="Description is required.")),i===2&&(s.date||(t.date="Please choose a date."),s.time||(t.time="Please choose a time."),s.date)){const o=new Date;new Date(s.date+"T00:00:00")<new Date(o.toDateString())&&(t.date="Date cannot be in the past.")}if(i===3){s.location.trim()||(t.location="Location is required.");const o=parseInt(s.maxPlayers,10);s.maxPlayers?(Number.isNaN(o)||o<=0)&&(t.maxPlayers="Enter a valid number greater than 0."):t.maxPlayers="Max players is required.",s.cost||(t.cost="Please select a cost option.")}return d(t),Object.keys(t).length===0},Y=()=>{A()&&i<_.length&&N(i+1)},T=()=>{i>1?N(i-1):f(-1)},K=async()=>{if(A()){p(!0),m(null);try{const{user:t}=Q.getState();if(console.log("[CreateGame] submit clicked. user =",t?.id),!t)throw new Error("You must be logged in to create a game");const o={title:s.title,sport:s.sport,location:s.location,date:s.date,time:s.time,cost:s.cost||"Free",maxPlayers:parseInt(s.maxPlayers),description:s.description,creatorId:t.id};console.log("[CreateGame] creating game with data =",o),await W.createGame(o),f("/")}catch(t){console.error("Error creating game:",t),m(t instanceof Error?t.message:"Failed to create game")}finally{p(!1)}}},V=i/_.length*100,L=H.find(t=>t.value===s.sport),y=(t,o,a="text",x)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[o,_[i-1].fields.includes(t)&&e.jsx("span",{className:"text-destructive",children:"*"})]}),a==="select"&&x?e.jsxs("select",{value:s[t],onChange:c=>P(t,c.target.value),className:`w-full p-2 border rounded-md ${u[t]?"border-destructive":""}`,children:[e.jsxs("option",{value:"",children:["Select ",o.toLowerCase()]}),x.map(c=>e.jsxs("option",{value:c.value,children:[c.icon," ",c.label]},c.value))]}):a==="textarea"?e.jsx(X,{value:s[t],onChange:c=>P(t,c.target.value),placeholder:`Enter ${o.toLowerCase()}`,className:`resize-none ${u[t]?"border-destructive":""}`,rows:3}):e.jsx(B,{type:a,value:s[t],onChange:c=>P(t,c.target.value),placeholder:`Enter ${o.toLowerCase()}`,min:a==="date"?new Date().toISOString().split("T")[0]:void 0,className:u[t]?"border-destructive":""}),u[t]&&e.jsx("p",{className:"text-sm text-destructive",children:u[t]})]});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:T,children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Create Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:_[i-1].title})]})]})}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(Z,{value:V,className:"h-2"})})]}),e.jsxs("div",{className:"px-4 pb-40 pt-6",children:[L&&e.jsx("div",{className:"mb-6",children:e.jsx(E,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-2xl",children:L.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.title||"New Game"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:L.label})]})]})})})}),i===1&&e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"1"}),"Game Details"]})}),e.jsxs(F,{className:"space-y-6",children:[y("sport","Sport","select",H),y("title","Game Title"),y("description","Description","textarea")]})]})}),i===2&&e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"2"}),"Date & Time"]})}),e.jsxs(F,{className:"space-y-6",children:[y("date","Date","date"),y("time","Time","time"),y("duration","Duration","select",[{value:"30min",label:"30 minutes"},{value:"1hr",label:"1 hour"},{value:"1.5hr",label:"1.5 hours"},{value:"2hr",label:"2 hours"},{value:"3hr",label:"3 hours"}])]})]})}),i===3&&e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-primary font-semibold text-sm",children:"3"}),"Location & Players"]})}),e.jsxs(F,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{value:s.location,onChange:t=>{P("location",t.target.value),t.target.value.length>2?($(t.target.value,r||void 0,l||void 0),b(!0)):b(!1)},placeholder:"Enter location or address",className:u.location?"border-destructive":""}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex gap-2",children:[C&&e.jsx(R,{className:"w-4 h-4 animate-spin text-muted-foreground"}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:async()=>{if(r&&l)try{const a=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${l}`)).json()).display_name||`${r.toFixed(4)}, ${l.toFixed(4)}`;S(x=>({...x,location:a,latitude:r,longitude:l}))}catch(t){console.error("Reverse geocoding failed:",t),S(o=>({...o,location:`${r.toFixed(4)}, ${l.toFixed(4)}`,latitude:r,longitude:l}))}},disabled:!r||!l,title:r&&l?"Use my current location":w||"Location not available",children:e.jsx(M,{className:"w-4 h-4"})})]})]}),g&&v.length>0&&e.jsx("div",{className:"border border-border rounded-md bg-background shadow-lg max-h-48 overflow-y-auto",children:v.map(t=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted border-b border-border last:border-b-0 flex items-center gap-2",onClick:async()=>{S(a=>({...a,location:t.description})),b(!1);const o=await G(t.description);o&&S(a=>({...a,latitude:o.lat,longitude:o.lng}))},children:[e.jsx(z,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.structured_formatting.main_text}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.structured_formatting.secondary_text})]})]},t.place_id))}),u.location&&e.jsx("p",{className:"text-sm text-destructive",children:u.location}),s.latitude&&s.longitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(z,{className:"w-3 h-3"}),e.jsxs("span",{children:["üìç Location coordinates saved (",s.latitude.toFixed(4),", ",s.longitude.toFixed(4),")"]})]}),r&&l&&!s.latitude&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:"üéØ Your location detected - use GPS button to auto-fill"})]}),w&&e.jsxs("div",{className:"text-sm text-amber-600",children:["üìç ",w]})]}),y("maxPlayers","Max Players","number"),y("cost","Cost","select",[{value:"FREE",label:"Free"},{value:"$5",label:"$5 per person"},{value:"$10",label:"$10 per person"},{value:"$15",label:"$15 per person"},{value:"$20",label:"$20 per person"},{value:"custom",label:"Custom amount"}]),y("requirements","Requirements (Optional)","textarea")]})]})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-t border-border px-4 py-4 mt-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",onClick:T,className:"w-auto px-4",disabled:j,children:i===1?"Cancel":"Back"}),i<_.length?e.jsx(k,{onClick:Y,className:"flex-1",disabled:j||Object.keys(u).length>0,children:"Next Step"}):e.jsx(k,{onClick:K,disabled:j,className:"flex-1",children:j?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Game..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Game"]})})]})}),n&&e.jsx("div",{className:"mt-4",children:e.jsx(O,{variant:"destructive",children:e.jsx(U,{children:n})})}),i===3&&s.sport&&e.jsx("div",{className:"mt-6",children:e.jsxs(O,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsxs(U,{children:['Ready to create "',s.title,'" for ',s.maxPlayers," players on ",s.date," at ",s.time,"?"]})]})})]})]})}export{ue as CreateGame};
//# sourceMappingURL=CreateGame-Ds69NmAG.js.map
