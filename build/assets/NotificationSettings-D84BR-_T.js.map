{"version":3,"file":"NotificationSettings-D84BR-_T.js","sources":["../../src/hooks/usePushNotifications.ts","../../src/components/NotificationSettings.tsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { toast } from 'sonner';\n\nexport interface PushSubscription {\n  endpoint: string;\n  keys: {\n    p256dh: string;\n    auth: string;\n  };\n}\n\nexport interface PushNotificationState {\n  isSupported: boolean;\n  permission: NotificationPermission;\n  isSubscribed: boolean;\n  subscription: PushSubscription | null;\n  isLoading: boolean;\n  error: string | null;\n}\n\ninterface UsePushNotificationsOptions {\n  vapidPublicKey?: string;\n  autoSubscribe?: boolean;\n  serviceWorkerUrl?: string;\n}\n\nconst DEFAULT_VAPID_KEY = 'BCmjGZmgUDGgJG3g5y8FPAGgGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGGjGG'; // Mock VAPID key\n\nexport function usePushNotifications(options: UsePushNotificationsOptions = {}) {\n  const {\n    vapidPublicKey = DEFAULT_VAPID_KEY,\n    autoSubscribe = false,\n    serviceWorkerUrl = '/sw.js'\n  } = options;\n\n  const [state, setState] = useState<PushNotificationState>({\n    isSupported: false,\n    permission: 'default',\n    isSubscribed: false,\n    subscription: null,\n    isLoading: false,\n    error: null\n  });\n\n  const [serviceWorkerRegistration, setServiceWorkerRegistration] = useState<ServiceWorkerRegistration | null>(null);\n\n  // Check if push notifications are supported\n  const checkSupport = useCallback(() => {\n    const isSupported = \n      'serviceWorker' in navigator &&\n      'PushManager' in window &&\n      'Notification' in window;\n\n    setState(prev => ({ ...prev, isSupported }));\n    return isSupported;\n  }, []);\n\n  // Register service worker\n  const registerServiceWorker = useCallback(async (): Promise<ServiceWorkerRegistration | null> => {\n    if (!('serviceWorker' in navigator)) {\n      console.warn('Service workers not supported');\n      return null;\n    }\n\n    try {\n      const registration = await navigator.serviceWorker.register(serviceWorkerUrl, {\n        scope: '/'\n      });\n      \n      console.log('Service Worker registered successfully:', registration);\n      setServiceWorkerRegistration(registration);\n      \n      // Wait for service worker to be ready\n      await navigator.serviceWorker.ready;\n      \n      return registration;\n    } catch (error) {\n      console.error('Service Worker registration failed:', error);\n      setState(prev => ({ ...prev, error: 'Failed to register service worker' }));\n      return null;\n    }\n  }, [serviceWorkerUrl]);\n\n  // Request notification permission\n  const requestPermission = useCallback(async (): Promise<NotificationPermission> => {\n    if (!('Notification' in window)) {\n      setState(prev => ({ ...prev, error: 'Notifications not supported' }));\n      return 'denied';\n    }\n\n    try {\n      const permission = await Notification.requestPermission();\n      setState(prev => ({ ...prev, permission }));\n\n      switch (permission) {\n        case 'granted':\n          // Only show toast for successful permission grant\n          toast.success('Notifications enabled!');\n          break;\n        case 'denied':\n          // Show error only when explicitly denied\n          console.log('Notifications blocked by user');\n          break;\n        case 'default':\n          // Don't show toast for pending state\n          console.log('Notification permission pending');\n          break;\n      }\n\n      return permission;\n    } catch (error) {\n      console.error('Permission request failed:', error);\n      setState(prev => ({ ...prev, error: 'Failed to request permission' }));\n      return 'denied';\n    }\n  }, []);\n\n  // Subscribe to push notifications\n  const subscribe = useCallback(async (): Promise<PushSubscription | null> => {\n    if (!serviceWorkerRegistration) {\n      toast.error('Service worker not available');\n      return null;\n    }\n\n    if (state.permission !== 'granted') {\n      const permission = await requestPermission();\n      if (permission !== 'granted') {\n        return null;\n      }\n    }\n\n    setState(prev => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // Convert VAPID key to Uint8Array\n      const applicationServerKey = urlBase64ToUint8Array(vapidPublicKey);\n\n      const pushSubscription = await serviceWorkerRegistration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey\n      });\n\n      const subscriptionData: PushSubscription = {\n        endpoint: pushSubscription.endpoint,\n        keys: {\n          p256dh: arrayBufferToBase64(pushSubscription.getKey('p256dh')!),\n          auth: arrayBufferToBase64(pushSubscription.getKey('auth')!)\n        }\n      };\n\n      // Send subscription to server\n      await sendSubscriptionToServer(subscriptionData);\n\n      setState(prev => ({\n        ...prev,\n        isSubscribed: true,\n        subscription: subscriptionData,\n        isLoading: false\n      }));\n\n      // Removed excessive success toast - user can see the switch change\n      return subscriptionData;\n\n    } catch (error) {\n      console.error('Push subscription failed:', error);\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: 'Failed to subscribe to push notifications'\n      }));\n      // Only show error toast for actual failures\n      toast.error('Failed to enable push notifications');\n      return null;\n    }\n  }, [serviceWorkerRegistration, state.permission, requestPermission, vapidPublicKey]);\n\n  // Unsubscribe from push notifications\n  const unsubscribe = useCallback(async (): Promise<boolean> => {\n    if (!serviceWorkerRegistration) {\n      return false;\n    }\n\n    setState(prev => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      const pushSubscription = await serviceWorkerRegistration.pushManager.getSubscription();\n      \n      if (pushSubscription) {\n        await pushSubscription.unsubscribe();\n        \n        // Remove subscription from server\n        if (state.subscription) {\n          await removeSubscriptionFromServer(state.subscription);\n        }\n      }\n\n      setState(prev => ({\n        ...prev,\n        isSubscribed: false,\n        subscription: null,\n        isLoading: false\n      }));\n\n      // Removed toast - user can see the switch change\n      return true;\n\n    } catch (error) {\n      console.error('Unsubscribe failed:', error);\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: 'Failed to unsubscribe from push notifications'\n      }));\n      return false;\n    }\n  }, [serviceWorkerRegistration, state.subscription]);\n\n  // Check current subscription status\n  const checkSubscription = useCallback(async () => {\n    if (!serviceWorkerRegistration) return;\n\n    try {\n      const pushSubscription = await serviceWorkerRegistration.pushManager.getSubscription();\n      \n      if (pushSubscription) {\n        const subscriptionData: PushSubscription = {\n          endpoint: pushSubscription.endpoint,\n          keys: {\n            p256dh: arrayBufferToBase64(pushSubscription.getKey('p256dh')!),\n            auth: arrayBufferToBase64(pushSubscription.getKey('auth')!)\n          }\n        };\n\n        setState(prev => ({\n          ...prev,\n          isSubscribed: true,\n          subscription: subscriptionData\n        }));\n      } else {\n        setState(prev => ({\n          ...prev,\n          isSubscribed: false,\n          subscription: null\n        }));\n      }\n    } catch (error) {\n      console.error('Failed to check subscription:', error);\n    }\n  }, [serviceWorkerRegistration]);\n\n  // Send test notification\n  const sendTestNotification = useCallback(async () => {\n    if (!state.isSubscribed || !state.subscription) {\n      toast.error('Not subscribed to notifications');\n      return;\n    }\n\n    try {\n      await fetch('/api/notifications/test', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          subscription: state.subscription,\n          notification: {\n            title: 'Test Notification',\n            body: 'This is a test notification from TribeUp!',\n            data: {\n              type: 'test',\n              url: '/'\n            }\n          }\n        })\n      });\n\n      toast.success('Test notification sent!');\n    } catch (error) {\n      console.error('Failed to send test notification:', error);\n      toast.error('Failed to send test notification');\n    }\n  }, [state.isSubscribed, state.subscription]);\n\n  // Initialize\n  useEffect(() => {\n    const init = async () => {\n      if (!checkSupport()) {\n        return;\n      }\n\n      // Get current permission\n      if ('Notification' in window) {\n        setState(prev => ({ ...prev, permission: Notification.permission }));\n      }\n\n      // Register service worker\n      const registration = await registerServiceWorker();\n      \n      if (registration) {\n        // Check existing subscription\n        await checkSubscription();\n        \n        // Auto-subscribe if requested and permission granted\n        if (autoSubscribe && Notification.permission === 'granted') {\n          const existingSubscription = await registration.pushManager.getSubscription();\n          if (!existingSubscription) {\n            await subscribe();\n          }\n        }\n      }\n    };\n\n    init();\n  }, [checkSupport, registerServiceWorker, checkSubscription, subscribe, autoSubscribe]);\n\n  return {\n    // State\n    ...state,\n    \n    // Actions\n    requestPermission,\n    subscribe,\n    unsubscribe,\n    sendTestNotification,\n    \n    // Service Worker\n    serviceWorkerRegistration,\n    \n    // Utilities\n    canSubscribe: state.isSupported && state.permission === 'granted' && !state.isSubscribed,\n    shouldRequestPermission: state.isSupported && state.permission === 'default'\n  };\n}\n\n// Utility functions\nfunction urlBase64ToUint8Array(base64String: string): Uint8Array {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\nfunction arrayBufferToBase64(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer);\n  let binary = '';\n  for (let i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return window.btoa(binary);\n}\n\nasync function sendSubscriptionToServer(subscription: PushSubscription): Promise<void> {\n  // Mock implementation - in a real app, send to your backend\n  console.log('Sending subscription to server:', subscription);\n  \n  // Simulate API call\n  await new Promise(resolve => setTimeout(resolve, 500));\n}\n\nasync function removeSubscriptionFromServer(subscription: PushSubscription): Promise<void> {\n  // Mock implementation - in a real app, remove from your backend\n  console.log('Removing subscription from server:', subscription);\n  \n  // Simulate API call\n  await new Promise(resolve => setTimeout(resolve, 500));\n}","import React from 'react';\n// import { motion } from 'framer-motion'; // TEMPORARILY DISABLED\nimport { Button } from './ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from './ui/card';\nimport { Switch } from './ui/switch';\nimport { Badge } from './ui/badge';\nimport { Alert, AlertDescription } from './ui/alert';\nimport { LoadingSpinner } from './ui/loading-spinner';\nimport { \n  Bell, \n  BellOff, \n  Smartphone, \n  Mail, \n  MessageSquare, \n  Calendar,\n  Users,\n  Trophy,\n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  RefreshCw\n} from 'lucide-react';\nimport { usePushNotifications } from '../hooks/usePushNotifications';\nimport { useNotifications } from '../hooks/useNotifications';\nimport { toast } from 'sonner';\n\nfunction NotificationSettings() {\n  const {\n    isSupported,\n    permission,\n    isSubscribed,\n    isLoading,\n    error,\n    canSubscribe,\n    shouldRequestPermission,\n    requestPermission,\n    subscribe,\n    unsubscribe,\n    sendTestNotification\n  } = usePushNotifications();\n\n  const {\n    settings,\n    updateSettings,\n    requestPermission: requestNotificationPermission\n  } = useNotifications();\n\n  const getPermissionIcon = () => {\n    switch (permission) {\n      case 'granted':\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n      case 'denied':\n        return <XCircle className=\"w-5 h-5 text-red-500\" />;\n      default:\n        return <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />;\n    }\n  };\n\n  const getPermissionText = () => {\n    switch (permission) {\n      case 'granted':\n        return 'Notifications enabled';\n      case 'denied':\n        return 'Notifications blocked';\n      default:\n        return 'Permission pending';\n    }\n  };\n\n  const handleTogglePushNotifications = async () => {\n    if (isSubscribed) {\n      await unsubscribe();\n    } else if (canSubscribe) {\n      await subscribe();\n    } else if (shouldRequestPermission) {\n      await requestPermission();\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Push Notifications Status */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"w-5 h-5\" />\n            Push Notifications\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {!isSupported ? (\n            <Alert>\n              <AlertTriangle className=\"w-4 h-4\" />\n              <AlertDescription>\n                Push notifications are not supported in your browser. Please use a modern browser like Chrome, Firefox, or Safari.\n              </AlertDescription>\n            </Alert>\n          ) : (\n            <>\n              {/* Permission Status */}\n              <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n                <div className=\"flex items-center gap-3\">\n                  {getPermissionIcon()}\n                  <div>\n                    <div className=\"font-medium\">{getPermissionText()}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {permission === 'granted' && isSubscribed && 'You\\'ll receive notifications for important updates'}\n                      {permission === 'granted' && !isSubscribed && 'Click to enable push notifications'}\n                      {permission === 'denied' && 'Enable notifications in your browser settings'}\n                      {permission === 'default' && 'Click to enable notifications'}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {isSubscribed && (\n                    <Badge variant=\"secondary\" className=\"bg-green-500/10 text-green-600\">\n                      Active\n                    </Badge>\n                  )}\n                  <Switch\n                    checked={isSubscribed}\n                    onCheckedChange={handleTogglePushNotifications}\n                    disabled={isLoading || (permission === 'denied')}\n                  />\n                </div>\n              </div>\n\n              {/* Error State */}\n              {error && (\n                <Alert variant=\"destructive\">\n                  <XCircle className=\"w-4 h-4\" />\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              {/* Test Notification */}\n              {isSubscribed && (\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"font-medium\">Test Notifications</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      Send a test notification to verify everything works\n                    </div>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={sendTestNotification}\n                    disabled={isLoading}\n                  >\n                    {isLoading ? <LoadingSpinner size=\"sm\" /> : 'Send Test'}\n                  </Button>\n                </div>\n              )}\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Notification Preferences */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Smartphone className=\"w-5 h-5\" />\n            Notification Types\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <MessageSquare className=\"w-5 h-5 text-muted-foreground\" />\n              <div>\n                <div className=\"font-medium\">New Messages</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Get notified when someone sends you a message\n                </div>\n              </div>\n            </div>\n            <Switch\n              checked={settings.messageNotifications}\n              onCheckedChange={(checked) => updateSettings({ messageNotifications: checked })}\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Calendar className=\"w-5 h-5 text-muted-foreground\" />\n              <div>\n                <div className=\"font-medium\">Game Reminders</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Reminders before your games start\n                </div>\n              </div>\n            </div>\n            <Switch\n              checked={settings.gameReminders}\n              onCheckedChange={(checked) => updateSettings({ gameReminders: checked })}\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"w-5 h-5 text-muted-foreground\" />\n              <div>\n                <div className=\"font-medium\">Game Updates</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  When someone joins or leaves your games\n                </div>\n              </div>\n            </div>\n            <Switch\n              checked={settings.pushNotifications}\n              onCheckedChange={(checked) => updateSettings({ pushNotifications: checked })}\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Mail className=\"w-5 h-5 text-muted-foreground\" />\n              <div>\n                <div className=\"font-medium\">Email Notifications</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Weekly summary and important updates\n                </div>\n              </div>\n            </div>\n            <Switch\n              checked={settings.emailNotifications}\n              onCheckedChange={(checked) => updateSettings({ emailNotifications: checked })}\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Sound Settings */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Trophy className=\"w-5 h-5\" />\n            Sound & Vibration\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <div className=\"font-medium\">Notification Sounds</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Play a sound when you receive notifications\n              </div>\n            </div>\n            <Switch\n              checked={settings.soundEnabled}\n              onCheckedChange={(checked) => updateSettings({ soundEnabled: checked })}\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Quick Actions */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Quick Actions</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          <Button\n            variant=\"outline\"\n            className=\"w-full justify-start\"\n            onClick={() => {\n              updateSettings({\n                pushNotifications: true,\n                messageNotifications: true,\n                gameReminders: true,\n                soundEnabled: true\n              });\n              // Removed toast - settings change is visible in UI\n            }}\n          >\n            <Bell className=\"w-4 h-4 mr-2\" />\n            Enable All Notifications\n          </Button>\n\n          <Button\n            variant=\"outline\"\n            className=\"w-full justify-start\"\n            onClick={() => {\n              updateSettings({\n                pushNotifications: false,\n                messageNotifications: false,\n                gameReminders: false,\n                soundEnabled: false\n              });\n              // Removed toast - settings change is visible in UI\n            }}\n          >\n            <BellOff className=\"w-4 h-4 mr-2\" />\n            Disable All Notifications\n          </Button>\n\n          <Button\n            variant=\"outline\"\n            className=\"w-full justify-start\"\n            onClick={() => {\n              // Reset to defaults\n              updateSettings({\n                pushNotifications: true,\n                emailNotifications: false,\n                gameReminders: true,\n                messageNotifications: true,\n                soundEnabled: true\n              });\n              // Removed toast - settings change is visible in UI\n            }}\n          >\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\n            Reset to Defaults\n          </Button>\n        </CardContent>\n      </Card>\n\n      {/* Browser Instructions */}\n      {permission === 'denied' && (\n        <Alert>\n          <AlertTriangle className=\"w-4 h-4\" />\n          <AlertDescription>\n            <div className=\"space-y-2\">\n              <div className=\"font-medium\">Notifications are blocked</div>\n              <div className=\"text-sm\">\n                To enable notifications:\n                <ol className=\"list-decimal list-inside mt-2 space-y-1\">\n                  <li>Click the ðŸ”’ icon in your browser's address bar</li>\n                  <li>Select \"Notifications\" and choose \"Allow\"</li>\n                  <li>Refresh this page</li>\n                </ol>\n              </div>\n            </div>\n          </AlertDescription>\n        </Alert>\n      )}\n    </div>\n  );\n}\n\nexport default NotificationSettings;"],"names":["DEFAULT_VAPID_KEY","usePushNotifications","options","vapidPublicKey","autoSubscribe","serviceWorkerUrl","state","setState","useState","isSupported","permission","isSubscribed","subscription","isLoading","error","serviceWorkerRegistration","setServiceWorkerRegistration","checkSupport","useCallback","navigator","window","prev","registerServiceWorker","async","registration","serviceWorker","register","scope","ready","requestPermission","Notification","toast","success","subscribe","applicationServerKey","base64String","padding","repeat","length","base64","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","urlBase64ToUint8Array","pushSubscription","pushManager","userVisibleOnly","subscriptionData","endpoint","keys","p256dh","arrayBufferToBase64","getKey","auth","Promise","resolve","setTimeout","sendSubscriptionToServer","unsubscribe","getSubscription","removeSubscriptionFromServer","checkSubscription","sendTestNotification","fetch","method","headers","body","JSON","stringify","notification","title","data","type","url","useEffect","init","canSubscribe","shouldRequestPermission","buffer","bytes","binary","byteLength","String","fromCharCode","btoa","NotificationSettings","settings","updateSettings","useNotifications","jsxs","className","children","Card","jsx","CardHeader","CardTitle","Bell","CardContent","Fragment","CheckCircle","XCircle","AlertTriangle","getPermissionIcon","getPermissionText","Badge","variant","Switch","checked","onCheckedChange","disabled","Alert","AlertDescription","Button","size","onClick","LoadingSpinner","Smartphone","MessageSquare","messageNotifications","Calendar","gameReminders","Users","pushNotifications","Mail","emailNotifications","Trophy","soundEnabled","BellOff","RefreshCw"],"mappings":"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"}