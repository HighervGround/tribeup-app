{"version":3,"file":"AuthCallback-m_p4l4hR.js","sources":["../../src/pages/AuthCallback.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '../lib/supabase';\nimport { toast } from 'sonner';\nimport { Loader2 } from 'lucide-react';\n\nexport function AuthCallback() {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        console.log('[AuthCallback] Processing OAuth callback...');\n        \n        // Handle the OAuth callback with Supabase - this processes the URL hash/fragment\n        const { data, error } = await supabase.auth.getSession();\n        \n        if (error) {\n          console.error('[AuthCallback] Session error:', error);\n          toast.error('Authentication failed');\n          navigate('/auth', { replace: true });\n          return;\n        }\n\n        if (data.session) {\n          console.log('[AuthCallback] Session found, user authenticated');\n          \n          // Check for pending game join\n          const pendingGameId = localStorage.getItem('pendingGameJoin');\n          if (pendingGameId) {\n            console.log('[AuthCallback] Redirecting to pending game:', pendingGameId);\n            localStorage.removeItem('pendingGameJoin');\n            navigate(`/game/${pendingGameId}`, { replace: true });\n          } else {\n            console.log('[AuthCallback] Redirecting to home');\n            navigate('/', { replace: true });\n          }\n        } else {\n          console.log('[AuthCallback] No session found, checking URL for auth data...');\n          \n          // If no session, try to handle the OAuth callback from URL\n          const urlParams = new URLSearchParams(window.location.search);\n          const hashParams = new URLSearchParams(window.location.hash.substring(1));\n          \n          if (urlParams.get('code') || hashParams.get('access_token')) {\n            console.log('[AuthCallback] OAuth data found in URL, waiting for session...');\n            // Wait a bit for Supabase to process the OAuth callback\n            setTimeout(async () => {\n              const { data: retryData, error: retryError } = await supabase.auth.getSession();\n              if (retryData.session) {\n                console.log('[AuthCallback] Session found on retry');\n                navigate('/', { replace: true });\n              } else {\n                console.error('[AuthCallback] Still no session after retry:', retryError);\n                navigate('/auth', { replace: true });\n              }\n            }, 2000);\n          } else {\n            console.log('[AuthCallback] No OAuth data in URL');\n            navigate('/auth', { replace: true });\n          }\n        }\n      } catch (error) {\n        console.error('[AuthCallback] Unexpected error:', error);\n        toast.error('Authentication failed');\n        navigate('/auth', { replace: true });\n      }\n    };\n\n    // Add timeout to prevent infinite loading\n    const timeoutId = setTimeout(() => {\n      console.error('[AuthCallback] Timeout - redirecting to auth');\n      toast.error('Authentication timed out');\n      navigate('/auth', { replace: true });\n    }, 10000); // 10 second timeout\n\n    handleAuthCallback().finally(() => {\n      clearTimeout(timeoutId);\n    });\n\n    return () => clearTimeout(timeoutId);\n  }, [navigate]);\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center\">\n      <div className=\"text-center space-y-4\">\n        <Loader2 className=\"w-8 h-8 animate-spin mx-auto\" />\n        <h2 className=\"text-xl font-semibold\">Completing sign in...</h2>\n        <p className=\"text-muted-foreground\">Please wait while we set up your account</p>\n      </div>\n    </div>\n  );\n}\n"],"names":["AuthCallback","navigate","useNavigate","useEffect","handleAuthCallback","data","error","supabase","toast","pendingGameId","urlParams","hashParams","retryData","retryError","timeoutId","jsxs","jsx","Loader2"],"mappings":"2IAMO,SAASA,GAAe,CAC7B,MAAMC,EAAWC,EAAA,EAEjBC,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAqB,SAAY,CACrC,GAAI,CACF,QAAQ,IAAI,6CAA6C,EAGzD,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAAS,KAAK,WAAA,EAE5C,GAAID,EAAO,CACT,QAAQ,MAAM,gCAAiCA,CAAK,EACpDE,EAAM,MAAM,uBAAuB,EACnCP,EAAS,QAAS,CAAE,QAAS,EAAA,CAAM,EACnC,MACF,CAEA,GAAII,EAAK,QAAS,CAChB,QAAQ,IAAI,kDAAkD,EAG9D,MAAMI,EAAgB,aAAa,QAAQ,iBAAiB,EACxDA,GACF,QAAQ,IAAI,8CAA+CA,CAAa,EACxE,aAAa,WAAW,iBAAiB,EACzCR,EAAS,SAASQ,CAAa,GAAI,CAAE,QAAS,GAAM,IAEpD,QAAQ,IAAI,oCAAoC,EAChDR,EAAS,IAAK,CAAE,QAAS,EAAA,CAAM,EAEnC,KAAO,CACL,QAAQ,IAAI,gEAAgE,EAG5E,MAAMS,EAAY,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACtDC,EAAa,IAAI,gBAAgB,OAAO,SAAS,KAAK,UAAU,CAAC,CAAC,EAEpED,EAAU,IAAI,MAAM,GAAKC,EAAW,IAAI,cAAc,GACxD,QAAQ,IAAI,gEAAgE,EAE5E,WAAW,SAAY,CACrB,KAAM,CAAE,KAAMC,EAAW,MAAOC,GAAe,MAAMN,EAAS,KAAK,WAAA,EAC/DK,EAAU,SACZ,QAAQ,IAAI,uCAAuC,EACnDX,EAAS,IAAK,CAAE,QAAS,EAAA,CAAM,IAE/B,QAAQ,MAAM,+CAAgDY,CAAU,EACxEZ,EAAS,QAAS,CAAE,QAAS,EAAA,CAAM,EAEvC,EAAG,GAAI,IAEP,QAAQ,IAAI,qCAAqC,EACjDA,EAAS,QAAS,CAAE,QAAS,EAAA,CAAM,EAEvC,CACF,OAASK,EAAO,CACd,QAAQ,MAAM,mCAAoCA,CAAK,EACvDE,EAAM,MAAM,uBAAuB,EACnCP,EAAS,QAAS,CAAE,QAAS,EAAA,CAAM,CACrC,CACF,EAGMa,EAAY,WAAW,IAAM,CACjC,QAAQ,MAAM,8CAA8C,EAC5DN,EAAM,MAAM,0BAA0B,EACtCP,EAAS,QAAS,CAAE,QAAS,EAAA,CAAM,CACrC,EAAG,GAAK,EAER,OAAAG,EAAA,EAAqB,QAAQ,IAAM,CACjC,aAAaU,CAAS,CACxB,CAAC,EAEM,IAAM,aAAaA,CAAS,CACrC,EAAG,CAACb,CAAQ,CAAC,QAGV,MAAA,CAAI,UAAU,8DACb,SAAAc,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAQ,UAAU,8BAAA,CAA+B,EAClDD,EAAAA,IAAC,KAAA,CAAG,UAAU,wBAAwB,SAAA,wBAAqB,EAC3DA,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,0CAAA,CAAwC,CAAA,CAAA,CAC/E,CAAA,CACF,CAEJ"}