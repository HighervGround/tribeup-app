import{j as e}from"./ui-Cc4ivZpV.js";import{r as i,b as G}from"./vendor-IUqyc6Bg.js";import{c as F,u as H,a as V,S as d,B as U,C as w,e as S,f as C,d as k,t as P}from"./index-C8C2HhJm.js";import{I as h}from"./input-Dl0rAHeF.js";import{T as X}from"./textarea-Co4y-nzh.js";import{A as $,b as W,a as Y}from"./avatar-MWcRHnFc.js";import{B as Z}from"./badge-CEbg-mlR.js";import{A as q}from"./arrow-left-CVDmN1A4.js";import{X as K}from"./x-5i-IgxV8.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ee=F("save",Q);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],re=F("upload",ae),se=["Basketball","Soccer","Tennis","Volleyball","Football","Baseball","Swimming","Running","Cycling","Yoga"];function fe(){const m=H(),{user:n,setUser:I}=V(),[A,x]=i.useState(!1),[s,p]=i.useState({fullName:"",username:"",bio:"",location:"",avatarUrl:"",sportsPreferences:[]}),[u,l]=i.useState(null),[g,v]=i.useState(!1),[E,b]=i.useState(null),[L,B]=i.useState(""),[j,y]=i.useState(null),o=G.useRef(null),c=200,N=/^[a-zA-Z0-9._-]{3,20}$/;i.useEffect(()=>{(async()=>{if(!n){m("/auth");return}try{const r=await d.getUserProfile(n.id);if(!r)return;const t={fullName:r.name||"",username:r.username||"",bio:r.bio||"",location:r.location||"",avatarUrl:r.avatar||"",sportsPreferences:Array.isArray(r.preferences?.sports)?r.preferences.sports:[]};p(t),o.current=t}catch(r){console.error("Error loading user profile:",r),P.error("Failed to load profile data")}})()},[n,m]),i.useEffect(()=>{let a;const r=(s.username||"").trim();if(!r){l(null);return}if(!N.test(r)){l("3-20 chars. Letters, numbers, dot, underscore, or hyphen.");return}if(n?.username&&n.username.trim().toLowerCase()===r.toLowerCase()){l(null);return}return v(!0),a=setTimeout(async()=>{try{const t=await d.isUsernameAvailable(r,n?.id);l(t?null:"Username is already taken")}catch{l("Unable to validate username right now")}finally{v(!1)}},450),()=>clearTimeout(a)},[s.username,n]);const f=(a,r)=>{p(t=>({...t,[a]:r})),a==="username"&&l(null),a==="bio"&&typeof r=="string"&&r.length>c&&p(t=>({...t,bio:r.slice(0,c)}))},R=a=>{p(r=>({...r,sportsPreferences:r.sportsPreferences.includes(a)?r.sportsPreferences.filter(t=>t!==a):[...r.sportsPreferences,a]}))},D=async()=>{if(!n)return;const a=(s.username||"").trim();if(a){if(!N.test(a)){l("3-20 chars. Letters, numbers, dot, underscore, or hyphen.");return}if(!(n.username&&n.username.trim().toLowerCase()===a.toLowerCase()))try{v(!0),await d.isUsernameAvailable(a,n.id)||l("Username is already taken")}catch{l("Unable to validate username right now")}finally{v(!1)}}},T=a=>{const r=a.target.files?.[0]||null;if(b(r),y(null),r){if(!["image/jpeg","image/png","image/webp","image/gif"].includes(r.type)){y("Please upload a JPG, PNG, WEBP, or GIF image."),b(null);return}if(r.size>5242880){y("Image is too large. Max size is 5 MB."),b(null);return}const z=URL.createObjectURL(r);B(z)}else B("")},_=async()=>{if(n){x(!0);try{const a=(s.username||"").trim();if(a){if(!N.test(a)){l("3-20 chars. Letters, numbers, dot, underscore, or hyphen."),x(!1);return}if(!await d.isUsernameAvailable(a,n.id)){l("Username is already taken"),x(!1);return}}let r=s.avatarUrl;E&&(r=await d.uploadAvatar(E));const t=await d.updateUserProfile(n.id,{full_name:s.fullName,username:s.username,bio:s.bio,location:s.location,avatar_url:r,sports_preferences:s.sportsPreferences});I(t),P.success("Profile updated successfully!"),m("/profile")}catch(a){console.error("Error updating profile:",a),P.error("Failed to update profile")}finally{x(!1)}}},M=()=>{o.current&&JSON.stringify(o.current)!==JSON.stringify(s)&&!window.confirm("Discard unsaved changes?")||m("/profile")};i.useEffect(()=>{const a=o.current&&JSON.stringify(o.current)!==JSON.stringify(s),r=t=>{a&&(t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",r),()=>window.removeEventListener("beforeunload",r)},[s]);const O=o.current&&JSON.stringify(o.current)!==JSON.stringify(s);return n?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-12 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(U,{variant:"ghost",size:"icon",onClick:M,children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Edit Profile"})]}),e.jsxs(U,{onClick:_,disabled:!O||A||g||!!u||!!j||!s.fullName||!s.username,className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),A?"Saving...":"Save"]})]}),e.jsxs("div",{className:"px-4 space-y-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(C,{children:"Profile Picture"})}),e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{className:"w-20 h-20",children:[(L||s.avatarUrl)&&e.jsx(W,{src:L||s.avatarUrl,alt:"Avatar preview"}),e.jsx(Y,{className:"text-xl",children:s.fullName?s.fullName.charAt(0).toUpperCase():"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{placeholder:"Avatar URL (optional)",value:s.avatarUrl,onChange:a=>f("avatarUrl",a.target.value)}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx(h,{type:"file",accept:"image/*",onChange:T}),e.jsx(re,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enter a URL or upload an image"}),j&&e.jsx("p",{className:"text-xs text-red-500 mt-1",role:"alert","aria-live":"polite",children:j})]})]})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(C,{children:"Basic Information"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Full Name"}),e.jsx(h,{placeholder:"Enter your full name",value:s.fullName,onChange:a=>f("fullName",a.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Username ",e.jsx("span",{className:"text-muted-foreground font-normal",children:"(3–20 chars)"})]}),e.jsx(h,{placeholder:"Choose a username",value:s.username,onChange:a=>f("username",a.target.value),onBlur:D,"aria-describedby":u?"username-error":"username-help"}),g&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1","aria-live":"polite",children:"Checking availability…"}),u&&e.jsx("p",{id:"username-error",className:"text-xs text-red-500 mt-1",role:"alert","aria-live":"polite",children:u}),!u&&!g&&s.username&&e.jsx("p",{id:"username-help",className:"text-xs text-muted-foreground mt-1",children:"Allowed: letters, numbers, dot, underscore, hyphen."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(h,{placeholder:"City, State",value:s.location,onChange:a=>f("location",a.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Bio ",e.jsxs("span",{className:"text-muted-foreground font-normal",children:["(max ",c," chars)"]})]}),e.jsx(X,{placeholder:"Tell us about yourself...",value:s.bio,onChange:a=>f("bio",a.target.value),rows:3,maxLength:c,"aria-describedby":"bio-counter"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("span",{id:"bio-counter",className:`text-xs ${s.bio.length>=c?"text-red-500":"text-muted-foreground"}`,children:[s.bio.length,"/",c]})})]})]})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(C,{children:"Sports I Play"})}),e.jsxs(k,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:se.map(a=>e.jsxs(Z,{variant:s.sportsPreferences.includes(a)?"default":"secondary",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>R(a),children:[a,s.sportsPreferences.includes(a)&&e.jsx(K,{className:"w-3 h-3 ml-1"})]},a))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:"Click on sports to add or remove them from your preferences"})]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl mb-4",children:"Please sign in"}),e.jsx(U,{onClick:()=>m("/auth"),children:"Sign In"})]})})}export{fe as EditProfile};
//# sourceMappingURL=EditProfile-DvvEuQVY.js.map
