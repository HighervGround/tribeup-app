import{j as e,n as a,T as t,o as s,p as n,I as i,q as r,r as l,s as o,t as c,v as d,w as m,O as h}from"./ui-Bqrh-KgM.js";import{r as u,e as x,j as g}from"./vendor-CVaDA-xz.js";import{u as p,s as f,C as j,d as v,e as y,a as w,h as N,i as b,j as k,B as C,g as S,k as M,A as P,f as _,b as W,S as T,l as D,c as $}from"./index-DJ4pNJjZ.js";import{S as F}from"./separator-DYj-NKSk.js";import{I}from"./input-1jcSgSPV.js";import{s as A,u as R,X as z,U as O,v as E,w as G,t as U,x as J,g as Y,i as L,k as H,j as q,y as B,l as X,C as K,m as V,L as Q,F as Z,R as ee,A as ae,z as te,E as se,D as ne,e as ie,G as re,N as le}from"./utils-u5u1pB88.js";import{T as oe}from"./textarea-D3rFMdD4.js";import{I as ce}from"./ImageWithFallback-B7gg3TPo.js";import{a as de,b as me}from"./useGames-Z6DAKTzn.js";import{u as he}from"./useGameJoinToggle-CKHlJ31H.js";import{u as ue}from"./useDeepLinks-C_TpM2nu.js";import{u as xe}from"./useAchievements-DePu9rx_.js";import{a as ge,b as pe}from"./dateUtils-DKSG3jUc.js";import"./data-GsFKBc2q.js";function fe(e){const a=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===a?new e.constructor(+e):"number"==typeof e||"[object Number]"===a||"string"==typeof e||"[object String]"===a?new Date(e):new Date(NaN)}const je=43200;let ve={};function ye(){return ve}function we(e){const a=fe(e),t=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return t.setUTCFullYear(a.getFullYear()),+e-+t}function Ne(e,a){const t=fe(e),s=fe(a),n=t.getTime()-s.getTime();return n<0?-1:n>0?1:n}function be(e){return function(e,a){return e instanceof Date?new e.constructor(a):new Date(a)}(e,Date.now())}function ke(e){const a=fe(e);return+function(e){const a=fe(e);return a.setHours(23,59,59,999),a}(a)===+function(e){const a=fe(e),t=a.getMonth();return a.setFullYear(a.getFullYear(),t+1,0),a.setHours(23,59,59,999),a}(a)}function Ce(e,a){const t=fe(e),s=fe(a),n=Ne(t,s),i=Math.abs(function(e,a){const t=fe(e),s=fe(a);return 12*(t.getFullYear()-s.getFullYear())+(t.getMonth()-s.getMonth())}(t,s));let r;if(i<1)r=0;else{1===t.getMonth()&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*i);let a=Ne(t,s)===-n;ke(fe(e))&&1===i&&1===Ne(e,s)&&(a=!1),r=n*(i-Number(a))}return 0===r?0:r}function Se(e,a,t){const s=function(e,a){return+fe(e)-+fe(a)}(e,a)/1e3;return(n=t?.roundingMethod,e=>{const a=(n?Math[n]:Math.trunc)(e);return 0===a?0:a})(s);var n}const Me={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Pe(e){return(a={})=>{const t=a.width?String(a.width):e.defaultWidth;return e.formats[t]||e.formats[e.defaultWidth]}}const _e={date:Pe({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Pe({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Pe({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},We={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Te(e){return(a,t)=>{let s;if("formatting"===(t?.context?String(t.context):"standalone")&&e.formattingValues){const a=e.defaultFormattingWidth||e.defaultWidth,n=t?.width?String(t.width):a;s=e.formattingValues[n]||e.formattingValues[a]}else{const a=e.defaultWidth,n=t?.width?String(t.width):e.defaultWidth;s=e.values[n]||e.values[a]}return s[e.argumentCallback?e.argumentCallback(a):a]}}function De(e){return(a,t={})=>{const s=t.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],i=a.match(n);if(!i)return null;const r=i[0],l=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],o=Array.isArray(l)?function(e,a){for(let t=0;t<e.length;t++)if(a(e[t]))return t;return}(l,e=>e.test(r)):function(e,a){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&a(e[t]))return t;return}(l,e=>e.test(r));let c;c=e.valueCallback?e.valueCallback(o):o,c=t.valueCallback?t.valueCallback(c):c;return{value:c,rest:a.slice(r.length)}}}var $e;const Fe={code:"en-US",formatDistance:(e,a,t)=>{let s;const n=Me[e];return s="string"==typeof n?n:1===a?n.one:n.other.replace("{{count}}",a.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s},formatLong:_e,formatRelative:(e,a,t,s)=>We[e],localize:{ordinalNumber:(e,a)=>{const t=Number(e),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},era:Te({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Te({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Te({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Te({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Te({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:($e={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,a={})=>{const t=e.match($e.matchPattern);if(!t)return null;const s=t[0],n=e.match($e.parsePattern);if(!n)return null;let i=$e.valueCallback?$e.valueCallback(n[0]):n[0];return i=a.valueCallback?a.valueCallback(i):i,{value:i,rest:e.slice(s.length)}}),era:De({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:De({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:De({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:De({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:De({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ie(e,a){return function(e,a,t){const s=ye(),n=t?.locale??s.locale??Fe,i=Ne(e,a);if(isNaN(i))throw new RangeError("Invalid time value");const r=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:i});let l,o;i>0?(l=fe(a),o=fe(e)):(l=fe(e),o=fe(a));const c=Se(o,l),d=(we(o)-we(l))/1e3,m=Math.round((c-d)/60);let h;if(m<2)return t?.includeSeconds?c<5?n.formatDistance("lessThanXSeconds",5,r):c<10?n.formatDistance("lessThanXSeconds",10,r):c<20?n.formatDistance("lessThanXSeconds",20,r):c<40?n.formatDistance("halfAMinute",0,r):c<60?n.formatDistance("lessThanXMinutes",1,r):n.formatDistance("xMinutes",1,r):0===m?n.formatDistance("lessThanXMinutes",1,r):n.formatDistance("xMinutes",m,r);if(m<45)return n.formatDistance("xMinutes",m,r);if(m<90)return n.formatDistance("aboutXHours",1,r);if(m<1440){const e=Math.round(m/60);return n.formatDistance("aboutXHours",e,r)}if(m<2520)return n.formatDistance("xDays",1,r);if(m<je){const e=Math.round(m/1440);return n.formatDistance("xDays",e,r)}if(m<86400)return h=Math.round(m/je),n.formatDistance("aboutXMonths",h,r);if(h=Ce(o,l),h<12){const e=Math.round(m/je);return n.formatDistance("xMonths",e,r)}{const e=h%12,a=Math.trunc(h/12);return e<3?n.formatDistance("aboutXYears",a,r):e<9?n.formatDistance("overXYears",a,r):n.formatDistance("almostXYears",a+1,r)}}(e,be(e),a)}function Ae({gameId:a,className:t=""}){const{user:s}=p(),[n,i]=u.useState([]),[r,l]=u.useState(""),[o,c]=u.useState(!0),[d,m]=u.useState(!1),h=u.useRef(null),x=u.useRef(null),g=()=>{h.current?.scrollIntoView({behavior:"smooth"})};u.useEffect(()=>{(async()=>{try{c(!0);const{data:e,error:t}=await f.from("chat_messages").select("\n            id,\n            game_id,\n            user_id,\n            message,\n            created_at,\n            users:user_id (\n              full_name,\n              username,\n              avatar_url\n            )\n          ").eq("game_id",a).order("created_at",{ascending:!0});if(t){const e=localStorage.getItem(`chat-${a}`);if(e){const a=JSON.parse(e);i(a)}}else{const a=e.map(e=>({id:e.id,game_id:e.game_id,user_id:e.user_id,message:e.message,created_at:e.created_at,user:{name:e.users?.full_name||e.users?.username||`Unknown User (${e.user_id.slice(0,8)})`,avatar:e.users?.avatar_url||""}}));i(a)}}catch(e){}finally{c(!1)}})()},[a]),u.useEffect(()=>{if(!a)return;const e=f.channel(`game-chat-${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`game_id=eq.${a}`},async e=>{const{data:a,error:t}=await f.from("chat_messages").select("\n            id,\n            game_id,\n            user_id,\n            message,\n            created_at,\n            users:user_id (\n              full_name,\n              username,\n              avatar_url\n            )\n          ").eq("id",e.new.id).single();if(!t&&a){const e={id:a.id,game_id:a.game_id,user_id:a.user_id,message:a.message,created_at:a.created_at,user:{name:a.users?.full_name||a.users?.username||`Unknown User (${a.user_id.slice(0,8)})`,avatar:a.users?.avatar_url||""}};i(a=>a.some(a=>a.id===e.id)?a:[...a,e]),setTimeout(g,100)}}).subscribe(e=>{});return x.current=e,()=>{x.current&&x.current.unsubscribe()}},[a,s?.id]),u.useEffect(()=>{g()},[n]);const S=async()=>{if(r.trim()&&s&&!d){m(!0);try{const{data:e,error:t}=await f.from("chat_messages").insert({game_id:a,user_id:s.id,message:r.trim()}).select("\n          id,\n          game_id,\n          user_id,\n          message,\n          created_at,\n          users:user_id (\n            full_name,\n            username,\n            avatar_url\n          )\n        ").single();if(t)throw t;const n={id:e.id,game_id:e.game_id,user_id:e.user_id,message:e.message,created_at:e.created_at,user:{name:e.users?.full_name||e.users?.username||s.name,avatar:e.users?.avatar_url||s.avatar||""}};i(e=>[...e,n]),l(""),setTimeout(g,100)}catch(e){alert("Failed to send message. Please try again.")}finally{m(!1)}}};return s?e.jsxs(j,{className:t,children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Game Chat",n.length>0&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",n.length," messages)"]})]})}),e.jsxs(w,{className:"p-0",children:[e.jsxs("div",{className:"h-64 overflow-y-auto p-4 space-y-3",children:[o?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading messages..."})}):0===n.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Be the first to say something!"})]})}):n.map(a=>e.jsxs("div",{className:"flex gap-3 "+(a.user_id===s.id?"flex-row-reverse":""),children:[e.jsxs(N,{className:"w-8 h-8 flex-shrink-0",children:[a.user?.avatar&&e.jsx(b,{src:a.user.avatar}),e.jsx(k,{className:"text-xs",children:a.user?.name?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 max-w-[70%] "+(a.user_id===s.id?"text-right":""),children:[e.jsxs("div",{className:"rounded-lg px-3 py-2 text-sm "+(a.user_id===s.id?"bg-primary text-primary-foreground ml-auto":"bg-muted"),children:[a.user_id!==s.id&&e.jsx("div",{className:"font-medium text-xs mb-1 opacity-70",children:a.user?.name||"Unknown"}),e.jsx("div",{children:a.message})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 "+(a.user_id===s.id?"text-right":""),children:Ie(new Date(a.created_at),{addSuffix:!0})})]})]},a.id)),e.jsx("div",{ref:h})]}),e.jsxs("div",{className:"border-t p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:r,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},placeholder:"Type a message...",disabled:d,className:"flex-1"}),e.jsx(C,{onClick:S,disabled:!r.trim()||d,size:"sm",children:e.jsx(R,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send â€¢ Shift+Enter for new line"})]})]})]}):e.jsxs(j,{className:t,children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Game Chat"]})}),e.jsx(w,{children:e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Please sign in to join the chat"})})]})}function Re({...t}){return e.jsx(a,{"data-slot":"dropdown-menu",...t})}function ze({...a}){return e.jsx(t,{"data-slot":"dropdown-menu-trigger",...a})}function Oe({className:a,sideOffset:t=4,...i}){return e.jsx(s,{children:e.jsx(n,{"data-slot":"dropdown-menu-content",sideOffset:t,className:S("z-[99999] min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",a),...i})})}function Ee({className:a,inset:t,variant:s="default",...n}){return e.jsx(i,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":s,className:S("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...n})}function Ge({...a}){return e.jsx(r,{"data-slot":"dialog",...a})}function Ue({...a}){return e.jsx(m,{"data-slot":"dialog-portal",...a})}function Je({className:a,...t}){return e.jsx(h,{"data-slot":"dialog-overlay",className:S("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...t})}function Ye({className:a,children:t,...s}){return e.jsxs(Ue,{"data-slot":"dialog-portal",children:[e.jsx(Je,{}),e.jsxs(l,{"data-slot":"dialog-content",className:S("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...s,children:[t,e.jsxs(o,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(z,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Le({className:a,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:S("flex flex-col gap-2 text-center sm:text-left",a),...t})}function He({className:a,...t}){return e.jsx("div",{"data-slot":"dialog-footer",className:S("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...t})}function qe({className:a,...t}){return e.jsx(c,{"data-slot":"dialog-title",className:S("text-lg leading-none font-semibold",a),...t})}function Be({className:a,...t}){return e.jsx(d,{"data-slot":"dialog-description",className:S("text-muted-foreground text-sm",a),...t})}function Xe({isOpen:a,onClose:t,gameTitle:s,gameId:n,onJoinSuccess:i}){const{signUp:r,signInWithOAuth:l}=M(),[o,c]=u.useState("signup"),[d,m]=u.useState({name:"",email:"",phone:""}),[h,x]=u.useState(!1),[g,p]=u.useState("");if(!a)return null;const f=async e=>{try{x(!0),await l(e,{pendingGameId:n}),U.success(`Signing in with ${e}...`),t()}catch(a){U.error(a.message||"Social login failed")}finally{x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(y,{className:"text-lg",children:"signup"===o?`Join "${s}"`:"Check Your Email"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:t,children:e.jsx(z,{className:"w-4 h-4"})})]}),e.jsx(w,{children:"signup"===o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{variant:"outline",className:"w-full",onClick:()=>f("google"),disabled:h,children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),e.jsxs(C,{variant:"outline",className:"w-full",onClick:()=>f("apple"),disabled:h,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"})}),"Continue with Apple"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with email"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),x(!0),p("");try{await r(d.email,"temp-password-"+Date.now(),{name:d.name,email:d.email,phone:d.phone,pendingGameId:n}),c("verify"),U.success("Account created! Check your email to verify and join the game.")}catch(a){p(a.message)}finally{x(!1)}},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(I,{type:"text",placeholder:"Your name",value:d.name,onChange:e=>m(a=>({...a,name:e.target.value})),required:!0,className:"pl-10"}),e.jsx(O,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{type:"email",placeholder:"Email address",value:d.email,onChange:e=>m(a=>({...a,email:e.target.value})),required:!0,className:"pl-10"}),e.jsx(E,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{type:"tel",placeholder:"Phone (optional)",value:d.phone,onChange:e=>m(a=>({...a,phone:e.target.value})),className:"pl-10"}),e.jsx(G,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"})]}),g&&e.jsx(P,{variant:"destructive",children:e.jsx(_,{children:g})}),e.jsx(C,{type:"submit",className:"w-full",disabled:h,children:h?"Creating Account...":"Join Game"})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"By joining, you agree to our Terms of Service and Privacy Policy"})]}):e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Check your email"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We sent a verification link to ",e.jsx("strong",{children:d.email})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:['Click the link to verify your account and automatically join "',s,'"']})]}),e.jsx(C,{variant:"outline",onClick:t,className:"w-full",children:"Got it"})]})})]})})}function Ke({game:a,isOpen:t,onClose:s}){const[n,i]=u.useState(!1);if(!t)return null;const r=`${window.location.origin}/public/game/${a.id}`,l=`Join me for ${a.sport} at ${a.location} on ${a.date}!`,o=async()=>{try{await navigator.clipboard.writeText(r),i(!0),U.success("Link copied to clipboard!"),setTimeout(()=>i(!1),2e3)}catch(e){U.error("Failed to copy link")}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Share Game"]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:a.title}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(W,{variant:"secondary",children:a.sport})}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:a.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:a.date})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:a.time})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.currentPlayers,"/",a.maxPlayers," players"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Public RSVP Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:r,readOnly:!0,className:"flex-1"}),e.jsx(C,{variant:"outline",size:"sm",onClick:o,className:n?"bg-green-50 text-green-700":"",children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Anyone with this link can view game details and RSVP"})]}),e.jsx(F,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Share via"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(C,{variant:"outline",onClick:async()=>{if(navigator.share)try{await navigator.share({title:`Join ${a.title}`,text:l,url:r})}catch(e){}else o()},className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Share"]}),e.jsxs(C,{variant:"outline",onClick:()=>{const e=encodeURIComponent(`Join me for ${a.sport}!`),t=encodeURIComponent(`\nHi!\n\nI'm organizing a ${a.sport} game and would love for you to join:\n\nðŸ“ ${a.location}\nðŸ“… ${a.date} at ${a.time}\nðŸ’° ${a.cost||"Free"}\nðŸ‘¥ ${a.currentPlayers}/${a.maxPlayers} players\n\n${a.description?a.description+"\n\n":""}RSVP here: ${r}\n\nHope to see you there!\n    `.trim());window.open(`mailto:?subject=${e}&body=${t}`)},className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Email"]}),e.jsxs(C,{variant:"outline",onClick:()=>{const e=encodeURIComponent(`${l} RSVP: ${r}`);window.open(`sms:?body=${e}`)},className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"SMS"]}),e.jsxs(C,{variant:"outline",onClick:()=>{const e=encodeURIComponent(`${l} RSVP: ${r}`);window.open(`https://wa.me/?text=${e}`)},className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"WhatsApp"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{variant:"outline",onClick:s,className:"flex-1",children:"Close"}),e.jsxs(C,{onClick:o,className:"flex-1",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Copy Link"]})]})]})]})})}function Ve({isOpen:a,onClose:t,gameId:s,gameTitle:n,players:i}){const{checkForNewAchievements:r}=xe(),[l,o]=u.useState("game"),[c,d]=u.useState(!1),[m,h]=u.useState({overall:0,organization:0,skillLevel:0,fun:0,reviewText:"",wouldPlayAgain:!0,recommendToOthers:!0}),[x,g]=u.useState(i.map(e=>({playerId:e.id,skill:0,sportsmanship:0,communication:0,feedback:""}))),p=({rating:a,onRatingChange:t,label:s})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>t(s),className:"p-1 hover:scale-110 transition-transform",children:e.jsx(V,{className:"w-6 h-6 "+(s<=a?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-400")})},s))})]}),f=(e,a,t)=>{g(s=>s.map(s=>s.playerId===e?{...s,[a]:t}:s))};return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ye,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Le,{children:[e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),"Rate Your Experience"]}),e.jsxs(Be,{children:["Help improve the community by rating ",n]})]}),"game"===l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"How was the game?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your feedback helps other players"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(p,{rating:m.overall,onRatingChange:e=>h(a=>({...a,overall:e})),label:"Overall Rating *"}),e.jsx(p,{rating:m.organization,onRatingChange:e=>h(a=>({...a,organization:e})),label:"Organization"}),e.jsx(p,{rating:m.skillLevel,onRatingChange:e=>h(a=>({...a,skillLevel:e})),label:"Skill Level Match"}),e.jsx(p,{rating:m.fun,onRatingChange:e=>h(a=>({...a,fun:e})),label:"Fun Factor"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Additional Comments"}),e.jsx(oe,{placeholder:"Share your experience with other players...",value:m.reviewText,onChange:e=>h(a=>({...a,reviewText:e.target.value})),className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.wouldPlayAgain,onChange:e=>h(a=>({...a,wouldPlayAgain:e.target.checked})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"I'd play again"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.recommendToOthers,onChange:e=>h(a=>({...a,recommendToOthers:e.target.checked})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Recommend to others"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{variant:"outline",onClick:t,className:"flex-1",children:"Skip"}),e.jsx(C,{onClick:async()=>{if(0!==m.overall)try{d(!0),await T.submitGameReview({gameId:s,overallRating:m.overall,organizationRating:m.organization||void 0,skillLevelRating:m.skillLevel||void 0,funRating:m.fun||void 0,reviewText:m.reviewText||void 0,wouldPlayAgain:m.wouldPlayAgain,recommendToOthers:m.recommendToOthers}),o("players")}catch(e){U.error("Failed to submit rating. Please try again.")}finally{d(!1)}else U.error("Please provide an overall rating")},disabled:c||0===m.overall,className:"flex-1",children:c?"Submitting...":"Next: Rate Players"})]})]}),"players"===l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Rate Your Fellow Players"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Optional but helps build a better community"})]}),e.jsx("div",{className:"space-y-6",children:i.map(a=>{const t=x.find(e=>e.playerId===a.id);return t?e.jsxs(j,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(N,{children:[a.avatar&&e.jsx(b,{src:a.avatar,alt:a.name}),e.jsx(k,{children:a.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:a.name}),a.isHost&&e.jsx(W,{variant:"secondary",className:"text-xs",children:"Host"})]})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(p,{rating:t.skill,onRatingChange:e=>f(a.id,"skill",e),label:"Skill Level"}),e.jsx(p,{rating:t.sportsmanship,onRatingChange:e=>f(a.id,"sportsmanship",e),label:"Sportsmanship"}),e.jsx(p,{rating:t.communication,onRatingChange:e=>f(a.id,"communication",e),label:"Communication"})]}),e.jsx(oe,{placeholder:"Optional feedback for this player...",value:t.feedback,onChange:e=>f(a.id,"feedback",e.target.value),className:"min-h-[60px]"})]})]},a.id):null})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{variant:"outline",onClick:()=>o("complete"),className:"flex-1",children:"Skip Player Ratings"}),e.jsx(C,{onClick:async()=>{const e=x.filter(e=>e.skill>0&&e.sportsmanship>0&&e.communication>0);if(0!==e.length)try{d(!0),await Promise.all(e.map(e=>T.submitPlayerRating({gameId:s,ratedPlayerId:e.playerId,skillRating:e.skill,sportsmanshipRating:e.sportsmanship,communicationRating:e.communication,feedbackText:e.feedback||void 0}))),o("complete")}catch(a){U.error("Failed to submit player ratings. Please try again.")}finally{d(!1)}else o("complete")},disabled:c,className:"flex-1",children:c?"Submitting...":"Submit Ratings"})]})]}),"complete"===l&&e.jsxs("div",{className:"text-center space-y-6 py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(K,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Thanks for your feedback!"}),e.jsx("p",{className:"text-muted-foreground",children:"Your ratings help make TribeUp better for everyone"})]}),e.jsx("div",{className:"bg-muted/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Check your profile for any new achievements!"})]})}),e.jsx(C,{onClick:async()=>{await r(),t()},className:"w-full",children:"Done"})]})]})})}class Qe{static API_KEY=D.get("openWeatherApiKey");static BASE_URL="https://api.openweathermap.org/data/2.5";static CONFIG={temperatureUnit:D.get("weatherTempUnit"),updateInterval:D.get("weatherUpdateInterval"),includeHourlyForecast:D.get("weatherIncludeHourly"),rainThreshold:D.get("weatherRainThreshold"),windThreshold:D.get("weatherWindThreshold")};static async getCurrentWeather(e,a){if(!this.API_KEY)return this.getMockWeatherData();try{const t=await fetch(`${this.BASE_URL}/weather?lat=${e}&lon=${a}&appid=${this.API_KEY}&units=imperial`);if(!t.ok)throw new Error(`Weather API error: ${t.status}`);const s=await t.json();return this.transformWeatherData(s)}catch(t){return this.getMockWeatherData()}}static async getGameWeather(e,a,t){if(!this.API_KEY)return this.getMockWeatherData();try{const s=parseFloat(e.toFixed(6)),n=parseFloat(a.toFixed(6)),i=await fetch(`${this.BASE_URL}/forecast?lat=${s}&lon=${n}&appid=${this.API_KEY}&units=imperial`);if(!i.ok)return await this.getCurrentWeather(s,n);const r=await i.json();if(!r.list||0===r.list.length)return await this.getCurrentWeather(s,n);const l=t.getTime(),o=l-72e5,c=l+72e5,d=r.list.filter(e=>{const a=1e3*e.dt;return a>=o&&a<=c});let m;m=d.length>0?d.reduce((e,a)=>Math.abs(1e3*a.dt-l)<Math.abs(1e3*e.dt-l)?a:e):r.list.reduce((e,a)=>Math.abs(1e3*a.dt-l)<Math.abs(1e3*e.dt-l)?a:e);const h=this.analyzeWeatherWindow(d,m);return this.transformWeatherData(m,h)}catch(s){return this.getMockWeatherData()}}static async getWeatherByZipcode(e,a){if(!this.API_KEY)return this.getMockWeatherData();try{const t=await fetch(`${this.BASE_URL}/forecast?zip=${e},US&appid=${this.API_KEY}&units=imperial`);if(!t.ok)throw new Error(`Weather API error: ${t.status}`);const s=await t.json(),n=a.getTime(),i=n-72e5,r=n+72e5,l=s.list.filter(e=>{const a=1e3*e.dt;return a>=i&&a<=r});let o;o=l.length>0?l.reduce((e,a)=>Math.abs(1e3*a.dt-n)<Math.abs(1e3*e.dt-n)?a:e):s.list.reduce((e,a)=>Math.abs(1e3*a.dt-n)<Math.abs(1e3*e.dt-n)?a:e);const c=this.analyzeWeatherWindow(l,o);return this.transformWeatherData(o,c)}catch(t){return null}}static extractZipcode(e){const a=e.match(/\b(\d{5}(?:-\d{4})?)\b/);return a?a[1].split("-")[0]:null}static analyzeWeatherWindow(e,a){if(0===e.length)return{alerts:[],windowSummary:""};const t=e.map(e=>e.main.temp),s=e.map(e=>e.weather[0].main),n=e.map(e=>e.rain?.["3h"]||e.snow?.["3h"]||0),i=Math.min(...t),r=Math.max(...t);t.reduce((e,a)=>e+a,0),t.length;const l=Math.max(...n),o=[];let c="";r-i>10&&o.push(`ðŸŒ¡ï¸ Temperature will vary ${Math.round(i)}Â°F to ${Math.round(r)}Â°F during game time`),l>.1&&o.push("ðŸŒ§ï¸ Possible precipitation during game window");const d=[...new Set(s)];return d.length>1&&o.push(`ðŸŒ¤ï¸ Weather conditions may change: ${d.join(", ")}`),e.length>1&&(c=`4-hour forecast: ${Math.round(i)}-${Math.round(r)}Â°F, ${d.join("/")}`),{alerts:o,windowSummary:c}}static transformWeatherData(e,a){const t=Math.round(e.main.temp),s=e.weather[0].main,n=e.weather[0].description,i=e.rain?.["1h"]||e.snow?.["1h"]||0,r=this.generateWeatherAlerts(s,t,i,e.wind.speed),l=a?[...r,...a.alerts]:r;return{temperature:t,condition:s,description:a?.windowSummary||this.capitalizeWords(n),humidity:e.main.humidity,windSpeed:Math.round(e.wind.speed),precipitation:i,icon:this.getWeatherIcon(s),isOutdoorFriendly:this.isOutdoorFriendly(s,t,i,e.wind.speed),alerts:l}}static isOutdoorFriendly(e,a,t,s){if(a<40||a>95)return!1;if(t>this.CONFIG.rainThreshold)return!1;if(s>this.CONFIG.windThreshold)return!1;return!["Thunderstorm","Tornado","Squall"].includes(e)}static generateWeatherAlerts(e,a,t,s){const n=[];return a<50?n.push("ðŸ§¥ Dress warmly - temperature below 50Â°F"):a>85&&n.push("â˜€ï¸ Stay hydrated - high temperature expected"),t>this.CONFIG.rainThreshold&&n.push("ðŸŒ§ï¸ Rain expected - consider indoor backup plan"),s>12&&n.push("ðŸ’¨ Windy conditions - secure loose items"),"Thunderstorm"===e&&n.push("âš¡ Thunderstorm warning - move indoors immediately"),n}static getWeatherIcon(e){return{Clear:"â˜€ï¸",Clouds:"â˜ï¸",Rain:"ðŸŒ§ï¸",Drizzle:"ðŸŒ¦ï¸",Thunderstorm:"â›ˆï¸",Snow:"â„ï¸",Mist:"ðŸŒ«ï¸",Fog:"ðŸŒ«ï¸",Haze:"ðŸŒ«ï¸"}[e]||"ðŸŒ¤ï¸"}static capitalizeWords(e){return e.replace(/\b\w/g,e=>e.toUpperCase())}static getMockWeatherData(){return{temperature:72,condition:"Clear",description:"Clear Sky",humidity:65,windSpeed:8,precipitation:0,icon:"â˜€ï¸",isOutdoorFriendly:!0,alerts:[]}}static isConfigured(){return!!this.API_KEY&&this.API_KEY.length>0}static getWeatherRecommendation(e){return e.isOutdoorFriendly?e.temperature<60?"Cool weather - dress in layers and bring warm clothing.":e.temperature>80?"Warm weather - bring water and sun protection.":"Great weather for outdoor activities!":"Weather conditions may not be ideal for outdoor activities. Consider rescheduling or moving indoors."}}function Ze({game:a}){const[t,s]=u.useState(null),[n,i]=u.useState(!0);return u.useEffect(()=>{(async()=>{try{let t=null;const n=new Date(`${a.date} ${a.time}`);if(a.latitude&&a.longitude)t=await Qe.getGameWeather(a.latitude,a.longitude,n);else if(a.location){const s="AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ";try{const e=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(a.location)}&key=${s}`);if(e.ok){const a=await e.json();if("OK"===a.status&&a.results&&a.results.length>0){const{lat:e,lng:s}=a.results[0].geometry.location;t=await Qe.getGameWeather(e,s,n)}}}catch(e){}if(!t){const e=Qe.extractZipcode(a.location);e&&(t=await Qe.getWeatherByZipcode(e,n))}if(!t){const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(a.location)}&appid=3d49d90fb511ba08385a88435f10825c&units=imperial`);if(e.ok){const a=await e.json();t={temperature:Math.round(a.main.temp),condition:a.weather[0].main,description:a.weather[0].description,humidity:a.main.humidity,windSpeed:Math.round(a.wind.speed),precipitation:a.rain?.["1h"]||a.snow?.["1h"]||0,icon:"Clear"===a.weather[0].main?"â˜€ï¸":"Clouds"===a.weather[0].main?"â˜ï¸":"Rain"===a.weather[0].main?"ðŸŒ§ï¸":"ðŸŒ¤ï¸",isOutdoorFriendly:!0,alerts:[]}}}}if(!t)throw new Error("No weather data available");s(t)}catch(e){try{const e=await fetch("https://api.openweathermap.org/data/2.5/weather?zip=10001,US&appid=3d49d90fb511ba08385a88435f10825c&units=imperial");if(!e.ok)throw new Error("Fallback weather failed");{const t=await e.json(),n=Math.round(t.main.temp),i=t.weather[0].main,r=t.weather[0].description;s({temperature:n,condition:i,description:`${r.charAt(0).toUpperCase()+r.slice(1)} (nearby area)`,humidity:t.main.humidity,windSpeed:Math.round(t.wind.speed),precipitation:t.rain?.["1h"]||t.snow?.["1h"]||0,icon:"Clear"===i?"â˜€ï¸":"Clouds"===i?"â˜ï¸":"Rain"===i?"ðŸŒ§ï¸":"ðŸŒ¤ï¸",isOutdoorFriendly:n>40&&n<95,alerts:[`ðŸ“ Showing weather for nearby area - actual conditions at ${a.location||"game location"} may vary`]})}}catch(t){s({temperature:72,condition:"Clear",description:"Weather data temporarily unavailable",humidity:65,windSpeed:8,precipitation:0,icon:"ðŸŒ¤ï¸",isOutdoorFriendly:!0,alerts:[`ðŸ”„ Weather service temporarily unavailable for ${a.location||"this location"}`]})}}i(!1)})()},[a.latitude,a.longitude,a.location,a.date,a.time]),n?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading weather..."}):t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[t.temperature,"Â°F"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Humidity: ",t.humidity,"%"]}),e.jsxs("div",{children:["Wind: ",t.windSpeed," mph"]})]})]}),t.alerts&&t.alerts.length>0&&e.jsx("div",{className:"space-y-1",children:t.alerts.map((a,t)=>e.jsx("div",{className:"text-xs bg-yellow-50 text-yellow-800 p-2 rounded",children:a},t))}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Qe.getWeatherRecommendation(t)})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Weather unavailable"})}function ea(){const a=x(),{gameId:t}=g(),{user:s}=p(),{data:n,isLoading:i,error:r}=de(t||""),{data:l=[],isLoading:o,error:c}=me(t||""),{toggleJoin:d,isLoading:m,getButtonText:h}=he(),[f,N]=u.useState(!1);u.useEffect(()=>{if(i||o){const e=setTimeout(()=>{N(!0)},15e3);return()=>clearTimeout(e)}N(!1)},[i,o]);const{navigateToUser:b}=ue(),[k,S]=u.useState(!1),[M,D]=u.useState(!1),[A,R]=u.useState(!1),[z,O]=u.useState(!1),[E,G]=u.useState(!1),[J,q]=u.useState(!1),[B,X]=u.useState(!1),[K,xe]=u.useState({title:"",description:"",location:"",duration:60,maxPlayers:0,cost:""}),[fe,je]=u.useState(""),ve=u.useMemo(()=>l&&n?l.map(e=>({...e,isHost:e.id===n?.creator_id})):[],[l,n?.creator_id]),ye=u.useMemo(()=>n?ge(n.date,n.time):{label:"",aria:""},[n?.date,n?.time]),we=u.useMemo(()=>n?pe(n.date,n.time):{date:"",time:""},[n?.date,n?.time]),Ne=!!n&&n.currentPlayers>=n.maxPlayers,be=n?n.tags:void 0,ke=s&&n&&(n.creatorId===s.id||n.createdBy===s.id);if(u.useMemo(()=>{if(!n)return!1;return new Date(`${n.date} ${n.time}`)<new Date},[n?.date,n?.time]),u.useMemo(()=>!(!s||!n)&&(n.isJoined||ke),[s,n?.isJoined,ke]),(i||o)&&!f)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading game details..."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"If this takes too long, try refreshing the page"})]})});if(f||r||c)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto text-muted-foreground mb-2"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Loading Issues"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:f?"The game is taking too long to load. This might be due to database connection issues.":"There was an error loading the game details."}),(r||c)&&e.jsxs("p",{className:"text-xs text-red-500 mb-4",children:["Error: ",r?.message||c?.message]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{onClick:()=>window.location.reload(),className:"w-full",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Refresh Page"]}),e.jsxs(C,{variant:"outline",onClick:()=>a("/"),className:"w-full",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]})});if(!n)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl mb-4",children:"Game not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The game you're looking for doesn't exist or has been removed."}),e.jsx(C,{onClick:()=>a("/"),children:"Go Home"})]})});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-10",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>{a(-1)},"aria-label":"Go back",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{role:"text","aria-label":`Event: ${n.title}. ${ye.aria}`,children:[e.jsx("h1",{className:"text-xl font-semibold line-clamp-2",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ye.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:async()=>{R(!0)},"data-action":"share","aria-label":"Share game",title:"Share game (U)",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsxs(Re,{onOpenChange:e=>{},children:[e.jsx(ze,{asChild:!0,children:e.jsx("div",{children:e.jsx(C,{variant:"ghost",size:"icon","aria-label":"Game options",onClick:e=>{e.stopPropagation()},style:{display:ke?"flex":"none"},children:e.jsx(se,{className:"w-5 h-5"})})})}),e.jsxs(Oe,{align:"end",className:"z-[99999] relative",children:[e.jsxs(Ee,{onClick:e=>{e.stopPropagation(),xe({title:n.title,description:n.description,location:n.location,duration:n.duration||60,maxPlayers:n.maxPlayers,cost:n.cost}),O(!0)},children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Edit Game"]}),e.jsxs(Ee,{onClick:e=>{e.stopPropagation(),G(!0)},className:"text-destructive focus:text-destructive",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Cancel Game"]})]})]}),e.jsx(C,{variant:"ghost",size:"icon","aria-label":"Report game",children:e.jsx(Z,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"px-4 py-6 space-y-6",id:"main-content",children:[e.jsxs(j,{children:[n.imageUrl&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-video overflow-hidden rounded-t-lg",children:e.jsx(ce,{src:n.imageUrl,alt:`${n.sport} game`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(W,{className:`${n.sportColor} text-white border-none`,children:n.sport})})]}),!n.imageUrl&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(W,{className:`${n.sportColor} text-white border-none`,children:n.sport})}),e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:we.date}),e.jsx("div",{className:"text-sm text-muted-foreground",children:we.time})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:"2 hours"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Duration"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:n.cost}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cost"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:Array.isArray(be)&&be.map(a=>e.jsx(W,{variant:"secondary",children:a},a))}),e.jsx(C,{onClick:async()=>{m||(s?d(n):D(!0))},disabled:!n.isJoined&&Ne||m,className:"w-full h-12",variant:n.isJoined?"outline":"default","data-action":"join-game",title:(n.isJoined?"Leave":"Join")+" game (J)",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),n.isJoined?"Leaving...":"Joining..."]}):Ne&&!n.isJoined?"Game is Full":s?h(n):"Join Game - Sign Up"})]})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Location"]})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("div",{children:n.location})}),e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:n.latitude&&n.longitude||n.location?e.jsx("iframe",{src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyCs_MsE3qt74h6eIR04QJqmf2FYgSys4UQ&q=${n.latitude&&n.longitude?`${n.latitude},${n.longitude}`:encodeURIComponent(n.location)}&zoom=15`,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"rounded-lg",title:"Game location map"}):e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(Y,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Map not available"})]})}),e.jsxs(C,{variant:"outline",className:"w-full",onClick:()=>{const e=n.location||"Location not specified",a=encodeURIComponent(e),t=`https://maps.google.com/maps?q=${a}&t=m&z=16`;try{if(navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/)){const e=`maps://maps.google.com/maps?q=${a}`;window.location.href=e,setTimeout(()=>{window.open(t,"_blank")},1e3)}else window.open(t,"_blank");U.success("Opening directions...")}catch(s){U.error("Failed to open directions")}},"data-action":"directions",title:"Get directions (L)",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Get Directions"]})]})})]}),(n.latitude&&n.longitude||n.location)&&e.jsxs(j,{children:[e.jsx(v,{children:e.jsx(y,{className:"flex items-center gap-2",children:"â˜€ï¸ Weather Forecast"})}),e.jsx(w,{children:e.jsx(Ze,{game:n})})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsx(y,{children:"About This Game"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm leading-relaxed "+(k?"":"line-clamp-3"),children:n.description}),n.description.length>150&&e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>S(!k),className:"p-0 h-auto",children:k?"Show less":"Show more"}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2",children:"Requirements"}),e.jsx("ul",{className:"space-y-1",children:["Athletic shoes required","Bring water bottle","No experience necessary"].map((a,t)=>e.jsxs("li",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[e.jsx("span",{className:"w-1 h-1 bg-muted-foreground rounded-full mt-2 flex-shrink-0"}),a]},t))})]})]})})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsx(y,{children:"Game Host"})}),e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{userId:n.creatorId||n.creatorData?.id,src:n.creatorData?.avatar,alt:n.creatorData?.name||n.createdBy||"Unknown",size:"md"}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>b(n.creatorId||n.creatorData?.id),className:"hover:text-primary transition-colors cursor-pointer font-medium","data-action":"view-profile",children:n.creatorData?.name||n.createdBy||"Unknown"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(V,{className:"w-3 h-3 fill-current text-warning"}),n.creatorData?.rating||"4.5"]})]})]})})})})]}),e.jsxs(j,{children:[e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(y,{children:["Players (",ve.length,"/",n.maxPlayers,")"]})})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:ve.map((a,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{userId:a.id,src:a.avatar,alt:a.name,size:"md"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{b(a.id)},className:"hover:text-primary transition-colors cursor-pointer font-medium","data-action":"view-profile",children:a.name}),a.isHost&&e.jsx(W,{variant:"secondary",className:"text-xs px-2 py-0",children:"Host"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(V,{className:"w-3 h-3 fill-current text-warning"}),a.rating]})]})]})}),t<ve.length-1&&e.jsx(F,{className:"mt-3"})]},a.id))})})]}),n.isJoined&&e.jsx(P,{className:"border-success text-success-foreground",children:e.jsx(_,{children:"You're joined! See you on the field!"})})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(Ae,{gameId:t})}),e.jsx(Xe,{isOpen:M,onClose:()=>D(!1),gameTitle:n.title,gameId:n.id,onJoinSuccess:async()=>{D(!1),t&&n&&d(n)}}),e.jsx(Ke,{isOpen:A,onClose:()=>R(!1),game:n}),e.jsx(Ge,{open:z,onOpenChange:O,children:e.jsxs(Ye,{className:"sm:max-w-[425px]",children:[e.jsxs(Le,{children:[e.jsx(qe,{children:"Edit Game"}),e.jsx(Be,{children:"Make changes to your game. Participants will be notified of any updates."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-title",className:"text-sm font-medium",children:"Title"}),e.jsx(I,{id:"edit-title",value:K.title,onChange:e=>xe(a=>({...a,title:e.target.value})),placeholder:"Game title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-description",className:"text-sm font-medium",children:"Description"}),e.jsx(oe,{id:"edit-description",value:K.description,onChange:e=>xe(a=>({...a,description:e.target.value})),placeholder:"Game description",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-location",className:"text-sm font-medium",children:"Location"}),e.jsx(I,{id:"edit-location",value:K.location,onChange:e=>xe(a=>({...a,location:e.target.value})),placeholder:"Game location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-duration",className:"text-sm font-medium",children:"Duration (minutes)"}),e.jsx(I,{id:"edit-duration",type:"number",min:"15",max:"480",value:K.duration,onChange:e=>xe(a=>({...a,duration:parseInt(e.target.value)||60})),placeholder:"60"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-maxPlayers",className:"text-sm font-medium",children:"Max Players"}),e.jsx(I,{id:"edit-maxPlayers",type:"number",min:"2",max:"50",value:K.maxPlayers,onChange:e=>xe(a=>({...a,maxPlayers:parseInt(e.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-cost",className:"text-sm font-medium",children:"Cost"}),e.jsx(I,{id:"edit-cost",value:K.cost,onChange:e=>xe(a=>({...a,cost:e.target.value})),placeholder:"FREE or $10"})]})]})]}),e.jsxs(He,{children:[e.jsx(C,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),e.jsx(C,{onClick:async()=>{if(t){X(!0);try{await T.updateGame(t,K),U.success("Game updated successfully"),O(!1),window.location.reload()}catch(e){U.error("Failed to update game",{description:e.message||"Please try again later"})}finally{X(!1)}}},disabled:B,children:B?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),e.jsx(Ge,{open:E,onOpenChange:G,children:e.jsxs(Ye,{className:"sm:max-w-[425px]",children:[e.jsxs(Le,{children:[e.jsx(qe,{children:"Cancel Game"}),e.jsx(Be,{children:"This action cannot be undone. All participants will be notified of the cancellation."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"delete-reason",className:"text-sm font-medium",children:"Reason for cancellation (optional)"}),e.jsx(oe,{id:"delete-reason",value:fe,onChange:e=>je(e.target.value),placeholder:"Let participants know why the game is cancelled...",rows:3})]})}),e.jsxs(He,{children:[e.jsx(C,{variant:"outline",onClick:()=>G(!1),children:"Keep Game"}),e.jsx(C,{variant:"destructive",onClick:async()=>{if(t){X(!0);try{await T.deleteGame(t,fe),U.success("Game cancelled successfully"),G(!1),a("/")}catch(e){U.error("Failed to cancel game",{description:e.message||"Please try again later"})}finally{X(!1)}}},disabled:B,children:B?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Cancelling..."]}):"Cancel Game"})]})]})}),e.jsx(Ve,{isOpen:J,onClose:()=>q(!1),gameId:t,gameTitle:n?.title||"",players:ve})]})}export{ea as default};
//# sourceMappingURL=GameDetails-h_C06tHb.js.map
